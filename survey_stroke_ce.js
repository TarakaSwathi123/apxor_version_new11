!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("apxor")):"function"==typeof define&&define.amd?define(["apxor"],e):(t=t||self)["apxor-qe"]=e(t.Apxor)}(this,(function(t){"use strict";function e(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function i(t){for(var i=1;i<arguments.length;i++){var n=null!=arguments[i]?arguments[i]:{};i%2?e(Object(n),!0).forEach((function(e){s(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,c(n.key),n)}}function o(t,e,i){return e&&a(t.prototype,e),i&&a(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t,e,i){return(e=c(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function u(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return l(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return l(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function c(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;var d=function(t){return void 0!==t&&!function(t){return null===t}(t)},f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function h(t,e){return Array.from(e).map((function(e,i){return String.fromCharCode(e^function(t,e){return t.charCodeAt(Math.floor(e%t.length))}(t,i))})).join("")}var v=function(t,e){return h(t,e=function(t){var e,i,n,r,a,o,s=0,u=[];if(!t)return t;t+="";do{e=(o=f.indexOf(t.charAt(s++))<<18|f.indexOf(t.charAt(s++))<<12|(r=f.indexOf(t.charAt(s++)))<<6|(a=f.indexOf(t.charAt(s++))))>>16&255,i=o>>8&255,n=255&o,u.push(e),64!==r&&(u.push(i),64!==a&&u.push(n))}while(s<t.length);return u}(e))},g=function(t){switch(t){case"app_event":return"AE";case"client_event":return"CE";case"activity_time":case"activity_event":return"AE"}return"Unknown"},p=function(t){return t.toUpperCase()},_=function(t,e,i){switch(i){case"EQ":return t===e;case"GT":return t>e;case"GTE":return t>=e;case"LT":return t<e;case"LTE":return t<=e;case"NEQ":return t!==e;case"R":return y(e).test(t);default:return!1}},y=function(t){var e=t.replace(/.*\/([gimuy]*)$/,"$1");e===t&&(e="");var i=e?t.replace(new RegExp("^/(.*?)/"+e+"$"),"$1"):t;return new RegExp(i,e)},m=function(){var t=new Date;return t.getDate()+"/"+t.getMonth()+"/"+t.getFullYear()},w=window.ApxorLogger,C=o((function e(){var i=this;r(this,e),s(this,"saTG","ALL"),s(this,"BITg",[]),s(this,"cxaV",[]),s(this,"userAttributesValidated",!0),s(this,"sessionAttributeValidated",!0),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(i.saTG=t.audience.audience_type,i.BITg=t.audience.attributes.user,i.cxaV=t.audience.attributes.session,!Array.isArray(i.BITg)||!Array.isArray(i.cxaV))return w.error("No attributes"),!1}catch(t){return w.error(t),!1}return!0})),s(this,"validate",(function(e,n){var r=!0;"FTU"===i.saTG&&(r=t.getController().getSessionInfo().is_first_session);var a=i.oyMm(e,i.BITg),o=i.oyMm(n,i.cxaV);return a||(i.userAttributesValidated=!1),o||(i.sessionAttributeValidated=!1),r&&a&&o})),s(this,"oyMm",(function(t,e){var i=e.length,n=!0;try{for(var r,a=function(){var i=e[o];if(void 0===t[i.name]||!1===n)return{v:!1};var r=i.operator,a=i.type,s=i.value.map((function(t){if("s"===a)return t;if("l"===a)return parseInt(t);if("f"===a)return parseFloat(t);if("b"===a)switch(t){case"true":return!0;case"false":return!1;default:return t}})),u=(Array.isArray(t[i.name])?t[i.name]:[t[i.name]]).some((function(t){return s.some((function(e){return"s"===a?t="".concat(t):"l"===a?t=parseInt(t):"f"===a?t=parseFloat(t):"b"===a&&(t=!!t),_(t,e,r)}))}));n=n&&u},o=0;o<i;o++)if(r=a())return r.v}catch(t){w.error(t),n=!1}return n}))})),E=window.ApxorLogger,T=o((function e(){var i=this;r(this,e),s(this,"NHCR",0),s(this,"ozGf",0),s(this,"EbJh","SESSION"),s(this,"fxkT",0),s(this,"Tlka",0),s(this,"VdwX",0),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{i.TSiL=t._id,i.MfXT=t.meta,i.NHCR=t.frequency.count,-1===i.NHCR&&(i.NHCR=1e3),i.VdwX=i.NHCR,i.ozGf=t.frequency.time_interval,i.EbJh=t.frequency.validity,i.Tlka=t.frequency.ses_lmt,i._dayCount=t.frequency.day_lmt;var e=K.getInstance().getQeState();if(!d(e)||!d(e[t._id]))return!0;if("SESSION"===i.EbJh){if(i.NHCR=parseInt(i.NHCR)-parseInt(e[t._id].SESSION),i.NHCR<=0)return i.afkn("Session limit reached"),console.warn("Max count limit reached for session:"+t._id),!1}else{if("OVERALL"!==i.EbJh)return E.info("Invalid config."),!1;if(i.NHCR=parseInt(i.NHCR)-parseInt(e[t._id].OVERALL),i.NHCR<=0)return i.afkn("Overall limit reached"),console.warn("Max count limit reached for overall:"+t._id),!1}}catch(t){return E.error(t),!1}return!0})),s(this,"Cpik",(function(){i.NHCR=i.NHCR-1})),s(this,"getFrequencyCount",(function(){return i.NHCR})),s(this,"ZktS",(function(){"SESSION"===i.EbJh&&(i.NHCR=i.VdwX,E.info("Campaign Limit reset"))})),s(this,"nSMS",(function(t){try{if(i.NHCR<=0)return"OVERALL"===i.EbJh?i.afkn("Overall limit reached"):"SESSION"===i.EbJh&&i.afkn("Session limit reached"),!1;var e=K.getInstance().getQeState();if(!d(e)||!d(e[t]))return!0;if(0!==i.Tlka)if(parseInt(i.Tlka)-parseInt(e[t].SESSION)<=0)return i.afkn("Session limit reached"),!1;if(0!==i._dayCount){var n,r=m();if(parseInt(i._dayCount)-parseInt((null===(n=e[t])||void 0===n?void 0:n.DATES[r])||0)<=0)return i.afkn("Day limit reached"),!1}}catch(t){i.afkn("Error validating the frequency: ".concat(t)),E.error("Error validating the frequency:"+t)}return!0})),s(this,"afkn",(function(e){var n;null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===i.MfXT.type?"survey":"campaign",apx_nudge_id:i.TSiL,apx_nudge_name:i.MfXT.name,apx_variant_code:i.MfXT.isExperiment||i.MfXT.only_context?null===(n=i.MfXT.attr)||void 0===n?void 0:n.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:e})}))})),b=o((function t(){var e=this;r(this,t),s(this,"ugVE",""),s(this,"saTG",""),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var i,n;e.ugVE=t.meta.name,e.saTG=t.meta.type,e._only_context=t.meta.only_context,e._attr=(null===(i=t.meta)||void 0===i?void 0:i.attr)||{},e._isExperiment=null===(n=t.meta)||void 0===n?void 0:n.isExperiment}catch(t){return window.ApxorLogger.error(t),!1}return!0}))})),S=window.ApxorLogger,k=o((function t(){var e=this;r(this,t),s(this,"aXVL",-1),s(this,"OTij",-1),s(this,"OfsY",-1),s(this,"iNFe",-1),s(this,"iTQL",!1),s(this,"_nudge_expired",!1),s(this,"_not_yet_active",!1),s(this,"_not_in_specified_time",!1),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(isNaN(Date.parse(t.validity.start_date))||isNaN(Date.parse(t.validity.end_date)))return S.error("Not valid dates"),!1;if(e.aXVL=Date.parse(t.validity.start_date),e.OTij=Date.parse(t.validity.end_date),d(t.at_specific_time)&&(e.iTQL=t.at_specific_time,e.iTQL&&d(t.time_limits))){var i=(new Date).toISOString().split("T")[0];if(e.OfsY=Date.parse(i+"T"+t.time_limits.start_time+":00.000Z"),e.iNFe=Date.parse(i+"T"+t.time_limits.end_time+":00.000Z"),isNaN(e.OfsY)||isNaN(e.iNFe))return S.error("Not valid times"),!1}}catch(t){return S.error(t),!1}return!0})),s(this,"validate",(function(){var t=Date.now();return t>e.aXVL&&t<e.OTij?(!e.iTQL||t>=e.OfsY&&t<=e.iNFe||(e._not_in_specified_time=!0),!e.iTQL||t>=e.OfsY&&t<=e.iNFe):(t<e.aXVL?e._not_yet_active=!0:t>e.OTij&&(e._nudge_expired=!0),!1)}))})),V=o((function t(){var e=this;r(this,t),s(this,"ugVE",""),s(this,"FVdu",{}),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{e.ugVE=t.name,e.FVdu=t.additional_info}catch(t){return!1}return!0}))})),L=o((function t(){var e=this;r(this,t),s(this,"aupH",0),s(this,"hsyC",0),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(e.aupH=Number(t.lower),e.hsyC=Number(t.upper),isNaN(e.aupH)||isNaN(e.hsyC))return!1}catch(t){return!1}return!0}))})),A=o((function t(){var e=this;r(this,t),s(this,"XKap",0),s(this,"KUWw",""),s(this,"hYcY",""),s(this,"sowC",new V),s(this,"CmZM",new L),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return e.KUWw=t.event_type,e.hYcY=t.activity,e.sowC.parse(t.details)&&e.CmZM.parse(t.time_bounds)}catch(t){return!1}}))})),x=window.ApxorLogger,N=o((function t(){var e=this;r(this,t),s(this,"XKap",0),s(this,"Bajt",-1),s(this,"NHCR",0),s(this,"jQvl",""),s(this,"hYcY",""),s(this,"KUWw",""),s(this,"CmZM",new L),s(this,"sowC",new V),s(this,"jghq",new A),s(this,"PWrX","AND"),s(this,"PrTX",!1),s(this,"saTG",void 0),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return e.Bajt=t.sequence,e.NHCR=t.count_config.count,e.jQvl=t.count_config.operator,e.hYcY=t.activity,e.KUWw=t.event_type,e.PWrX=t.combine_operator,e.saTG=t.type,e.sowC.parse(t.details)&&e.jghq.parse(t.trigger)&&e.CmZM.parse(t.time_bounds)}catch(t){return x.error(t),!1}}))})),O=window.ApxorLogger,I=o((function t(){var e=this;r(this,t),s(this,"NHCR",0),s(this,"jQvl",""),s(this,"KUWw",""),s(this,"CmZM",new L),s(this,"sowC",new V),s(this,"PWrX","AND"),s(this,"parse",(function(t){try{return e.NHCR=t.count_config.count,e.jQvl=t.count_config.operator,e.KUWw=t.event_type,e.PWrX=t.combine_operator,e.sowC.parse(t.details)&&e.CmZM.parse(t.time_bounds)}catch(t){return O.error(t),!1}}))})),M=window.ApxorLogger,F=function(){function e(){var i=this;r(this,e),s(this,"uygn",0),s(this,"TSiL",""),s(this,"EkdC",new N),s(this,"iiiC",new I),s(this,"UdIl",!1),s(this,"EIYv",!1),s(this,"zyJO",0),s(this,"PWrX","AND"),s(this,"IKrw","OR"),s(this,"GixU",-1),s(this,"rKYd",[]),s(this,"CpdQ",{}),s(this,"GLzh",!1),s(this,"initialize",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";if(i.TSiL=n,i.zyJO=r,i.rKYd=o,"termination"===s&&""!==s){i.iiiC.parse(e);return i.IKrw=i.iiiC.PWrX,i.inWr(),!0}var u=i.EkdC.parse(e);if(u){if(i.PWrX=i.EkdC.PWrX,i.EkdC.PrTX){var l=i.EkdC.sowC.ugVE;"APX_PAGE_OPENED"===l&&(l=i.EkdC.sowC.FVdu.navigation_id,l=d(l)?l:i.EkdC.sowC.ugVE),i.GixU=t.getController().getEventCount(l);var c=i.EkdC.NHCR,f=i.EkdC.jQvl;if(i.EIYv=i.ODli(i.GixU-1,c,f,!1),i.UdIl=i.EIYv,i.EIYv&&"APX_PAGE_OPENED"===i.EkdC.sowC.ugVE)return!0}return a&&0!==r||i.nwyH(),!0}return!1})),s(this,"nwyH",(function(){var t,e=i.EkdC,n=e.jghq,r=K.getInstance();"app_start"===n.KUWw?(i.UdIl=!0,r.registerForEvent(g(e.KUWw)+"___"+e.sowC.ugVE,i.bzsk)):r.registerForEvent(g(e.KUWw)+"___"+n.sowC.ugVE,i.bzsk),null!==(t=window.ApxorRTM)&&void 0!==t&&t.badgesLists.includes(i.TSiL)&&r.registerForEvent(g(e.KUWw)+"___"+"apxor-badge-container-".concat("-".concat(i.TSiL).replaceAll(" ","").replace(/[^\w\s]/gi,"")),i.bzsk)})),s(this,"inWr",(function(){var t=i.iiiC,e=K.getInstance();i.UdIl=!0,e.registerForEvent(g(t.KUWw)+"___"+t.sowC.ugVE,i.gjss)})),s(this,"dwkB",(function(t,e,n,r){var a,o=(Date.now()-i.CpdQ[e])/1e3;(null===(a=i.EkdC)||void 0===a||null===(a=a.sowC)||void 0===a||null===(a=a.FVdu)||void 0===a?void 0:a.time)/1e3>o&&i._displayCampaign(n)})),s(this,"HhzD",(function(t,e,n,r){var a,o;i.GLzh=!0;var s=Date.now(),u=null===(a=i.EkdC)||void 0===a||null===(a=a.jghq)||void 0===a?void 0:a.sowC.ugVE,l=(s-i.CpdQ[u])/1e3,c=null===(o=i.EkdC)||void 0===o||null===(o=o.sowC)||void 0===o||null===(o=o.FVdu)||void 0===o?void 0:o.time;(c/=1e3)>l&&i._displayCampaign(n)})),s(this,"bzsk",(function(e,n,r,a){var o,s,u=K.getInstance();if(i.UdIl){if(null!==(o=window.ApxorRTM)&&void 0!==o&&o.isBadgePresent&&null!==(s=window.ApxorRTM)&&void 0!==s&&s.badgesLists.includes(i.TSiL)&&t.getController().isBadgeTriggerSatisfied(i.TSiL))return i.EIYv=!0,i.EkdC.XKap=r,void u.validate(i.TSiL,i.zyJO);g(i.EkdC.KUWw)===e&&i.DcSI(r-i.EkdC.jghq.XKap,i.EkdC.CmZM)&&i.EkdC.sowC.ugVE===n&&i.qMkI(i.EkdC.sowC.FVdu,a)&&(i.uygn+=1,i.EIYv=i.ODli(i.uygn,i.EkdC.NHCR,i.EkdC.jQvl),i.EIYv&&(i.EkdC.XKap=r,u.validate(i.TSiL,i.zyJO)))}else if(i.UdIl=i.roBS(e,n,r,a),i.UdIl){var l=i.EkdC,c=l.jghq;if(c.XKap=r,"activity_time"===(null==l?void 0:l.KUWw)){var d,f,h,v=null==l||null===(d=l.sowC)||void 0===d||null===(d=d.FVdu)||void 0===d?void 0:d.time;(null==l||null===(f=l.sowC)||void 0===f||null===(f=f.FVdu)||void 0===f?void 0:f.nkpi.length)>0&&(setTimeout((function(){i.GLzh||(i.EIYv=!0,i.EIYv&&(i.uygn+=1,i.EIYv=i.ODli(i.uygn,i.EkdC.NHCR,i.EkdC.jQvl),i.EIYv&&(i.EkdC.XKap=r,u.validate(i.TSiL,i.zyJO)))),l.sowC.FVdu.nkpi.map((function(t){u.unregisterFromEvent(p(l.sowC.FVdu.et)+"___"+t,i)}))}),v),l.sowC.FVdu.nkpi.map((function(t){u.registerForEvent(p(l.sowC.FVdu.et)+"___"+t,i.HhzD)}))),(null==l||null===(h=l.sowC)||void 0===h||null===(h=h.FVdu)||void 0===h?void 0:h.kpi.length)>0&&(setTimeout((function(){l.sowC.FVdu.kpi.map((function(t){u.unregisterFromEvent(p(l.sowC.FVdu.et)+"___"+t,i)}))}),v),l.sowC.FVdu.kpi.map((function(t){t===l.jghq.sowC.ugVE?(u.unregisterFromEvent(g(c.KUWw)+"___"+c.sowC.ugVE,i),u.registerForEvent(p(l.sowC.FVdu.et)+"___"+t,i.dwkB)):u.registerForEvent(p(l.sowC.FVdu.et)+"___"+t,i.HhzD)})))}else u.unregisterFromEvent(g(c.KUWw)+"___"+c.sowC.ugVE,i),u.registerForEvent(g(l.KUWw)+"___"+l.sowC.ugVE,i);i.CpdQ[n]=Date.now()}})),s(this,"gjss",(function(t,e,n,r){var a=K.getInstance();g(i.iiiC.KUWw)===t&&i.DcSI(n,i.iiiC.CmZM)&&i.iiiC.sowC.ugVE===e&&i.qMkI(i.iiiC.sowC.FVdu,r)&&(i.uygn+=1,i.EIYv=i.ODli(i.uygn,i.iiiC.NHCR,i.iiiC.jQvl),i.EIYv&&(i.iiiC.XKap=n,a.validateForTermination(i.TSiL,i.zyJO)))})),s(this,"roBS",(function(t,e,n,r){var a=i.EkdC.jghq;return g(a.KUWw)===t&&a.sowC.ugVE===e&&i.DcSI(n,a.CmZM)&&i.qMkI(a.sowC.FVdu,r)})),s(this,"DcSI",(function(t,e){var i=Math.ceil(t);return i>e.aupH&&i<e.hsyC})),s(this,"ODli",(function(t,e,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];switch(r&&i.EkdC.PrTX&&(t+=i.GixU),n){case"EQ":return t===e;case"GT":return t>e;case"GTE":return t>=e;case"LT":return t<e;case"LTE":return t<=e;default:return!1}})),s(this,"qMkI",(function(t,e){var i=!0;try{var r,a=function(){if(!1===i)return{v:!1};if("object"===n(t[o])){var r,a=t[o].op,s=t[o].t;if("s"===s)r=t[o].val;else if("l"===s||"f"===s)r=parseFloat(t[o].val);else if("b"===s)switch(t[o].val){case"true":r=!0;break;case"false":r=!1;break;default:r=t[o].val}var u=(Array.isArray(e[o])?e[o]:[e[o]]).some((function(t){return"s"===s?t="".concat(t):"l"===s?t=parseInt(t):"f"===s?t=parseFloat(t):"b"===s&&(t=!!t),_(t,r,a)}));i=i&&u}else i=i&&_(e[o],t[o],"EQ")};for(var o in t)if(r=a())return r.v}catch(t){M.error(t),i=!1}return i}))}return o(e,[{key:"_displayCampaign",value:function(t){var e=K.getInstance();this.EIYv=!0,this.EIYv&&(this.uygn+=1,this.EIYv=this.ODli(this.uygn,this.EkdC.NHCR,this.EkdC.jQvl),this.EIYv&&(this.EkdC.XKap=t,e.validate(this.TSiL,this.zyJO)))}}]),e}(),X=window.ApxorLogger,R=o((function e(){var i=this;r(this,e),s(this,"ESIm",[]),s(this,"_ret_day",{}),s(this,"VXoV",{}),s(this,"QKph",!1),s(this,"VhZk",!1),s(this,"retainedDaysValidated",!0),s(this,"retainedSessionValidated",!0),s(this,"eventDoneInLT",!1),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{i.ESIm=t.overall_cfg.events,i._ret_day=t.overall_cfg.ret_day,i.VXoV=t.overall_cfg.session,i.QKph=t.overall_cfg.toggleRetDay,i.VhZk=t.overall_cfg.toggleSession}catch(t){return X.error(t),!1}return!0})),s(this,"validate",(function(){var e=parseInt(t.getController().getFromStorage("apx_retained_days")),n=parseInt(t.getController().getFromStorage("apx_retained_session"));if(i.QKph&&!isNaN(e)&&!(e>=i._ret_day.from&&e<=i._ret_day.to))return i.retainedDaysValidated=!1,!1;if(i.VhZk&&!isNaN(n)&&!(n>=i.VXoV.from&&n<=i.VXoV.to))return i.retainedSessionValidated=!1,!1;try{for(var r=t.getController().getFromStorage("_apx_lt_count"),a=t.getSiteId(),o=JSON.parse((new TextDecoder).decode(function(t){for(var e=new ArrayBuffer(t.length),i=new Uint8Array(e),n=0;n<t.length;n++)i[n]=t.charCodeAt(n);return e}(v(a,r)))),s=0;s<i.ESIm.length;s++){if(o[i.ESIm[s].name.replace("'","").replace("’","")])return i.eventDoneInLT=!0,!1}}catch(t){X.error("Failed to validate the lt count:"+t)}return!0}))})),D=window.ApxorLogger,j=o((function t(){var e=this;r(this,t),s(this,"BITg",[]),s(this,"cxaV",[]),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(e.BITg=t.attributes.user,e.cxaV=t.attributes.session,!Array.isArray(e.BITg)||!Array.isArray(e.cxaV))return D.error("No attributes"),!1}catch(t){return D.error(t),!1}return!0})),s(this,"validate",(function(t,i){return e.oyMm(t,e.BITg)&&e.oyMm(i,e.cxaV)})),s(this,"oyMm",(function(t,e){var i=e.length,n=!0;try{for(var r,a=function(){var i=e[o];if(!t[i.name]||!1===n)return{v:!1};var r=i.operator,a=i.type,s=i.value.map((function(t){return"s"===a?t:"l"===a?parseInt(t):"f"===a?parseFloat(t):void 0})),u=(Array.isArray(t[i.name])?t[i.name]:[t[i.name]]).some((function(t){return s.some((function(e){return _(t,e,r)}))}));n=n&&u},o=0;o<i;o++)if(r=a())return r.v}catch(t){D.error(t),n=!1}return n}))})),U=o((function e(){var i=this;r(this,e),s(this,"zvBV",t.getController()),s(this,"type",""),s(this,"_duration_seconds",0),s(this,"yqVF",1),s(this,"parse",(function(t){try{var e,n,r;if(i.saTG=null===(e=t.terminate_info.time_based)||void 0===e?void 0:e.type,i._duration_seconds=null===(n=t.terminate_info)||void 0===n?void 0:n.time_based.duration_seconds,i.yqVF=null===(r=t.terminate_info.time_based)||void 0===r?void 0:r.days,i.djNt(t._id))return i.zvBV.persistTerminationInfoLocally(t._id),!1}catch(t){return!1}return!0})),s(this,"djNt",(function(t){var e,n=JSON.parse(i.zvBV.getFromStorage("apx_termination_ID"));if(!n[t]||null===(e=n[t])||void 0===e||!e.startDate)return!1;var r,a=new Date(n[t].startDate),o=new Date((r=new Date).getMonth()+"/"+r.getDate()+"/"+r.getFullYear()),s=parseInt((o-a)/864e5,10),u=function(){var t=new Date;return{hours:t.getHours(),mins:t.getMinutes()}}(),l=n[t].OfsY;return s===i.yqVF&&u.hours>=l.hours||s>i.yqVF||n[t].goalAcheived}))})),W=o((function t(){var e=this;r(this,t),s(this,"enable_goal_events",!1),s(this,"attributes",{}),s(this,"rQLR",new j),s(this,"ffYl",new U),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var i,n,r;if(e.enable_time_based=null==t||null===(i=t.terminate_info)||void 0===i?void 0:i.enable_time_based,e.enable_time_based&&!e.ffYl.parse(t))return!1;if(e.enable_goal_events=null==t||null===(n=t.terminate_info)||void 0===n?void 0:n.enable_goal_events,e.enable_attributes=null==t||null===(r=t.terminate_info)||void 0===r?void 0:r.enable_attributes,e.enable_attributes&&!e.rQLR.parse(t.terminate_info))return!1}catch(t){return window.ApxorLogger.error(t),!1}return!0})),s(this,"validate",(function(t,i){return e.rQLR.validate(t,i)}))})),H=window.ApxorLogger,P=o((function e(){var n=this;r(this,e),s(this,"gnUf",[]),s(this,"tMSA",[]),s(this,"TSiL",""),s(this,"MfXT",new b),s(this,"LJiL",new C),s(this,"EbJh",new k),s(this,"KmCk",new T),s(this,"Vomm",new R),s(this,"Wkwl",new W),s(this,"UxPx",!1),s(this,"kclj",[]),s(this,"_variant_code",""),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var e;if(!d(t._id))return H.error("No Id"),!1;if(!d(t.enabled)||!t.enabled)return H.error("Not enabled"),!1;if(!(n.MfXT.parse(t)&&n.EbJh.parse(t)&&n.KmCk.parse(t)&&n.LJiL.parse(t)&&n.Vomm.parse(t)&&n.Wkwl.parse(t)))return!1;if(n._variant_code=n.MfXT._isExperiment||n.MfXT._only_context?null===(e=n.MfXT._attr)||void 0===e?void 0:e.apx_variant_code:"TG",!d(t.conditions)||!Array.isArray(t.conditions))return H.error("No valid conditions",t.conditions),!1;n.TSiL=t._id,n.UxPx=!!d(t.sequence_enabled)&&t.sequence_enabled,n.UxPx&&t.conditions.sort((function(t,e){return t.sequence<e.sequence}));for(var i=t.conditions,r=i.length,a=0;a<r;a++){n.kclj=[];var o=i[a];if("didn't"===o.type){var s,l={trigger_key:o.trigger.details.name,no_kpi_array:null==o||null===(s=o.details)||void 0===s||null===(s=s.additional_info)||void 0===s?void 0:s.nkpi,condition_id:null==o?void 0:o._id,time_bounds:o.time_bounds.upper};n.kclj=[].concat(u(n.kclj),[l])}var c=new F;c.initialize(o,n.TSiL,a,n.UxPx,n.kclj)&&n.gnUf.push(c)}if(n.Wkwl.enable_goal_events)for(var f=t.terminate_info.goal_events.events,h=f.length,v=0;v<h;v++){var g=new F;g.initialize(f[v],n.TSiL,v,!0,[],"termination")&&n.tMSA.push(g)}return n.gnUf.length>0}catch(t){return H.error(t),!1}})),s(this,"qviY",(function(t){if(!(t<0))if(n.UxPx){var e=n.gnUf[t];if(d(e)&&e.EIYv){var i=n.gnUf[t-1];if(d(i)&&!i.EIYv)return;var r=n.gnUf[t+1];d(r)?r.nwyH():n.OksP()}}else n.OksP()})),s(this,"uMYj",(function(t){t<0||n.eCsv()})),s(this,"OksP",(function(){var e,r,a=t.getController().getUserAttributes(),o=t.getController().getSessionAttributes();if(null!==(e=window.ApxorRTM)&&void 0!==e&&e.isBadgePresent&&null!==(r=window.ApxorRTM)&&void 0!==r&&r.badgesLists.includes(n.TSiL)&&t.getController().isBadgeTriggerSatisfied(n.TSiL)||null==t||t.logEvent("apx_trigger_satisfied",{apx_nudge_type:"SURVEY"===n.MfXT.saTG?"survey":"campaign",apx_nudge_id:n.TSiL,apx_nudge_name:n.MfXT.ugVE,apx_variant_code:n.MfXT._isExperiment||n.MfXT._only_context?n.MfXT._attr.apx_variant_code:"TG"}),!n.EbJh.validate()||!n.LJiL.validate(a,o)||!n.Vomm.validate())return n.Vomm.retainedDaysValidated?n.Vomm.retainedSessionValidated?n.Vomm.eventDoneInLT?void n.afkn("Event done in life time"):n.LJiL.userAttributesValidated?n.LJiL.sessionAttributeValidated?n.EbJh._not_in_specified_time?void n.afkn("Time limits check failed"):n.EbJh._not_yet_active?void n.afkn("not in the scheduled time"):n.EbJh._nudge_expired?void n.afkn("nudge expired"):void 0:void n.afkn("Session property filter not met"):void n.afkn("User property filter not met"):void n.afkn("User session criteria not met"):void n.afkn("Retained day criteria not met");for(var s=n.gnUf.length,u=s<1,l="",c=0;c<s;c++){var d=n.gnUf[c],f=d.EIYv;if(""===l.trim())u=f;else switch(l){case"AND":u=u&&f;break;case"OR":u=u||f}l=d.PWrX}if(u){if(console.debug("onCondition satisfied"),!n.KmCk.nSMS(n.TSiL))return void console.warn("Maximum limit reached",n.TSiL);console.log("Dispatching event",n.MfXT.saTG),t.logEvent("apx_context_evaluated",i(i({apx_nudge_type:"SURVEY"===n.MfXT.saTG?"survey":"campaign",apx_nudge_id:n.TSiL,apx_nudge_name:n.MfXT.ugVE,apx_variant_code:n.MfXT._isExperiment||n.MfXT._only_context?n.MfXT._attr.apx_variant_code:"TG"},n.MfXT._attr),{},{message_name:n.MfXT.ugVE,id:n.TSiL})),t.getController().dispatchEvent(n.MfXT.saTG,{name:n.MfXT.saTG,additional_info:{uuid:n.TSiL,name:n.MfXT.ugVE}})}})),s(this,"eCsv",(function(){for(var e=n.tMSA.length,r=e<1,a="",o=0;o<e;o++){var s=n.tMSA[o],u=s.EIYv;if(""===a.trim())r=u;else switch(a){case"AND":r=r&&u;break;case"OR":r=r||u}a=s.IKrw}r&&(console.log("Dispatching event",n.MfXT.saTG),t.getController().persistTerminationInfoLocally(n.TSiL),!0===n.MfXT._only_context&&t.logEvent("apx_context_evaluated",i(i({},n.MfXT._attr),{},{message_name:n.MfXT.ugVE,id:n.TSiL})),t.getController().dispatchEvent(n.MfXT.saTG,{name:n.MfXT.saTG,additional_info:{uuid:n.TSiL,name:n.MfXT.ugVE}}))})),s(this,"validateForTerminationAttributes",(function(){var e=t.getController().getUserAttributes(),i=t.getController().getSessionAttributes();return n.Wkwl.validate(e,i)})),s(this,"Cpik",(function(){n.KmCk.Cpik()})),s(this,"getFrequencyCount",(function(){return n.KmCk.getFrequencyCount()})),s(this,"jZKy",(function(){return n.KmCk.ZktS()})),s(this,"afkn",(function(e){var i;null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===n.MfXT.saTG?"survey":"campaign",apx_nudge_id:n.TSiL,apx_nudge_name:n.MfXT.ugVE,apx_variant_code:n.MfXT._isExperiment||n.MfXT._only_context?null===(i=n.MfXT._attr)||void 0===i?void 0:i.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:e})}))})),G=o((function t(){var e=this;r(this,t),s(this,"wBLb",{}),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{configs:[]};if(d(t)&&d(t.configs)){var i=t.configs;if(!Array.isArray(i))return;i.sort((function(t,e){var i,n;return(null!==(i=t.prio)&&void 0!==i?i:-1)-(null!==(n=e.prio)&&void 0!==n?n:-1)}));for(var n=0;n<i.length;n++){var r=i[n],a=r._id,o=new P;o.parse(r)?e.wBLb[a]=o:console.warn("Failed to parse cfg",a)}}})),s(this,"validate",(function(t,i){e.wBLb[t]&&e.wBLb[t].qviY(i)})),s(this,"getVariantCode",(function(t){return e.wBLb[t]?e.wBLb[t]._variant_code:""})),s(this,"validateForTermination",(function(t,i){e.wBLb[t]&&e.wBLb[t].uMYj(i)})),s(this,"validateForTerminationAttributes",(function(t){return!!e.wBLb[t]&&e.wBLb[t].validateForTerminationAttributes()})),s(this,"Cpik",(function(t){e.wBLb[t].Cpik()})),s(this,"getFrequencyCount",(function(t){return e.wBLb[t].getFrequencyCount()})),s(this,"resetFrequencyCounts",(function(){var t=e.wBLb;for(var i in t)t[i].jZKy()})),s(this,"SXMP",(function(t){try{if(e.wBLb){var i=e.wBLb[t];if(i&&i.MfXT)return i.MfXT}}catch(t){console.log("Error in getting the campaign meta ".concat(t))}return{}}))})),Y=window.ApxorLogger,q=o((function e(){var i=this;r(this,e),s(this,"RLdG",{}),s(this,"NRvW",[]),s(this,"Dwnd",!1),s(this,"initialize",(function(){var e=t.getController();e.registerForEvent("APP_EVENT",(function(t){return i.MOyw(t,"AE")})),e.registerForEvent("CLIENT_EVENT",(function(t){return i.MOyw(t,"CE")}))})),s(this,"UGvO",(function(){for(var t in i.NRvW)i.RnWM(t.event,t.key,t.type);i.Dwnd=!0})),s(this,"myhF",(function(t,e){var n;"function"==typeof e&&((n=i.RLdG[t]?i.RLdG[t]:[]).push(e),i.RLdG[t]=n,Y.debug("Listeners list: ",i.RLdG))})),s(this,"unregisterFromEvent",(function(t,e){if(i.RLdG[t]){for(var n=i.RLdG[t],r=[],a=0;a<n.length;a++){var o=n[a];o!==e&&r.push(o)}i.RLdG[t]=r}})),s(this,"MOyw",(function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"AE",n=e+"___"+t.name;i.RnWM(t,n,e)})),s(this,"RnWM",(function(e,n,r){if(i.Dwnd){if(Y.debug("Notifying listeners for event: "+e+", "+n,i.RLdG),i.RLdG[n])for(var a=i.RLdG[n],o=t.getController().getSDKRunningTimeInSec(),s=0;s<a.length;s++){(0,a[s])(r,e.name,o,e.additional_info)}}else i.NRvW.push({event:e,key:n,type:r})}))})),B=window.ApxorLogger,K=function(){function e(){var i=this;return r(this,e),s(this,"kLna",!1),s(this,"ANVV",null),s(this,"NlAy",m()),s(this,"PBNR",new q),s(this,"ptUI",t.getSiteId()),s(this,"HkOW",{}),s(this,"getQeState",(function(){try{var e=t.getController().getFromStorage("qe_state");return e?JSON.parse(v(i.ptUI,e)):(i.HkOW={},i.setQeState())}catch(t){return i.HkOW={},i.setQeState()}})),s(this,"setQeState",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";try{t.getController().persistToStorage("qe_state",i.HkOW,!0)}catch(n){""===e?i.HkOW={}:i.HkOW[e]={SESSION:0,OVERALL:0,DATES:{}},t.getController().persistToStorage("qe_state",i.HkOW,!0)}return i.HkOW})),s(this,"initialize",(function(){i.kLna||(i.kLna=!0,i.ANVV=new G,i.PBNR.initialize(),i.HkOW=i.getQeState(),B.info("QE Initialized.."))})),s(this,"parse",(function(t){i.xBCr()?(i.ANVV.parse(t),i.PBNR.UGvO()):B.warn("Must call init first. Unable to proceed")})),s(this,"validate",(function(t,e){i.xBCr()&&i.ANVV.validate(t,e)})),s(this,"getVariantCode",(function(t){return i.ANVV.getVariantCode(t)})),s(this,"validateForTermination",(function(t,e){i.xBCr()&&i.ANVV.validateForTermination(t,e)})),s(this,"validateForTerminationAttributes",(function(t,e){return i.ANVV.validateForTerminationAttributes(t,e)})),s(this,"updateCount",(function(t){try{d(i.HkOW[t])||i.createObjConfig(t),i.incrementFrequencies(t),i.setQeState(t),i.ANVV.Cpik(t)}catch(t){console.log("Could not update the count config:".concat(t))}})),s(this,"resetFrequencyCounts",(function(){i.ANVV.resetFrequencyCounts()})),s(this,"getFrequencyCount",(function(t){return i.ANVV.getFrequencyCount(t)})),s(this,"registerForEvent",(function(t,e){i.PBNR.myhF(t,e)})),s(this,"unregisterFromEvent",(function(t,e){i.PBNR.unregisterFromEvent(t,e)})),s(this,"notifyEventListener",(function(t){i.PBNR.MOyw(t)})),s(this,"fetch",(function(e,i,n,r){t.getController().fetchConfiguration(e,i,n,r)})),s(this,"xBCr",(function(){return i.kLna})),s(this,"getCampaignMetaFromQueryEngine",(function(t){return i.ANVV.SXMP(t)})),s(this,"wYyc",(function(){return i.NlAy})),e.instance||(e.instance=this),e.instance}return o(e,[{key:"createObjConfig",value:function(t){try{this.HkOW=this.getQeState(),d(this.HkOW[t])||(this.HkOW[t]={SESSION:0,OVERALL:0,DATES:{}},this.NlAy&&(this.HkOW[t].DATES[this.NlAy]=0),this.setQeState(t))}catch(t){B.error("Can not create the frequency count object:"+t)}}},{key:"incrementFrequencies",value:function(t){this.HkOW=this.getQeState();var e=this.HkOW[t];e.SESSION=e.SESSION+1,e.OVERALL=e.OVERALL+1;var i=m();i===this.NlAy&&e.DATES&&e.DATES[i]||(this.NlAy=i,e.DATES={},e.DATES[this.NlAy]=0),e.DATES[this.NlAy]=e.DATES[this.NlAy]+1}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}();s(K,"instance",void 0),window.ceVersion=160;try{void 0===exports&&null===exports||(exports.default=K,module.exports=exports.default)}catch(t){}return K}));
