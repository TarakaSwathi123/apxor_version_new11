!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("apxor")):"function"==typeof define&&define.amd?define(["apxor"],t):(e=e||self)["apxor-qe"]=t(e.Apxor)}(this,(function(e){"use strict";function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function n(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?t(Object(i),!0).forEach((function(t){a(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):t(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,d(i.key),i)}}function s(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(e,t,n){return(t=d(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||l(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){if(e){if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function v(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=l(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function d(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e;var h=function(e){return void 0===e},p=function(e){return void 0!==e&&!function(e){return null===e}(e)},g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function f(e,t){return Array.from(t).map((function(t,n){return String.fromCharCode(t^function(e,t){return e.charCodeAt(Math.floor(t%e.length))}(e,n))})).join("")}var _=function(e,t){return f(e,t=function(e){var t,n,i,r,o,s,a=0,u=[];if(!e)return e;e+="";do{t=(s=g.indexOf(e.charAt(a++))<<18|g.indexOf(e.charAt(a++))<<12|(r=g.indexOf(e.charAt(a++)))<<6|(o=g.indexOf(e.charAt(a++))))>>16&255,n=s>>8&255,i=255&s,u.push(t),64!==r&&(u.push(n),64!==o&&u.push(i))}while(a<e.length);return u}(t))},y=function(e){switch(e){case"app_event":return"AE";case"client_event":return"CE";case"activity_time":case"activity_event":return"AE";case"apxor_event":return"AEV";case"customer_event":return"CEV";case"any_event":return"ANV";case"campaign_event":return"CNV";case"survey_event":return"SVE"}return"Unknown"},m=function(e){return e.toUpperCase()},E=function(e,t,n){switch(n){case"EQ":return e===t;case"GT":return e>t;case"GTE":return e>=t;case"LT":return e<t;case"LTE":return e<=t;case"NEQ":return e!==t;case"R":return x(t).test(e);default:return!1}},S=function(e,t){switch(e){case"second":return 1e3*t;case"minute":return 60*t*1e3;case"hour":return 60*t*60*1e3;case"day":return 24*t*60*60*1e3;default:return 1}},x=function(e){var t=e.replace(/.*\/([gimuy]*)$/,"$1");t===e&&(t="");var n=t?e.replace(new RegExp("^/(.*?)/"+t+"$"),"$1"):e;return new RegExp(n,t)},T=function(){var e=new Date;return e.getDate()+"/"+e.getMonth()+"/"+e.getFullYear()},O=window.ApxorLogger,b=s((function t(){var n=this;r(this,t),a(this,"DIgs","ALL"),a(this,"tqNG",[]),a(this,"gxmp",[]),a(this,"userAttributesValidated",!0),a(this,"sessionAttributeValidated",!0),a(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(n.DIgs=e.audience.audience_type,n.tqNG=e.audience.attributes.user,n.gxmp=e.audience.attributes.session,!Array.isArray(n.tqNG)||!Array.isArray(n.gxmp))return O.error("No attributes"),!1}catch(e){return O.error(e),!1}return!0})),a(this,"validate",(function(t,i){var r=!0;"FTU"===n.DIgs&&(r=e.getController().getSessionInfo().is_first_session);var o=n.VVIM(t,n.tqNG),s=n.VVIM(i,n.gxmp);return o||(n.userAttributesValidated=!1),s||(n.sessionAttributeValidated=!1),r&&o&&s})),a(this,"VVIM",(function(e,t){var n=t.length,i=!0;try{for(var r,o=function(){var n=t[s];if(h(e[n.name])||!1===i)return{v:!1};var r=n.operator,o=n.type,a=n.value.map((function(e){if("s"===o)return e;if("l"===o)return parseInt(e);if("f"===o)return parseFloat(e);if("b"===o)switch(e){case"true":return!0;case"false":return!1;default:return e}})),u=(Array.isArray(e[n.name])?e[n.name]:[e[n.name]]).some((function(e){return a.some((function(t){return"s"===o?e="".concat(e):"l"===o?e=parseInt(e):"f"===o?e=parseFloat(e):"b"===o&&(e=!!e),E(e,t,r)}))}));i=i&&u},s=0;s<n;s++)if(r=o())return r.v}catch(e){O.error(e),i=!1}return i}))})),K=s((function e(){var t=this;r(this,e),a(this,"HtMf",""),a(this,"cEHd",{}),a(this,"amMD",""),a(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{t.HtMf=e.name,t.cEHd=e.additional_info,t.amMD=null==e?void 0:e.path}catch(e){return!1}return!0}))})),A=s((function e(){var t=this;r(this,e),a(this,"SmCD",0),a(this,"rANh",0),a(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(t.SmCD=Number(e.lower),t.rANh=Number(e.upper),isNaN(t.SmCD)||isNaN(t.rANh))return!1}catch(e){return!1}return!0}))})),F=s((function e(){var t=this;r(this,e),a(this,"kQgu",0),a(this,"xiSX",""),a(this,"AZOZ",""),a(this,"WzOH",new K),a(this,"CbSj",new A),a(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return t.xiSX=e.event_type,t.AZOZ=e.activity,t.WzOH.parse(e.details)&&t.CbSj.parse(e.time_bounds)}catch(e){return!1}}))})),H=window.ApxorLogger,W=s((function e(){var t=this;r(this,e),a(this,"kQgu",0),a(this,"hduJ",-1),a(this,"bbeA",0),a(this,"nPKa",""),a(this,"AZOZ",""),a(this,"xiSX",""),a(this,"CbSj",new A),a(this,"WzOH",new K),a(this,"pjrO",new F),a(this,"yWtP","AND"),a(this,"OvxW",!1),a(this,"DIgs",void 0),a(this,"yixU",""),a(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var n,i;return t.hduJ=null==e?void 0:e.sequence,t._conditionType=null==e?void 0:e.condition_type,t._id=null==e?void 0:e._id,t._eventCategory=null!=e&&e.event_category?null==e?void 0:e.event_category:"specific_event",t.bbeA=null==e||null===(n=e.count_config)||void 0===n?void 0:n.count,t.nPKa=null==e||null===(i=e.count_config)||void 0===i?void 0:i.operator,t.AZOZ=null==e?void 0:e.activity,t.xiSX=null==e?void 0:e.event_type,t.yWtP=e.combine_operator,t._timeEnabled=null==e?void 0:e.time_enabled,t._time=null==e?void 0:e.time,t.DIgs=null==e?void 0:e.type,t.yixU=null==e?void 0:e.route,t.WzOH.parse(null==e?void 0:e.details)&&t.pjrO.parse(e.trigger)&&t.CbSj.parse(e.time_bounds)}catch(e){return H.error(e),!1}}))})),D=window.ApxorLogger,w=s((function e(){var t=this;r(this,e),a(this,"bbeA",0),a(this,"nPKa",""),a(this,"xiSX",""),a(this,"CbSj",new A),a(this,"WzOH",new K),a(this,"yWtP","AND"),a(this,"parse",(function(e){try{return t.bbeA=e.count_config.count,t.nPKa=e.count_config.operator,t.xiSX=e.event_type,t.yWtP=e.combine_operator,t.WzOH.parse(e.details)&&t.CbSj.parse(e.time_bounds)}catch(e){return D.error(e),!1}}))})),I=window.ApxorLogger,C=function(){function t(){var n=this;r(this,t),a(this,"yykF",0),a(this,"hEoA",""),a(this,"hycK",new W),a(this,"uGEO",new w),a(this,"LjnR",!1),a(this,"ujFS",!1),a(this,"QUOi",0),a(this,"yWtP","AND"),a(this,"LeGs","OR"),a(this,"GrVZ",-1),a(this,"URig",[]),a(this,"BryZ",{}),a(this,"AueI",!1),a(this,"xJLp",void 0),a(this,"QuCx",void 0),a(this,"KRoL",void 0),a(this,"JZcx",void 0),a(this,"no_KPI_TriggerDetails",[]),a(this,"lVnk",!1),a(this,"timerDidnt",void 0),a(this,"timerDid",void 0),a(this,"initialize",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"",l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:-1,c=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];if(n.hEoA=i,n.QUOi=r,n.URig=s,n.xJLp=o,n.childConditionIndex=l,n.across_sessions=a||!1,"termination"===u&&""!==u){n.uGEO.parse(t);return n.LeGs=n.uGEO.yWtP,n.kxBD(),!0}var v=n.hycK.parse(t);if(v){if(n.yWtP=n.hycK.yWtP,n.hycK.OvxW){var d=n.hycK.WzOH.HtMf;"APX_PAGE_OPENED"===d&&(d=n.hycK.WzOH.cEHd.navigation_id,d=p(d)?d:n.hycK.WzOH.HtMf),n.GrVZ=e.getController().getEventCount(d);var h=n.hycK.bbeA,g=n.hycK.nPKa;if(n.ujFS=n.uJeB(n.GrVZ-1,h,g,!1),n.LjnR=n.ujFS,n.ujFS&&"APX_PAGE_OPENED"===n.hycK.WzOH.HtMf)return!0}return!0===c&&(o&&0!==r&&"unordered"!==o||n.TMtM()),!0}return!1})),a(this,"TMtM",(function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;-1!=t&&(n.QuCx=t);var i=n.hycK,r=null!=i&&i._eventCategory?null==i?void 0:i._eventCategory:"specific_event",o=i.pjrO,s=ee.getInstance();if("app_start"===o.xiSX)if(n.LjnR=!0,null!=i&&i._timeEnabled){if("session"!=(null==i?void 0:i._time.unit)){var a=S(i._time.unit,i._time.value);if("didn't"==(null==i?void 0:i.DIgs)){if(n.AueI=!1,console.log("in didnt"),console.log("in TMtM didn't"),n.timerDidnt=setTimeout((function(){console.log("setTimeout timer compleetd"),n.AueI||(n.ujFS=!0,n.ujFS&&(n.yykF+=1,n.ujFS=n.uJeB(n.yykF,n.hycK.bbeA,n.hycK.nPKa),n.ujFS&&(n.hycK.kQgu=Date.now(),s.validate(n.hEoA,n.QUOi,n.QuCx))),"specific_event"===r?s.unregisterFromEvent(y(n.hycK.xiSX)+"___"+n.hycK.WzOH.HtMf,n.zIyS):n.xMLB(r),n.LjnR=!1)}),a),n.across_sessions){var u=S(i._time.unit,i._time.value),l=i._timeEnabled,c=i._id;n.amCY(i.DIgs,i.WzOH.HtMf,Date.now(),i.WzOH.cEHd,u,l,c)}"specific_event"===r?(s.registerForEvent(y(n.hycK.xiSX)+"___"+n.hycK.WzOH.HtMf,n.zIyS),n.JZcx=n.hycK):n.veVT(r)}else if("did"==(null==i?void 0:i.DIgs)){if(console.log("did condition"),n.timerDid=setTimeout((function(){n.lVnk||("specific_event"===r?s.unregisterFromEvent(y(n.hycK.xiSX)+"___"+n.hycK.WzOH.HtMf,n.WWVs):n.MFad(r))}),a),n.across_sessions){var v=S(i._time.unit,i._time.value),d=i._timeEnabled,h=i._id;n.amCY(i.DIgs,i.WzOH.HtMf,Date.now(),i.WzOH.cEHd,v,d,h)}"specific_event"===r?(s.registerForEvent(y(n.hycK.xiSX)+"___"+n.hycK.WzOH.HtMf,n.WWVs),n.KRoL=n.hycK):n.jVMA(r)}}}else console.log("on receive event1"),"specific_event"===r?s.registerForEvent(y(i.xiSX)+"___"+i.WzOH.HtMf,n.LcWD):n.oiVQ(r);else if(null!=i&&i._timeEnabled){if("session"!=(null==i?void 0:i._time.unit)){var p=S(i._time.unit,i._time.value);"didn't"==(null==i?void 0:i.DIgs)?(n.AueI=!1,n.timerDidnt=setTimeout((function(){n.AueI||(n.ujFS=!0,n.ujFS&&(n.yykF+=1,n.ujFS=n.uJeB(n.yykF,n.hycK.bbeA,n.hycK.nPKa),n.ujFS&&(n.hycK.kQgu=Date.now(),s.validate(n.hEoA,n.QUOi)))),"specific_event"===r&&s.unregisterFromEvent(y(n.hycK.xiSX)+"___"+n.hycK.WzOH.HtMf,n.zIyS),n.LjnR=!1}),p),"specific_event"===r?(s.registerForEvent(y(n.hycK.xiSX)+"___"+n.hycK.WzOH.HtMf,n.zIyS),n.JZcx=n.hycK):n.veVT()):"did"==(null==i?void 0:i.DIgs)&&(console.log("did condition"),n.timerDid=setTimeout((function(){n.lVnk||"specific_event"===r&&s.unregisterFromEvent(y(n.hycK.xiSX)+"___"+n.hycK.WzOH.HtMf,n.WWVs)}),p),"specific_event"===r&&s.registerForEvent(y(n.hycK.xiSX)+"___"+n.hycK.WzOH.HtMf,n.WWVs))}}else"specific_event"===r&&s.registerForEvent(y(i.xiSX)+"___"+o.WzOH.HtMf,n.LcWD);null!==(e=window.ApxorRTM)&&void 0!==e&&e.badgesLists.includes(n.hEoA)&&(console.log("on receive event3"),s.registerForEvent(y(i.xiSX)+"___"+"apxor-badge-container-".concat("-".concat(n.hEoA).replaceAll(" ","").replace(/[^\w\s]/gi,"")),n.LcWD))})),a(this,"oiVQ",(function(e){var t=new ee;"apxor_event"===e?t.registerForEvent("apxor_event",(function(e,t,i,r){n.LcWD(y(n.hycK.xiSX),n.hycK.WzOH.HtMf,i,n.hycK.WzOH.cEHd)})):"customer_event"===e?t.registerForEvent("customer_event",(function(e,t,i,r){n.LcWD(y(n.hycK.xiSX),n.hycK.WzOH.HtMf,i,n.hycK.WzOH.cEHd)})):"any_event"===e?t.registerForEvent("any_event",(function(e,t,i,r){n.LcWD(y(n.hycK.xiSX),n.hycK.WzOH.HtMf,i,n.hycK.WzOH.cEHd)})):"campaign_event"===e?t.registerForEvent("campaign_event",(function(e,t,i,r){n.LcWD(y(n.hycK.xiSX),n.hycK.WzOH.HtMf,i,n.hycK.WzOH.cEHd)})):"survey_event"===e&&t.registerForEvent("survey_event",(function(e,t,i,r){n.LcWD(y(n.hycK.xiSX),n.hycK.WzOH.HtMf,i,n.hycK.WzOH.cEHd)}))})),a(this,"xMLB",(function(e){console.log("in new TMtM");var t=new ee,i=n.hycK._eventCategory;"apxor_event"===i?t.unregisterFromEvent("apxor_event",n.zIyS):"customer_event"===i?t.unregisterFromEvent("customer_event",n.zIyS):"any_event"===i?t.unregisterFromEvent("any_event",n.zIyS):"campaign_event"===i?t.unregisterFromEvent("campaign_event",n.zIyS):"survey_event"===i&&t.unregisterFromEvent("survey_event",n.zIyS)})),a(this,"veVT",(function(){console.log("in new TMtM");var e=new ee,t=n.hycK._eventCategory;"apxor_event"===t?e.registerForEvent("apxor_event",n.zIyS):"customer_event"===t?e.registerForEvent("customer_event",n.zIyS):"any_event"===t?e.registerForEvent("any_event",n.zIyS):"campaign_event"===t?e.registerForEvent("campaign_event",n.zIyS):"survey_event"===t&&e.registerForEvent("survey_event",n.zIyS)})),a(this,"jVMA",(function(){var e=new ee,t=n.hycK._eventCategory;"apxor_event"===t?e.registerForEvent("apxor_event",n.WWVs):"customer_event"===t?e.registerForEvent("customer_event",n.WWVs):"any_event"===t?e.registerForEvent("any_event",n.WWVs):"campaign_event"===t?e.registerForEvent("campaign_event",n.WWVs):"survey_event"===t&&e.registerForEvent("survey_event",n.WWVs)})),a(this,"MFad",(function(){var e=new ee,t=n.hycK._eventCategory;"apxor_event"===t?e.unregisterFromEvent("apxor_event",n.WWVs):"customer_event"===t?e.unregisterFromEvent("customer_event",n.WWVs):"any_event"===t?e.unregisterFromEvent("any_event",n.WWVs):"campaign_event"===t?e.unregisterFromEvent("campaign_event",n.WWVs):"survey_event"===t&&e.unregisterFromEvent("survey_event",n.WWVs)})),a(this,"kxBD",(function(){var e=n.uGEO,t=ee.getInstance();n.LjnR=!0,t.registerForEvent(y(e.xiSX)+"___"+e.WzOH.HtMf,n.XAHz)})),a(this,"dyDx",(function(e,t,i,r){var o,s=(Date.now()-n.BryZ[t])/1e3;(null===(o=n.hycK)||void 0===o||null===(o=o.WzOH)||void 0===o||null===(o=o.cEHd)||void 0===o?void 0:o.time)/1e3>s&&n._displayCampaign(i)})),a(this,"biBL",(function(e,t,i,r){var o,s;n.AueI=!0;var a=Date.now(),u=null===(o=n.hycK)||void 0===o||null===(o=o.pjrO)||void 0===o?void 0:o.WzOH.HtMf,l=(a-n.BryZ[u])/1e3,c=null===(s=n.hycK)||void 0===s||null===(s=s.WzOH)||void 0===s||null===(s=s.cEHd)||void 0===s?void 0:s.time;(c/=1e3)>l&&n._displayCampaign(i)})),a(this,"WWVs",(function(){n.lVnk=!0,console.log("configitem kpi check2");var e=new ee;clearTimeout(n.timerDid),n.yykF+=1,n.ujFS=n.uJeB(n.yykF,n.hycK.bbeA,n.hycK.nPKa),n.ujFS&&(e.unregisterFromEvent(y(n.KRoL.xiSX)+"___"+n.KRoL.WzOH.HtMf,n.WWVs),e.validate(n.hEoA,n.QUOi,n.QuCx))})),a(this,"zIyS",(function(e,t,i,r){n.AueI=!0,clearTimeout(n.timerDidnt),console.log("received event for nkpi"),(new ee).unregisterFromEvent(y(n.JZcx.xiSX)+"___"+n.JZcx.WzOH.HtMf,n.zIyS)})),a(this,"LcWD",(function(t,i,r,o){var s,a;console.log("in onreceive event"),console.log("across session value is ",n.across_sessions);var u=ee.getInstance();if(n.LjnR){if(null!==(s=window.ApxorRTM)&&void 0!==s&&s.isBadgePresent&&null!==(a=window.ApxorRTM)&&void 0!==a&&a.badgesLists.includes(n.hEoA)&&e.getController().isBadgeTriggerSatisfied(n.hEoA))return n.ujFS=!0,n.hycK.kQgu=r,void u.validate(n.hEoA,n.QUOi);if(y(n.hycK.xiSX)===t&&n.RyFg(r-n.hycK.pjrO.kQgu,n.hycK.CbSj)&&n.hycK.WzOH.HtMf===i&&n.oesp(n.hycK.WzOH.cEHd,o)&&(console.log("increasing satisfaction count for",n.hycK.WzOH.HtMf),n.yykF+=1,n.ujFS=n.uJeB(n.yykF,n.hycK.bbeA,n.hycK.nPKa),n.ujFS)){if(n.hycK.kQgu=r,n.across_sessions){var l=S(n.hycK._time.unit,n.hycK._time.value),c=n.hycK._timeEnabled,v=n.hycK._id,d=n.yykF;n.amCY(n.hycK.DIgs,i,r,o,l,c,v,d)}u.validate(n.hEoA,n.QUOi,n.QuCx)}}else if(n.LjnR=n.NPDD(t,i,r,o),n.LjnR){var h=n.hycK,p=h.pjrO;if(p.kQgu=r,"activity_time"===(null==h?void 0:h.xiSX)){var g,f,_,E,x=null==h||null===(g=h.WzOH)||void 0===g||null===(g=g.cEHd)||void 0===g?void 0:g.time;(null==h||null===(f=h.yixU)||void 0===f?void 0:f.length)>0?setTimeout((function(){var t;(null===(t=e.getController())||void 0===t?void 0:t._appEventsNoKpi).length<=2&&h.yixU===location.pathname&&n._displayCampaign(r)}),x):(null==h||null===(_=h.WzOH)||void 0===_||null===(_=_.cEHd)||void 0===_?void 0:_.nkpi.length)>0?(setTimeout((function(){n.AueI||(n.ujFS=!0,n.ujFS&&(n.yykF+=1,n.ujFS=n.uJeB(n.yykF,n.hycK.bbeA,n.hycK.nPKa),n.ujFS&&(n.hycK.kQgu=r,u.validate(n.hEoA,n.QUOi)))),h.WzOH.cEHd.nkpi.map((function(e){u.unregisterFromEvent(m(h.WzOH.cEHd.et)+"___"+e,n),n.LjnR=!1}))}),x),h.WzOH.cEHd.nkpi.map((function(e){u.registerForEvent(m(h.WzOH.cEHd.et)+"___"+e,n.zIyS)}))):(null==h||null===(E=h.WzOH)||void 0===E||null===(E=E.cEHd)||void 0===E?void 0:E.kpi.length)>0&&(setTimeout((function(){h.WzOH.cEHd.kpi.map((function(e){u.unregisterFromEvent(m(h.WzOH.cEHd.et)+"___"+e,n)}))}),x),h.WzOH.cEHd.kpi.map((function(e){e===h.pjrO.WzOH.HtMf?(u.unregisterFromEvent(y(p.xiSX)+"___"+p.WzOH.HtMf,n),u.registerForEvent(m(h.WzOH.cEHd.et)+"___"+e,n.dyDx)):u.registerForEvent(m(h.WzOH.cEHd.et)+"___"+e,n.biBL)})))}else u.unregisterFromEvent(y(p.xiSX)+"___"+p.WzOH.HtMf,n),u.registerForEvent(y(h.xiSX)+"___"+h.WzOH.HtMf,n);n.BryZ[i]=Date.now()}})),a(this,"XAHz",(function(e,t,i,r){var o=ee.getInstance();y(n.uGEO.xiSX)===e&&n.RyFg(i,n.uGEO.CbSj)&&n.uGEO.WzOH.HtMf===t&&n.oesp(n.uGEO.WzOH.cEHd,r)&&(console.log("increasing satisfaction count for termination",n.hycK.WzOH.HtMf),n.yykF+=1,n.ujFS=n.uJeB(n.yykF,n.uGEO.bbeA,n.uGEO.nPKa),n.ujFS&&(n.uGEO.kQgu=i,o.validateForTermination(n.hEoA,n.QUOi)))})),a(this,"NPDD",(function(e,t,i,r){var o=n.hycK.pjrO,s=y(o.xiSX)===e&&o.WzOH.HtMf===t&&n.RyFg(i,o.CbSj)&&n.oesp(o.WzOH.cEHd,r);return s="APX_PAGE_OPENED"===t?s&&location.pathname===o.WzOH.amMD:s})),a(this,"RyFg",(function(e,t){var n=Math.ceil(e);return n>t.SmCD&&n<t.rANh})),a(this,"uJeB",(function(e,t,i){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];switch(r&&n.hycK.OvxW&&(e+=n.GrVZ),i){case"EQ":return e===t;case"GT":return e>t;case"GTE":return e>=t;case"LT":return e<t;case"LTE":return e<=t;default:return!1}})),a(this,"oesp",(function(e,t){var n=!0;try{var r,o=function(){if(!1===n)return{v:!1};if("object"===i(e[s])){var r,o,a,u=e[s].op,l=e[s].t;if("s"===l)a=e[s].val;else if("l"===l||"f"===l)a=parseFloat(e[s].val);else if("b"===l)switch(e[s].val){case"true":a=!0;break;case"false":a=!1;break;default:a=e[s].val}var c,v=(Array.isArray(t[s])?t[s]:[t[s]]).some((function(e){return"s"===l?e="".concat(e):"l"===l?e=parseInt(e):"f"===l?e=parseFloat(e):"b"===l&&(e=!!e),E(e,a,u)}));if(!(null===(r=e[s])||void 0===r||!r.present)&&(null===(o=e[s])||void 0===o?void 0:o.present))c=!!t.hasOwn(t,s),n=n&&c;n=n&&v}else n=n&&E(t[s],e[s],"EQ")};for(var s in e)if(r=o())return r.v}catch(e){I.error(e),n=!1}return n})),a(this,"amCY",(function(t,i,r,o,s,a,u,l){console.log("persisting satisfied conditions");var c,v=!1;n.no_KPI_TriggerDetails=e.getController().getFromStorage("apx_nokpi_triggerdetails"),null===n.no_KPI_TriggerDetails||void 0===n.no_KPI_TriggerDetails?n.no_KPI_TriggerDetails=[]:n.no_KPI_TriggerDetails=JSON.parse(n.no_KPI_TriggerDetails);var d,h=0;a&&(h=Date.now()+s);for(var p=0;p<n.no_KPI_TriggerDetails.length;p++)if(n.no_KPI_TriggerDetails[p].id===u){v=!0,c=n.no_KPI_TriggerDetails[p];break}v?c.satisfiedCount+=1:(d={id:u,type:t,time:r,name:i,additionalInfo:o,satisfiedCount:l,timeBased:a,finishTime:h},n.no_KPI_TriggerDetails.push(d)),e.getController().persistToStorage("apx_nokpi_triggerdetails",JSON.stringify(n.no_KPI_TriggerDetails))})),a(this,"Anei",(function(e){console.log("unregister all conditions");var t,i=new ee,r=v(e);try{for(r.s();!(t=r.n()).done;){var o=t.value;if(1===(null==o?void 0:o.length)||void 0===(null==o?void 0:o.length))i.unregisterFromEvent(y(null==o?void 0:o.hycK.xiSX)+"___"+(null==o?void 0:o.hycK.WzOH.HtMf),n.LcWD);else{var s,a=v(o);try{for(a.s();!(s=a.n()).done;){var u,l=s.value;i.unregisterFromEvent(y(null==l?void 0:l.hycK.xiSX)+"___"+(null==l||null===(u=l.hycK)||void 0===u?void 0:u.WzOH.HtMf),n.LcWD)}}catch(e){a.e(e)}finally{a.f()}}}}catch(e){r.e(e)}finally{r.f()}}))}return s(t,[{key:"_displayCampaign",value:function(e){console.log("in display campaign");var t=ee.getInstance();this.ujFS=!0,this.ujFS&&(this.yykF+=1,this.ujFS=this.uJeB(this.yykF,this.hycK.bbeA,this.hycK.nPKa),this.ujFS&&(this.hycK.kQgu=e,t.validate(this.hEoA,this.QUOi)))}}]),t}(),M=window.ApxorLogger,z=s((function t(){var n=this;r(this,t),a(this,"bbeA",0),a(this,"BSwP",0),a(this,"VbvL","SESSION"),a(this,"IHYY",0),a(this,"gEzC",0),a(this,"kgir",0),a(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{n.hEoA=e._id,n.tuOh=e.meta,n.bbeA=e.frequency.count,-1===n.bbeA&&(n.bbeA=1e3),n.kgir=n.bbeA,n.BSwP=e.frequency.time_interval,n.VbvL=e.frequency.validity,n.gEzC=e.frequency.ses_lmt,n._dayCount=e.frequency.day_lmt;var t=ee.getInstance().getQeState();if(!p(t)||!p(t[e._id]))return!0;if("SESSION"===n.VbvL){if(n.bbeA=parseInt(n.bbeA)-parseInt(t[e._id].SESSION),n.bbeA<=0)return n.Nmpt("Session limit reached"),console.warn("Max count limit reached for session:"+e._id),!1}else{if("OVERALL"!==n.VbvL)return M.info("Invalid config."),!1;if(n.bbeA=parseInt(n.bbeA)-parseInt(t[e._id].OVERALL),n.bbeA<=0)return n.Nmpt("Overall limit reached"),console.warn("Max count limit reached for overall:"+e._id),!1}}catch(e){return M.error(e),!1}return!0})),a(this,"owMI",(function(){n.bbeA=n.bbeA-1})),a(this,"getFrequencyCount",(function(){return n.bbeA})),a(this,"aZZC",(function(){"SESSION"===n.VbvL&&(n.bbeA=n.kgir,M.info("Campaign Limit reset"))})),a(this,"rWCY",(function(e){try{if(n.bbeA<=0)return"OVERALL"===n.VbvL?n.Nmpt("Overall limit reached"):"SESSION"===n.VbvL&&n.Nmpt("Session limit reached"),!1;var t=ee.getInstance().getQeState();if(!p(t)||!p(t[e]))return!0;if(0!==n.gEzC)if(parseInt(n.gEzC)-parseInt(t[e].SESSION)<=0)return n.Nmpt("Session limit reached"),!1;if(0!==n._dayCount){var i,r=T();if(parseInt(n._dayCount)-parseInt((null===(i=t[e])||void 0===i?void 0:i.DATES[r])||0)<=0)return n.Nmpt("Day limit reached"),!1}}catch(e){n.Nmpt("Error validating the frequency: ".concat(e)),M.error("Error validating the frequency:"+e)}return!0})),a(this,"Nmpt",(function(t){var i;null==e||e.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===n.tuOh.type?"survey":"campaign",apx_nudge_id:n.hEoA,apx_nudge_name:n.tuOh.name,apx_variant_code:n.tuOh.isExperiment||n.tuOh.only_context?null===(i=n.tuOh.attr)||void 0===i?void 0:i.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:t})}))})),L=window.ApxorLogger,N=s((function e(){var t=this;r(this,e),a(this,"LdAb",[]),a(this,"MqDt",0),a(this,"xjuS",!1),a(this,"DVZi",void 0),a(this,"initialize",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"unordered",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],s=arguments.length>5?arguments[5]:void 0,a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];t.hEoA=n,t.QUOi=i,t.URig=o,t.xJLp=r,t.across_sessions=a;var u=[];t.MqDt=e.length;try{if(null!=u)return r=null==e?void 0:e.sequence_type,u=t.wUYy(e,t.MqDt),"unordered"!==s&&0!==t.QUOi||t.TMtM(),t.LdAb}catch(e){return L.error(e),!1}})),a(this,"wUYy",(function(e,n){for(var i=0;i<n;i++){t.DVZi=new C;try{t.DVZi.initialize(e[i],t.hEoA,t.QUOi,t.xJLp,t.vDdq,t.across_sessions,"",-1,!1)&&(t.LdAb.push(t.DVZi),t.LdAb.sequence_type=t.xJLp)}catch(e){L.error(e)}}return t.LdAb})),a(this,"TMtM",(function(){if("ordered"===t.xJLp||"strictly_ordered"===t.xJLp)t.LdAb[0].TMtM(0);else{var e,n=v(t.LdAb);try{for(n.s();!(e=n.n()).done;){e.value.TMtM()}}catch(e){n.e(e)}finally{n.f()}}})),a(this,"Anei",(function(e){console.log("unregister all conditions group"),t.DVZi.Anei(e)}))})),j=s((function e(){var t=this;r(this,e),a(this,"HtMf",""),a(this,"DIgs",""),a(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var n,i;t.HtMf=e.meta.name,t.DIgs=e.meta.type,t._only_context=e.meta.only_context,t._attr=(null===(n=e.meta)||void 0===n?void 0:n.attr)||{},t._isExperiment=null===(i=e.meta)||void 0===i?void 0:i.isExperiment}catch(e){return window.ApxorLogger.error(e),!1}return!0}))})),k=window.ApxorLogger,V=s((function t(){var n=this;r(this,t),a(this,"plwH",[]),a(this,"_ret_day",{}),a(this,"vxeh",{}),a(this,"dZpQ",!1),a(this,"DZVs",!1),a(this,"retainedDaysValidated",!0),a(this,"retainedSessionValidated",!0),a(this,"eventDoneInLT",!1),a(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{n.plwH=e.overall_cfg.events,n._ret_day=e.overall_cfg.ret_day,n.vxeh=e.overall_cfg.session,n.dZpQ=e.overall_cfg.toggleRetDay,n.DZVs=e.overall_cfg.toggleSession}catch(e){return k.error(e),!1}return!0})),a(this,"validate",(function(){var t=parseInt(e.getController().getFromStorage("apx_retained_days")),i=parseInt(e.getController().getFromStorage("apx_retained_session"));if(n.dZpQ&&!isNaN(t)&&!(t>=n._ret_day.from&&t<=n._ret_day.to))return n.retainedDaysValidated=!1,!1;if(n.DZVs&&!isNaN(i)&&!(i>=n.vxeh.from&&i<=n.vxeh.to))return n.retainedSessionValidated=!1,!1;try{for(var r=e.getController().getFromStorage("_apx_lt_count"),o=e.getSiteId(),s=JSON.parse((new TextDecoder).decode(function(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),i=0;i<e.length;i++)n[i]=e.charCodeAt(i);return t}(_(o,r)))),a=0;a<n.plwH.length;a++){if(s[n.plwH[a].name.replace("'","").replace("â€™","")])return n.eventDoneInLT=!0,!1}}catch(e){k.error("Failed to validate the lt count:"+e)}return!0}))})),P=window.ApxorLogger,R=s((function e(){var t=this;r(this,e),a(this,"tqNG",[]),a(this,"gxmp",[]),a(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(t.tqNG=e.attributes.user,t.gxmp=e.attributes.session,!Array.isArray(t.tqNG)||!Array.isArray(t.gxmp))return P.error("No attributes"),!1}catch(e){return P.error(e),!1}return!0})),a(this,"validate",(function(e,n){return t.VVIM(e,t.tqNG)&&t.VVIM(n,t.gxmp)})),a(this,"VVIM",(function(e,t){var n=t.length,i=!0;try{for(var r,o=function(){var n=t[s];if(!e[n.name]||!1===i)return{v:!1};var r=n.operator,o=n.type,a=n.value.map((function(e){return"s"===o?e:"l"===o?parseInt(e):"f"===o?parseFloat(e):void 0})),u=(Array.isArray(e[n.name])?e[n.name]:[e[n.name]]).some((function(e){return a.some((function(t){return E(e,t,r)}))}));i=i&&u},s=0;s<n;s++)if(r=o())return r.v}catch(e){P.error(e),i=!1}return i}))})),J=s((function t(){var n=this;r(this,t),a(this,"zypN",e.getController()),a(this,"type",""),a(this,"_duration_seconds",0),a(this,"pZBo",1),a(this,"parse",(function(e){try{var t,i,r;if(n.DIgs=null===(t=e.terminate_info.time_based)||void 0===t?void 0:t.type,n._duration_seconds=null===(i=e.terminate_info)||void 0===i?void 0:i.time_based.duration_seconds,n.pZBo=null===(r=e.terminate_info.time_based)||void 0===r?void 0:r.days,n.FiZC(e._id))return n.zypN.persistTerminationInfoLocally(e._id),!1}catch(e){return!1}return!0})),a(this,"FiZC",(function(e){var t,i=JSON.parse(n.zypN.getFromStorage("apx_termination_ID"));if(!i[e]||null===(t=i[e])||void 0===t||!t.startDate)return!1;var r,o=new Date(i[e].startDate),s=new Date((r=new Date).getMonth()+"/"+r.getDate()+"/"+r.getFullYear()),a=parseInt((s-o)/864e5,10),u=function(){var e=new Date;return{hours:e.getHours(),mins:e.getMinutes()}}(),l=i[e].ShOF;return a===n.pZBo&&u.hours>=l.hours||a>n.pZBo||i[e].goalAcheived}))})),X=s((function e(){var t=this;r(this,e),a(this,"enable_goal_events",!1),a(this,"attributes",{}),a(this,"cgmr",new R),a(this,"XsFf",new J),a(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var n,i,r;if(t.enable_time_based=null==e||null===(n=e.terminate_info)||void 0===n?void 0:n.enable_time_based,t.enable_time_based&&!t.XsFf.parse(e))return!1;if(t.enable_goal_events=null==e||null===(i=e.terminate_info)||void 0===i?void 0:i.enable_goal_events,t.enable_attributes=null==e||null===(r=e.terminate_info)||void 0===r?void 0:r.enable_attributes,t.enable_attributes&&!t.cgmr.parse(e.terminate_info))return!1}catch(e){return window.ApxorLogger.error(e),!1}return!0})),a(this,"validate",(function(e,n){return t.cgmr.validate(e,n)}))})),U=window.ApxorLogger,q=s((function e(){var t=this;r(this,e),a(this,"DuWr",-1),a(this,"jLdJ",-1),a(this,"ShOF",-1),a(this,"DjWs",-1),a(this,"saae",!1),a(this,"_nudge_expired",!1),a(this,"_not_yet_active",!1),a(this,"_not_in_specified_time",!1),a(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(isNaN(Date.parse(e.validity.start_date))||isNaN(Date.parse(e.validity.end_date)))return U.error("Not valid dates"),!1;if(t.DuWr=Date.parse(e.validity.start_date),t.jLdJ=Date.parse(e.validity.end_date),p(e.at_specific_time)&&(t.saae=e.at_specific_time,t.saae&&p(e.time_limits))){var n=(new Date).toISOString().split("T")[0];if(t.ShOF=Date.parse(n+"T"+e.time_limits.start_time+":00.000Z"),t.DjWs=Date.parse(n+"T"+e.time_limits.end_time+":00.000Z"),isNaN(t.ShOF)||isNaN(t.DjWs))return U.error("Not valid times"),!1}}catch(e){return U.error(e),!1}return!0})),a(this,"validate",(function(){var e=Date.now();return e>t.DuWr&&e<t.jLdJ?(!t.saae||e>=t.ShOF&&e<=t.DjWs||(t._not_in_specified_time=!0),!t.saae||e>=t.ShOF&&e<=t.DjWs):(e<t.DuWr?t._not_yet_active=!0:e>t.jLdJ&&(t._nudge_expired=!0),!1)}))})),G=window.ApxorLogger,Q=s((function t(){var i=this;r(this,t),a(this,"mpTp",[]),a(this,"kMrh",[]),a(this,"hEoA",""),a(this,"tuOh",new j),a(this,"UnXX",new b),a(this,"VbvL",new q),a(this,"HgLu",new z),a(this,"YDSC",new V),a(this,"bAdf",new X),a(this,"xJLp",!1),a(this,"vDdq",[]),a(this,"_variant_code",""),a(this,"xjuS",!1),a(this,"groupCombineOperator","OR"),a(this,"AueI",!1),a(this,"YxhJ",!1),a(this,"LoFU",void 0),a(this,"timeForKPI",void 0),a(this,"kpiIndex",0),a(this,"jYOx",void 0),a(this,"_across_sessions",!1),a(this,"feTW",void 0),a(this,"Tguz",!1),a(this,"AXyl",void 0),a(this,"gsoo",void 0),a(this,"OuNv",void 0),a(this,"MCaT",void 0),a(this,"ymJc",void 0),a(this,"NJPn",void 0),a(this,"ioLQ",void 0),a(this,"KGKt",void 0),a(this,"rrek",void 0),a(this,"NbsT",void 0),a(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var t,n;if(!p(e._id))return G.error("No Id"),!1;if(!p(e.enabled)||!e.enabled)return G.error("Not enabled"),!1;if(!(i.tuOh.parse(e)&&i.VbvL.parse(e)&&i.HgLu.parse(e)&&i.UnXX.parse(e)&&i.YDSC.parse(e)&&i.bAdf.parse(e)))return!1;if(i._variant_code=i.tuOh._isExperiment||i.tuOh._only_context?null===(t=i.tuOh._attr)||void 0===t?void 0:t.apx_variant_code:"TG",i._across_sessions=!(null==e||!e.across_sessions)&&(null==e?void 0:e.across_sessions),!p(e.conditions)||!Array.isArray(e.conditions))return G.error("No valid conditions",e.conditions),!1;i.hEoA=e._id,i.xJLp=!!p(e.sequence_enabled)&&e.sequence_enabled,p(e.conditions_v2)&&(i.xJLp=null==e?void 0:e.sequence_type),!0===i.xJLp&&e.conditions.sort((function(e,t){return e.sequence<t.sequence})),p(e.conditions_v2)?(n=e.conditions_v2,i.Tguz=!0):n=e.conditions,i.feTW=n;var r=n.length;if(i.NbsT=r,i.nKAR(n,r),console.log(i.mpTp),i.Vsty(),console.log(i.mpTp),i.bAdf.enable_goal_events)for(var o=e.terminate_info.goal_events.events,s=o.length,a=0;a<s;a++){var u=new C;u.initialize(o[a],i.hEoA,a,!0,[],i._across_sessions,"termination")&&i.kMrh.push(u)}return console.log("conditional validator parse"),i.mpTp.length>0}catch(e){return G.error(e),!1}})),a(this,"nKAR",(function(e,t){for(var n=0;n<t;n++){i.vDdq=[];var r=e[n];if("group"===(null!=r&&r.condition_type?null==r?void 0:r.condition_type:"single")){var o=r.conditions_v2;i.groupCombineOperator=r.combine_operator;var s=null==r?void 0:r.sequence_type;i.rrek=new N;var a=i.rrek.initialize(o,i.hEoA,n,s,i.vDdq,i.xJLp,i._across_sessions);i.mpTp.push(a),console.log(i.rrek)}else{if("didn't"===r.type){var l,c={trigger_key:r.trigger.details.name,no_kpi_array:null==r||null===(l=r.details)||void 0===l||null===(l=l.additional_info)||void 0===l?void 0:l.nkpi,condition_id:null==r?void 0:r._id,time_bounds:r.time_bounds.upper};i.vDdq=[].concat(u(i.vDdq),[c])}i.rrek=new C,i.rrek.initialize(r,i.hEoA,n,i.xJLp,i.vDdq,i._across_sessions)&&(i.mpTp.push(i.rrek),console.log(i.mpTp))}}})),a(this,"Vsty",(function(){if(i._across_sessions&&"ordered"===i.xJLp){var t=!1;console.log("across_sesions_case");var n=e.getController().getFromStorage("apx_nokpi_triggerdetails");if(null!=(n=JSON.parse(n))&&null!=n)for(var r=function(e){var r,o,s;if(null!==(r=i.mpTp[e])&&void 0!==r&&null!==(r=r.hycK)&&void 0!==r&&r._timeEnabled&&void 0===i.mpTp[e].length){if("didn't"===i.mpTp[e].hycK.DIgs){var a=i.mpTp[e].hycK._id,u=i.mrpm(a,n);if(u)if(Date.now()>u.finishTime)i.mpTp[e].ujFS=!0,i.mpTp[e].yykF=u.satisfiedCount,t=!0;else{var l=u.finishTime-Date.now(),c=i.mpTp[e].hycK._eventCategory?i.mpTp[e].hycK._eventCategory:"specific_event",v=new ee;"specific_event"===c?(v.registerForEvent(y(i.mpTp[e].hycK.xiSX)+"___"+i.mpTp[e].hycK.WzOH.HtMf,i.zIyS),i.ymJc=i.mpTp[e]):i.veVT(c),setTimeout((function(){e!==i.mpTp.length-1||i.AueI||(i.mpTp[e].ujFS=!0,i.mpTp[e].yykF=u.satisfiedCount,t=!0,"specific_event"===c?v.unregisterFromEvent(y(i.mpTp[e].hycK.xiSX)+"___"+i.mpTp[e].hycK.WzOH.HtMf,i.zIyS):i.Yigt(i.mpTp[e]),i.oiHA())}),l)}}if("did"===i.mpTp[e].hycK.DIgs){var d=i.mpTp[e].hycK._id,h=i.mrpm(d,n);if(h)if(null==h.satisfiedCount){if(Date.now()<h.finishTime){console.log("time is left will add set time out again"),i.OuNv=h,i.gsoo=e;var p=h.finishTime-Date.now(),g=i.mpTp[e].hycK._eventCategory?i.mpTp[e].hycK._eventCategory:"specific_event",f=new ee;"specific_event"===g?f.registerForEvent(y(i.mpTp[e].hycK.xiSX)+"___"+i.mpTp[e].hycK.WzOH.HtMf,i.WGQT):i.veVT(g),setTimeout((function(){"specific_event"===g?f.unregisterFromEvent(y(i.mpTp[e].hycK.xiSX)+"___"+i.mpTp[e].hycK.WzOH.HtMf,i.WGQT):i.Yigt(i.mpTp[e])}),p)}}else i.mpTp[e].yykF=h.satisfiedCount,i.mpTp[e].ujFS=!0}}else t=i.weFW(e,n);t&&(null===(o=i.mpTp[e])||void 0===o||null===(o=o.hycK)||void 0===o||!o._timeEnabled||(null===(s=i.mpTp[e])||void 0===s?void 0:s.length)>1)?e===i.mpTp.length-1&&i.oiHA():t||void 0===!i.mpTp[e].length&&i.mpTp[e].TMtM()},o=0;o<i.mpTp.length;o++)r(o)}else if(i._across_sessions&&"unordered"===i.xJLp){var s=e.getController().getFromStorage("apx_nokpi_triggerdetails");if(null!=(s=JSON.parse(s))&&null!=s)for(var a=0;a<i.mpTp.length;a++)i.weFW(a,s)}})),a(this,"weFW",(function(e,t){if(void 0===i.mpTp[e].length||1===i.mpTp[e].length){var n=i.mpTp[e].hycK._id,r=!1,o=i.mrpm(n,t);if(o)i.AXyl=o,r=(new C).uJeB(o.satisfiedCount,i.mpTp[e].hycK.bbeA,i.mpTp[e].hycK.nPKa),o&&(r?i.mpTp[e].ujFS=!0:i.mpTp[e].yykF=o.satisfiedCount);else i.mpTp[e].TMtM();return r}if(i.mpTp[e].length>=1){var s,a,u;if("ordered"===(a=null===(s=i.mpTp[e])||void 0===s?void 0:s.sequence_type)||"strictly_ordered"===a){for(var l=0;l<i.mpTp[e].length;l++){var c=i.mpTp[e][l],v=c.hycK._id;u=!1;var d=i.mrpm(v,t);if(d){if(u=(new C).uJeB(d.satisfiedCount,c.hycK.bbeA,c.hycK.nPKa),d)if(u){i.mpTp[e][l].ujFS=!0;var g=l+1;console.log("nested and then");var f=i.mpTp[e][l+1];void 0===f&&p(i.mpTp[e+1])&&(i.mpTp[e+1].TMtM(),u=!0),null!=f&&i.mpTp[e][l+1].TMtM(g)}else i.mpTp[e][l].yykF=d.satisfiedCount}else(p(i.mpTp[e][l-1])&&!0===i.mpTp[e][l].ujFS||h(i.mpTp[e][l-1]))&&i.mpTp[e][l].TMtM()}return u}for(var _,y=0;y<i.mpTp[e].length;y++){var m=i.mpTp[e][0].hycK.yWtP;_="OR"!==m;var E=i.mpTp[e][y],S=E.hycK._id;u=!1;var x=i.mrpm(S,t);if(x)u=(new C).uJeB(x.satisfiedCount,E.hycK.bbeA,E.hycK.nPKa),x&&(u?i.mpTp[e][y].ujFS=!0:i.mpTp[e][y].yykF=x.satisfiedCount);else E.TMtM();_="AND"===m?_&&u:_||u}return _}})),a(this,"mrpm",(function(e,t){return t.find((function(t){return t.id===e}))})),a(this,"LKRo",(function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;console.log("coming to LKRo");var r=ee.getInstance();if(!(t<0)){var o=i.mpTp[t],s="unordered";if((null==o?void 0:o.length)>1&&(s=null==o?void 0:o.sequence_type),!0===i.xJLp||"ordered"===i.xJLp||"strictly_ordered"===i.xJLp||"ordered"===s||"strictly_ordered"===s){console.log("respect sequence ordered"),i.kpiIndex=t+1;var a=i.mpTp[t];if((null==a?void 0:a.length)>0){if(p(a))if("unordered"===i.xJLp&&"ordered"===s){var u=o[n-1];if(p(u))if(void 0===u.length||1==u.length){if(!u.ujFS)return}else if(u.length>1&&!i.SHUo(u))return;var l,c=o[n+1];if(p(c)){if(c.TMtM(n+1),"strictly_ordered"===i.xJLp){i._currentEventname=a[n].hycK.WzOH.HtMf;var d=e.getController();d.registerForEvent("APP_EVENT",i.zHWU),d.registerForEvent("CLIENT_EVENT",i.zHWU)}}else if("strictly_ordered"===s)1!=i.xjuS&&i.oiHA();else(null===(l=o[n])||void 0===l?void 0:l.length)>0?i.SHUo(o)&&i.oiHA():i.oiHA()}else{var h,g=i.mpTp[t-1];if(p(g))if(void 0===g.length||1==g.length){if(!g.ujFS)return}else if(g.length>1&&!i.SHUo(g))return;if(void 0===a.length||1===a.length?h=i.mpTp[t+1]:a.length>1&&("ordered"===s||"strictly_ordered"===s?h=n===a.length-1?i.mpTp[t+1]:i.mpTp[t][n+1]:i.SHUo(a)&&(h=i.mpTp[t+1])),p(h)){if(void 0===h.length||1===h.length)h.TMtM(n+1);else if(i.SHUo(a))if(void 0===h.length)h.TMtM();else if(h.length>1)if("unordered"===h.sequence_type)for(var f=0;f<h.length;f++)h[f].TMtM(f);else"ordered"!==h.sequence_type&&"strictly_ordered"!==h.sequence_type||h[0].TMtM(0);if("strictly_ordered"===i.xJLp){i._currentEventname=a[n].hycK.WzOH.HtMf;var _=e.getController();_.registerForEvent("APP_EVENT",i.zHWU),_.registerForEvent("CLIENT_EVENT",i.zHWU)}}else"strictly_ordered"===i.xJLp?1!=i.xjuS&&i.oiHA():i.SHUo(a)&&i.oiHA()}}else if(p(a)&&a.ujFS){a.BryZ[a.hycK.WzOH.HtMf]=Date.now();var m=i.mpTp[t-1];if(p(m))if(void 0===m.length||1==m.length){if(!m.ujFS)return}else if(m.length>1&&!i.SHUo(m))return;var E=i.mpTp[t+1];if(p(E)){var x,T;if(null!=E&&null!==(x=E.hycK)&&void 0!==x&&x._timeEnabled){if("session"!=(null===(T=E.hycK)||void 0===T?void 0:T._time.unit)){var O,b,K=S(E.hycK._time.unit,E.hycK._time.value);if("didn't"==(null===(O=E.hycK)||void 0===O?void 0:O.DIgs)){if(i.ioLQ=setTimeout((function(){if(!i.AueI){if(E.ujFS=!0,E.ujFS){E.yykF+=1;var e=new C;if(E.ujFS=e.uJeB(E.yykF,E.hycK.bbeA,E.hycK.nPKa),console.log("expected here"),E.ujFS){E.hycK.kQgu=Date.now();var n=t+1,o=i.mpTp[n+1];p(o)?(console.log("registering next condition"),o.TMtM()):i.oiHA()}}r.unregisterFromEvent(y(E.hycK.xiSX)+"___"+E.hycK.WzOH.HtMf,i.zIyS),E.LjnR=!1}}),K),console.log("expected here"),i._across_sessions){var A=S(E.hycK._time.unit,E.hycK._time.value),F=E.hycK._timeEnabled,H=E.hycK._id,W=new C;W.amCY(E.hycK.DIgs,E.hycK.WzOH.HtMf,Date.now(),E.hycK.WzOH.cEHd,A,F,H)}console.log(E.hycK._timeEnabled),"specific_event"===E.hycK._eventCategory?(r.registerForEvent(y(E.hycK.xiSX)+"___"+E.hycK.WzOH.HtMf,i.zIyS),i.ymJc=E):i.veVT(E)}else if("did"==(null===(b=E.hycK)||void 0===b?void 0:b.DIgs)&&(i.AueI=!1,i.jYOx=E,p(i.mpTp[t+2])&&i._across_sessions&&(i.MCaT=i.mpTp[t+2]),i.KGKt=setTimeout((function(){i.AueI||(i.AueI=!1,r.unregisterFromEvent(y(E.hycK.xiSX)+"___"+E.hycK.WzOH.HtMf,i.biBL))}),K),i.LoFU=a,i.timeForKPI=K,r.registerForEvent(y(E.hycK.xiSX)+"___"+E.hycK.WzOH.HtMf,i.biBL),i.NJPn=E,console.log("error check"),i._across_sessions)){var D=S(E.hycK._time.unit,E.hycK._time.value),w=E.hycK._timeEnabled,I=E.hycK._id,M=new C;M.amCY(E.hycK.DIgs,E.hycK.WzOH.HtMf,Date.now(),E.hycK.WzOH.cEHd,D,w,I)}}}else if(E.length>0)if("ordered"===E.sequence_type||"strictly_ordered"===E.sequence_type)E[0].TMtM(n+1);else{var z,L=v(E);try{for(L.s();!(z=L.n()).done;){var N=z.value;N.TMtM()}}catch(e){L.e(e)}finally{L.f()}}else E.TMtM();if(console.log("validating second condition"),"strictly_ordered"===i.xJLp){i._currentEventname=a.hycK.WzOH.HtMf;var j=e.getController();j.registerForEvent("APP_EVENT",i.zHWU),j.registerForEvent("CLIENT_EVENT",i.zHWU)}}else"strictly_ordered"===i.xJLp?1!=i.xjuS&&i.oiHA():i.oiHA()}}else i.UODj(),console.log(i.mpTp),i.oiHA()}})),a(this,"zHWU",(function(e){e&&e.name!=i._currentEventname&&(i.xjuS=!0)})),a(this,"veVT",(function(e){var t=new ee,n=e.hycK._eventCategory;"apxor_event"===n?t.registerForEvent("apxor_event",i.zIyS):"customer_event"===n?t.registerForEvent("customer_event",i.zIyS):"any_event"===n?t.registerForEvent("any_event",i.zIyS):"campaign_event"===n?t.registerForEvent("campaign_event",i.zIyS):"survey_event"===n&&t.registerForEvent("survey_event",i.zIyS)})),a(this,"Yigt",(function(e){var t=new ee,n=e.hycK._eventCategory;"apxor_event"===n?t.unregisterFromEvent("apxor_event",i.zIyS):"customer_event"===n?t.unregisterFromEvent("customer_event",i.zIyS):"any_event"===n?t.unregisterFromEvent("any_event",i.zIyS):"campaign_event"===n?t.unregisterFromEvent("campaign_event",i.zIyS):"survey_event"===n&&t.unregisterFromEvent("survey_event",i.zIyS)})),a(this,"zIyS",(function(){var e,t;console.log("received event of nkpi"),i.ioLQ&&clearTimeout(i.ioLQ);var n=new ee;i.AueI=!0,i._across_sessions&&null!==localStorage.getItem("apx_nokpi_triggerdetails")&&localStorage.removeItem("apx_nokpi_triggerdetails"),n.unregisterFromEvent(y(null===(e=i.ymJc)||void 0===e||null===(e=e.hycK)||void 0===e?void 0:e.xiSX)+"___"+(null===(t=i.ymJc)||void 0===t||null===(t=t.hycK)||void 0===t||null===(t=t.WzOH)||void 0===t?void 0:t.HtMf),i.zIyS)})),a(this,"biBL",(function(){var t,n,r,o=new ee;console.log("configitem kpi check"),i.AueI=!0,i.KGKt&&clearTimeout(i.KGKt);var s=new C;if(i.jYOx.yykF+=1,i.jYOx.ujFS=s.uJeB(i.jYOx.yykF,i.jYOx.hycK.bbeA,i.jYOx.hycK.nPKa),o.unregisterFromEvent(y(null===(t=i.NJPn)||void 0===t||null===(t=t.hycK)||void 0===t?void 0:t.xiSX)+"___"+(null===(n=i.NJPn)||void 0===n||null===(n=n.hycK)||void 0===n?void 0:n.WzOH.HtMf),i.biBL),i._across_sessions&&null!==(r=i.MCaT)&&void 0!==r&&r.hycK._timeBased){var a,u,l,c=e.getController().getFromStorage("apx_nokpi_triggerdetails");c=null==c?[]:JSON.parse(c);for(var v=0;v<c.length;v++)if(i.no_KPI_TriggerDetails[v].id===i.MCaT.hycK._id){a=!0,u=c[v];break}if(a)u.satisfiedCount+=1;else{var d=i.jYOx.hycK._id,h=i.jYOx.hycK.DIgs,g=i.jYOx.hycK.WzOH.HtMf,f=i.jYOx.hycK.WzOH.cEHd;l={id:d,type:h,time:Date.now(),name:g,additionalInfo:f,satisfiedCount:i.jYOx.hycK._timeEnabled,timeBased:i.jYOx.hycK._timeEnabled},i.no_KPI_TriggerDetails.push(l)}}if(i.jYOx.ujFS){var _=i.mpTp[i.kpiIndex+1];p(_)?_.TMtM():i.oiHA()}})),a(this,"WGQT",(function(){if(i.gsoo===i.mpTp.length-1){i.YxhJ=!0;i.mpTp[i.gsoo]&&(i.mpTp[i.gsoo].yykF=i.OuNv.satisfiedCount,i.mpTp[i.gsoo].ujFS=!0,i.oiHA())}else{var t,n,r=e.getController().getFromStorage("apx_nokpi_triggerdetails");r=null==r?[]:JSON.parse(r);for(var o=0;o<r.length;o++)if(r[o].id===i.gsoo){n=!0,t=r[o];break}if(n&&(t.satisfiedCount=1),e.getController().persistToStorage("apx_nokpi_triggerdetails",JSON.stringify(r)),i.mpTp[i.gsoo].yykF=i.OuNv.satisfiedCount,i.mpTp[i.gsoo].ujFS=!0,i.mpTp[i.gsoo+1].hycK._timeEnabled){var s=S(i.mpTp[i.gsoo+1].hycK._time.unit,i.mpTp[i.gsoo+1].hycK._time.value),a=i.mpTp[i.gsoo+1].hycK._timeEnabled,u=i.mpTp[i.gsoo+1].hycK._id,l=i.mpTp[i.gsoo+1].yykF,c=i.mpTp[i.gsoo+1].hycK.WzOH.HtMf,v=i.mpTp[i.gsoo+1].WzOH.cEHd;(new C).amCY(i.hycK.DIgs,c,Date.now(),v,s,a,u,l)}}})),a(this,"UODj",(function(){if(i._across_sessions&&i.Tguz){var t,n,r,o="single",s=!1,a=e.getController().getFromStorage("apx_nokpi_triggerdetails");if(a=JSON.parse(a),console.log(a),a.length>0){var u,l=v(a);try{var c=function(){var e=u.value;console.log(e);var a=e.id,l=e.satisfiedCount;if(t=i.mpTp.find((function(e,t){if(1===(null==e?void 0:e.length)||void 0===(null==e?void 0:e.length)){if(e.hycK._id===a)return o="single",n=t,!0}else if(e.length>0){var i=e.findIndex((function(e){return e.hycK._id===a}));if(-1!==i)return console.log("Matching Condition Index:",t),n=t,console.log("Nested Condition Index:",i),r=i,o="group",!0}return!1})),"single"===o&&t){var c=new C;s=c.uJeB(l,t.hycK.bbeA,t.hycK.nPKa);var v=i.mpTp.findIndex((function(e){var t;return(null==e||null===(t=e.hycK)||void 0===t?void 0:t._id)===a}));void 0===v&&(v=n),s&&(i.mpTp[v].ujFS=!0)}else if("group"===o&&t){var d=new C;(s=d.uJeB(l,t[r].hycK.bbeA,t[r].hycK.nPKa))&&(i.mpTp[n][r].ujFS=!0,console.log(i.mpTp))}};for(l.s();!(u=l.n()).done;)c()}catch(e){l.e(e)}finally{l.f()}}}})),a(this,"PxwS",(function(e){e<0||i.lkPT()})),a(this,"oiHA",(function(){var t,r;console.log("in validate all conditions");var o=e.getController().getUserAttributes(),s=e.getController().getSessionAttributes();if(null!==(t=window.ApxorRTM)&&void 0!==t&&t.isBadgePresent&&null!==(r=window.ApxorRTM)&&void 0!==r&&r.badgesLists.includes(i.hEoA)&&e.getController().isBadgeTriggerSatisfied(i.hEoA)||null==e||e.logEvent("apx_trigger_satisfied",{apx_nudge_type:"SURVEY"===i.tuOh.DIgs?"survey":"campaign",apx_nudge_id:i.hEoA,apx_nudge_name:i.tuOh.HtMf,apx_variant_code:i.tuOh._isExperiment||i.tuOh._only_context?i.tuOh._attr.apx_variant_code:"TG"}),!i.VbvL.validate()||!i.UnXX.validate(o,s)||!i.YDSC.validate()){i.tuOh.DIgs;return i.YDSC.retainedDaysValidated?i.YDSC.retainedSessionValidated?i.YDSC.eventDoneInLT?void i.Nmpt("Event done in life time"):i.UnXX.userAttributesValidated?i.UnXX.sessionAttributeValidated?i.VbvL._not_in_specified_time?void i.Nmpt("Time limits check failed"):i.VbvL._not_yet_active?void i.Nmpt("not in the scheduled time"):i.VbvL._nudge_expired?void i.Nmpt("nudge expired"):void 0:void i.Nmpt("Session property filter not met"):void i.Nmpt("User property filter not met"):void i.Nmpt("User session criteria not met"):void i.Nmpt("Retained day criteria not met")}for(var a=i.mpTp.length,u=a<1,l="",c=0;c<a;c++){var d=void 0,h=i.mpTp[c];if(h.length>1){d="AND"===h[0].hycK.yWtP;for(var p=0;p<h.length;p++){d="AND"===h[0].hycK.yWtP?d&&h[p].ujFS:d||h[p].ujFS}}else d=h.ujFS;if(""===l.trim())u=d;else switch(l){case"AND":u=u&&d;break;case"OR":u=u||d}l=h.length>1?i.groupCombineOperator:h.yWtP}if(u){var g,f;if(console.debug("onCondition satisfied"),!i.HgLu.rWCY(i.hEoA))return void console.warn("Maximum limit reached",i.hEoA);if(!(null!==(g=window.ApxorRTM)&&void 0!==g&&g.isBadgePresent&&null!==(f=window.ApxorRTM)&&void 0!==f&&f.badgesLists.includes(i.hEoA)&&e.getController().isBadgeTriggerSatisfied(i.hEoA))){var _="SURVEY"===i.tuOh.DIgs?"survey":"campaign";null==e||e.logEvent("apx_trigger_satisfied",{apx_nudge_type:"SURVEY"===i.tuOh.DIgs?"survey":"campaign",apx_nudge_id:i.hEoA,apx_nudge_name:i.tuOh.HtMf,apx_variant_code:i.tuOh._isExperiment||i.tuOh._only_context?i.tuOh._attr.apx_variant_code:"TG"},!1,"",_)}console.log("Dispatching event",i.tuOh.DIgs),i._across_sessions&&localStorage.removeItem("apx_nokpi_triggerdetails");var y,m=v(i.mpTp);try{for(m.s();!(y=m.n()).done;){var E=y.value;if(1===(null==E?void 0:E.length)||void 0===(null==E?void 0:E.length))E.ujFS=!1,E.yykF=0;else{var S,x=v(E);try{for(x.s();!(S=x.n()).done;){var T=S.value;T.ujFS=!1,T.yykF=0}}catch(e){x.e(e)}finally{x.f()}}}}catch(e){m.e(e)}finally{m.f()}if(console.log("got cv well"),i.rrek.Anei(i.mpTp),i.mpTp=[],i.nKAR(i.feTW,i.NbsT),console.log(i.mpTp),!0===i.tuOh._only_context){var O="SURVEY"===i.tuOh.DIgs?"survey":"campaign";e.logEvent("apx_context_evaluated",n(n({},i.tuOh._attr),{},{message_name:i.tuOh.HtMf,id:i.hEoA}),!1,"",O)}e.getController().dispatchEvent(i.tuOh.DIgs,{name:i.tuOh.DIgs,additional_info:{uuid:i.hEoA,name:i.tuOh.HtMf}})}})),a(this,"lkPT",(function(){for(var t=i.kMrh.length,r=t<1,o="",s=0;s<t;s++){var a=i.kMrh[s],u=a.ujFS;if(""===o.trim())r=u;else switch(o){case"AND":r=r&&u;break;case"OR":r=r||u}o=a.LeGs}if(r){if(console.log("Dispatching event",i.tuOh.DIgs),e.getController().persistTerminationInfoLocally(i.hEoA),!0===i.tuOh._only_context){var l="SURVEY"===i.tuOh.DIgs?"survey":"campaign";e.logEvent("apx_context_evaluated",n(n({},i.tuOh._attr),{},{message_name:i.tuOh.HtMf,id:i.hEoA}),!1,"apxor",l)}e.getController().dispatchEvent(i.tuOh.DIgs,{name:i.tuOh.DIgs,additional_info:{uuid:i.hEoA,name:i.tuOh.HtMf}})}})),a(this,"validateForTerminationAttributes",(function(){var t=e.getController().getUserAttributes(),n=e.getController().getSessionAttributes();return i.bAdf.validate(t,n)})),a(this,"owMI",(function(){i.HgLu.owMI()})),a(this,"getFrequencyCount",(function(){return i.HgLu.getFrequencyCount()})),a(this,"Ikxf",(function(){return i.HgLu.aZZC()})),a(this,"SHUo",(function(e){var t;t="AND"===e[0].hycK.yWtP;for(var n=0;n<e.length;n++){t="AND"===e[0].hycK.yWtP?t&&e[n].ujFS:t||e[n].ujFS}return t})),a(this,"Nmpt",(function(t){var n;null==e||e.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===i.tuOh.DIgs?"survey":"campaign",apx_nudge_id:i.hEoA,apx_nudge_name:i.tuOh.HtMf,apx_variant_code:i.tuOh._isExperiment||i.tuOh._only_context?null===(n=i.tuOh._attr)||void 0===n?void 0:n.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:t})}))})),Y=s((function e(){var t=this;r(this,e),a(this,"yiCW",{}),a(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{configs:[]};if(p(e)&&p(e.configs)){var n=e.configs;if(!Array.isArray(n))return;n.sort((function(e,t){var n,i;return(null!==(n=e.prio)&&void 0!==n?n:-1)-(null!==(i=t.prio)&&void 0!==i?i:-1)}));for(var i=0;i<n.length;i++){var r=n[i],o=r._id,s=new Q;s.parse(r)?t.yiCW[o]=s:console.warn("Failed to parse cfg",o)}}})),a(this,"validate",(function(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(t.yiCW[e]){var r=t.yiCW[e];r.LKRo(n,i)}})),a(this,"getVariantCode",(function(e){return t.yiCW[e]?t.yiCW[e]._variant_code:""})),a(this,"validateForTermination",(function(e,n){t.yiCW[e]&&t.yiCW[e].PxwS(n)})),a(this,"validateForTerminationAttributes",(function(e){return!!t.yiCW[e]&&t.yiCW[e].validateForTerminationAttributes()})),a(this,"owMI",(function(e){t.yiCW[e].owMI()})),a(this,"getFrequencyCount",(function(e){return t.yiCW[e].getFrequencyCount()})),a(this,"resetFrequencyCounts",(function(){var e=t.yiCW;for(var n in e)e[n].Ikxf()})),a(this,"sFoT",(function(e){try{if(t.yiCW){var n=t.yiCW[e];if(n&&n.tuOh)return n.tuOh}}catch(e){console.log("Error in getting the campaign meta ".concat(e))}return{}}))})),B=window.ApxorLogger,Z=s((function t(){var n=this;r(this,t),a(this,"fRrd",{}),a(this,"wGxs",[]),a(this,"RGTN",!1),a(this,"initialize",(function(){var t=e.getController();t.registerForEvent("APP_EVENT",(function(e){return n.iAEW(e,"AE")})),t.registerForEvent("CLIENT_EVENT",(function(e){return n.iAEW(e,"CE")}))})),a(this,"TsEW",(function(){for(var e in n.wGxs)n.DGKW(e.event,e.key,e.type);n.RGTN=!0})),a(this,"FHKt",(function(e,t){var i;(console.log("TMtM To Event"),"function"==typeof t)&&((i=n.fRrd[e]?n.fRrd[e]:[]).push(t),n.fRrd[e]=i,B.debug("Listeners list: ",n.fRrd))})),a(this,"unregisterFromEvent",(function(e,t){if(n.fRrd[e]){for(var i=n.fRrd[e],r=[],o=0;o<i.length;o++){var s=i[o];s!==t&&r.push(s)}n.fRrd[e]=r}})),a(this,"iAEW",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"AE";n.DGKW(e,"any_event",t),"apxor"===(null==e?void 0:e.loggedBy)?(console.log("notifying apxor event listeners"),n.DGKW(e,"apxor_event",t)):"customer"===(null==e?void 0:e.loggedBy)&&n.DGKW(e,"customer_event",t),"campaign"===(null==e?void 0:e.apx_nudge_type)?n.DGKW(e,"campaign_event",t):"survey"===(null==e?void 0:e.apx_nudge_type)&&n.DGKW(e,"survey_event",t);var i=t+"___"+e.name;n.DGKW(e,i,t)})),a(this,"DGKW",(function(t,i,r){if(n.RGTN){if(B.debug("Notifying listeners for event: "+t+", "+i,n.fRrd),n.fRrd[i])for(var o=n.fRrd[i],s=e.getController().getSDKRunningTimeInSec(),a=0;a<o.length;a++){(0,o[a])(r,t.name,s,t.additional_info)}}else n.wGxs.push({event:t,key:i,type:r})}))})),$=window.ApxorLogger,ee=function(){function t(){var n=this;return r(this,t),a(this,"qaRD",!1),a(this,"YmKN",null),a(this,"uiNd",T()),a(this,"JoJl",new Z),a(this,"MUWl",e.getSiteId()),a(this,"ERXa",{}),a(this,"getQeState",(function(){try{var t=e.getController().getFromStorage("qe_state");return t?JSON.parse(_(n.MUWl,t)):(n.ERXa={},n.setQeState())}catch(e){return n.ERXa={},n.setQeState()}})),a(this,"setQeState",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";try{e.getController().persistToStorage("qe_state",n.ERXa,!0)}catch(i){""===t?n.ERXa={}:n.ERXa[t]={SESSION:0,OVERALL:0,DATES:{}},e.getController().persistToStorage("qe_state",n.ERXa,!0)}return n.ERXa})),a(this,"initialize",(function(){n.qaRD||(n.qaRD=!0,n.YmKN=new Y,n.JoJl.initialize(),n.ERXa=n.getQeState(),$.info("QE Initialized.."))})),a(this,"parse",(function(e){n.iodk()?(n.YmKN.parse(e),n.JoJl.TsEW()):$.warn("Must call init first. Unable to proceed")})),a(this,"validate",(function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;n.iodk()&&n.YmKN.validate(e,t,i)})),a(this,"getVariantCode",(function(e){return n.YmKN.getVariantCode(e)})),a(this,"validateForTermination",(function(e,t){n.iodk()&&n.YmKN.validateForTermination(e,t)})),a(this,"validateForTerminationAttributes",(function(e,t){return n.YmKN.validateForTerminationAttributes(e,t)})),a(this,"updateCount",(function(e){try{p(n.ERXa[e])||n.createObjConfig(e),n.incrementFrequencies(e),n.setQeState(e),n.YmKN.owMI(e)}catch(e){console.log("Could not update the count config:".concat(e))}})),a(this,"resetFrequencyCounts",(function(){n.YmKN.resetFrequencyCounts()})),a(this,"getFrequencyCount",(function(e){return n.YmKN.getFrequencyCount(e)})),a(this,"registerForEvent",(function(e,t){console.log("registered event",e),n.JoJl.FHKt(e,t)})),a(this,"unregisterFromEvent",(function(e,t){console.log("in unregister"),n.JoJl.unregisterFromEvent(e,t)})),a(this,"notifyEventListener",(function(e){n.JoJl.iAEW(e)})),a(this,"fetch",(function(t,n,i,r){e.getController().fetchConfiguration(t,n,i,r)})),a(this,"iodk",(function(){return n.qaRD})),a(this,"getCampaignMetaFromQueryEngine",(function(e){return n.YmKN.sFoT(e)})),a(this,"ipMe",(function(){return n.uiNd})),t.instance||(t.instance=this),t.instance}return s(t,[{key:"createObjConfig",value:function(e){try{this.ERXa=this.getQeState(),p(this.ERXa[e])||(this.ERXa[e]={SESSION:0,OVERALL:0,DATES:{}},this.uiNd&&(this.ERXa[e].DATES[this.uiNd]=0),this.setQeState(e))}catch(e){$.error("Can not create the frequency count object:"+e)}}},{key:"incrementFrequencies",value:function(e){this.ERXa=this.getQeState();var t=this.ERXa[e];t.SESSION=t.SESSION+1,t.OVERALL=t.OVERALL+1;var n=T();n===this.uiNd&&t.DATES&&t.DATES[n]||(this.uiNd=n,t.DATES={},t.DATES[this.uiNd]=0),t.DATES[this.uiNd]=t.DATES[this.uiNd]+1}}],[{key:"getInstance",value:function(){return t.instance||(t.instance=new t),t.instance}}]),t}();a(ee,"instance",void 0),window.ceVersion=160;try{void 0===exports&&null===exports||(exports.default=ee,module.exports=exports.default)}catch(e){}return ee}));
