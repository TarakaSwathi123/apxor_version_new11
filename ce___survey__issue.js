!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("apxor")):"function"==typeof define&&define.amd?define(["apxor"],e):(t=t||self)["apxor-qe"]=e(t.Apxor)}(this,(function(t){"use strict";function e(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function r(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?e(Object(n),!0).forEach((function(e){s(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,c(n.key),n)}}function o(t,e,r){return e&&a(t.prototype,e),r&&a(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t,e,r){return(e=c(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function u(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return l(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return l(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function c(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;var d=function(t){return void 0!==t&&!function(t){return null===t}(t)},f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function v(t,e){return Array.from(e).map((function(e,r){return String.fromCharCode(e^function(t,e){return t.charCodeAt(Math.floor(e%t.length))}(t,r))})).join("")}var h=function(t,e){return v(t,e=function(t){var e,r,n,i,a,o,s=0,u=[];if(!t)return t;t+="";do{e=(o=f.indexOf(t.charAt(s++))<<18|f.indexOf(t.charAt(s++))<<12|(i=f.indexOf(t.charAt(s++)))<<6|(a=f.indexOf(t.charAt(s++))))>>16&255,r=o>>8&255,n=255&o,u.push(e),64!==i&&(u.push(r),64!==a&&u.push(n))}while(s<t.length);return u}(e))},p=function(t){switch(t){case"app_event":return"AE";case"client_event":return"CE";case"activity_time":case"activity_event":return"AE"}return"Unknown"},m=function(t){return t.toUpperCase()},g=function(t,e,r){switch(r){case"EQ":return t===e;case"GT":return t>e;case"GTE":return t>=e;case"LT":return t<e;case"LTE":return t<=e;case"NEQ":return t!==e;case"R":return _(e).test(t);default:return!1}},_=function(t){var e=t.replace(/.*\/([gimuy]*)$/,"$1");e===t&&(e="");var r=e?t.replace(new RegExp("^/(.*?)/"+e+"$"),"$1"):t;return new RegExp(r,e)},y=function(){var t=new Date;return t.getDate()+"/"+t.getMonth()+"/"+t.getFullYear()},S=window.ApxorLogger,O=o((function e(){var r=this;i(this,e),s(this,"HrPf","ALL"),s(this,"aoSO",[]),s(this,"Jgpj",[]),s(this,"userAttributesValidated",!0),s(this,"sessionAttributeValidated",!0),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(r.HrPf=t.audience.audience_type,r.aoSO=t.audience.attributes.user,r.Jgpj=t.audience.attributes.session,!Array.isArray(r.aoSO)||!Array.isArray(r.Jgpj))return S.error("No attributes"),!1}catch(t){return S.error(t),!1}return!0})),s(this,"validate",(function(e,n){var i=!0;"FTU"===r.HrPf&&(i=t.getController().getSessionInfo().is_first_session);var a=r.sDdy(e,r.aoSO),o=r.sDdy(n,r.Jgpj);return a||(r.userAttributesValidated=!1),o||(r.sessionAttributeValidated=!1),i&&a&&o})),s(this,"sDdy",(function(t,e){var r=e.length,n=!0;try{for(var i,a=function(){var r=e[o];if(void 0===t[r.name]||!1===n)return{v:!1};var i=r.operator,a=r.type,s=r.value.map((function(t){if("s"===a)return t;if("l"===a)return parseInt(t);if("f"===a)return parseFloat(t);if("b"===a)switch(t){case"true":return!0;case"false":return!1;default:return t}})),u=(Array.isArray(t[r.name])?t[r.name]:[t[r.name]]).some((function(t){return s.some((function(e){return"s"===a?t="".concat(t):"l"===a?t=parseInt(t):"f"===a?t=parseFloat(t):"b"===a&&(t=!!t),g(t,e,i)}))}));n=n&&u},o=0;o<r;o++)if(i=a())return i.v}catch(t){S.error(t),n=!1}return n}))})),E=window.ApxorLogger,A=o((function e(){var r=this;i(this,e),s(this,"uqVs",0),s(this,"dOmA",0),s(this,"pvWD","SESSION"),s(this,"yKgw",0),s(this,"AxSk",0),s(this,"muCB",0),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{r.FSaC=t._id,r.UmOh=t.meta,r.uqVs=t.frequency.count,-1===r.uqVs&&(r.uqVs=1e3),r.muCB=r.uqVs,r.dOmA=t.frequency.time_interval,r.pvWD=t.frequency.validity,r.AxSk=t.frequency.ses_lmt,r._dayCount=t.frequency.day_lmt;var e=k.getInstance().getQeState();if(!d(e)||!d(e[t._id]))return!0;if("SESSION"===r.pvWD){if(r.uqVs=parseInt(r.uqVs)-parseInt(e[t._id].SESSION),r.uqVs<=0)return r.qOLq("Session limit reached"),console.warn("Max count limit reached for session:"+t._id),!1}else{if("OVERALL"!==r.pvWD)return E.info("Invalid config."),!1;if(r.uqVs=parseInt(r.uqVs)-parseInt(e[t._id].OVERALL),r.uqVs<=0)return r.qOLq("Overall limit reached"),console.warn("Max count limit reached for overall:"+t._id),!1}}catch(t){return E.error(t),!1}return!0})),s(this,"QeuS",(function(){r.uqVs=r.uqVs-1})),s(this,"getFrequencyCount",(function(){return r.uqVs})),s(this,"ghch",(function(){"SESSION"===r.pvWD&&(r.uqVs=r.muCB,E.info("Campaign Limit reset"))})),s(this,"pgAI",(function(t){try{if(r.uqVs<=0)return"OVERALL"===r.pvWD?r.qOLq("Overall limit reached"):"SESSION"===r.pvWD&&r.qOLq("Session limit reached"),!1;var e=k.getInstance().getQeState();if(!d(e)||!d(e[t]))return!0;if(0!==r.AxSk)if(parseInt(r.AxSk)-parseInt(e[t].SESSION)<=0)return r.qOLq("Session limit reached"),!1;if(0!==r._dayCount){var n,i=y();if(parseInt(r._dayCount)-parseInt((null===(n=e[t])||void 0===n?void 0:n.DATES[i])||0)<=0)return r.qOLq("Day limit reached"),!1}}catch(t){r.qOLq("Error validating the frequency: ".concat(t)),E.error("Error validating the frequency:"+t)}return!0})),s(this,"qOLq",(function(e){var n;null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===r.UmOh.type?"survey":"campaign",apx_nudge_id:r.FSaC,apx_nudge_name:r.UmOh.name,apx_variant_code:r.UmOh.isExperiment||r.UmOh.only_context?null===(n=r.UmOh.attr)||void 0===n?void 0:n.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:e})}))})),b=o((function t(){var e=this;i(this,t),s(this,"OHIt",""),s(this,"HrPf",""),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var r,n;e.OHIt=t.meta.name,e.HrPf=t.meta.type,e._only_context=t.meta.only_context,e._attr=(null===(r=t.meta)||void 0===r?void 0:r.attr)||{},e._isExperiment=null===(n=t.meta)||void 0===n?void 0:n.isExperiment}catch(t){return window.ApxorLogger.error(t),!1}return!0}))})),w=window.ApxorLogger,I=o((function t(){var e=this;i(this,t),s(this,"AWur",-1),s(this,"ujDt",-1),s(this,"KSeR",-1),s(this,"Xpds",-1),s(this,"rFYV",!1),s(this,"_nudge_expired",!1),s(this,"_not_yet_active",!1),s(this,"_not_in_specified_time",!1),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(isNaN(Date.parse(t.validity.start_date))||isNaN(Date.parse(t.validity.end_date)))return w.error("Not valid dates"),!1;if(e.AWur=Date.parse(t.validity.start_date),e.ujDt=Date.parse(t.validity.end_date),d(t.at_specific_time)&&(e.rFYV=t.at_specific_time,e.rFYV&&d(t.time_limits))){var r=(new Date).toISOString().split("T")[0];if(e.KSeR=Date.parse(r+"T"+t.time_limits.start_time+":00.000Z"),e.Xpds=Date.parse(r+"T"+t.time_limits.end_time+":00.000Z"),isNaN(e.KSeR)||isNaN(e.Xpds))return w.error("Not valid times"),!1}}catch(t){return w.error(t),!1}return!0})),s(this,"validate",(function(){var t=Date.now();return t>e.AWur&&t<e.ujDt?(!e.rFYV||t>=e.KSeR&&t<=e.Xpds||(e._not_in_specified_time=!0),!e.rFYV||t>=e.KSeR&&t<=e.Xpds):(t<e.AWur?e._not_yet_active=!0:t>e.ujDt&&(e._nudge_expired=!0),!1)}))})),U=o((function t(){var e=this;i(this,t),s(this,"OHIt",""),s(this,"ejmU",{}),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{e.OHIt=t.name,e.ejmU=t.additional_info}catch(t){return!1}return!0}))})),C=o((function t(){var e=this;i(this,t),s(this,"ymTc",0),s(this,"tKNY",0),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(e.ymTc=Number(t.lower),e.tKNY=Number(t.upper),isNaN(e.ymTc)||isNaN(e.tKNY))return!1}catch(t){return!1}return!0}))})),x=o((function t(){var e=this;i(this,t),s(this,"bNdM",0),s(this,"BjwE",""),s(this,"VRJe",""),s(this,"lUWN",new U),s(this,"rlot",new C),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return e.BjwE=t.event_type,e.VRJe=t.activity,e.lUWN.parse(t.details)&&e.rlot.parse(t.time_bounds)}catch(t){return!1}}))})),N=window.ApxorLogger,D=o((function t(){var e=this;i(this,t),s(this,"bNdM",0),s(this,"XoFx",-1),s(this,"uqVs",0),s(this,"HSlP",""),s(this,"VRJe",""),s(this,"BjwE",""),s(this,"rlot",new C),s(this,"lUWN",new U),s(this,"EsNO",new x),s(this,"rJJZ","AND"),s(this,"qaem",!1),s(this,"HrPf",void 0),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return e.XoFx=t.sequence,e.uqVs=t.count_config.count,e.HSlP=t.count_config.operator,e.VRJe=t.activity,e.BjwE=t.event_type,e.rJJZ=t.combine_operator,e.HrPf=t.type,e.lUWN.parse(t.details)&&e.EsNO.parse(t.trigger)&&e.rlot.parse(t.time_bounds)}catch(t){return N.error(t),!1}}))})),F=window.ApxorLogger,q=o((function t(){var e=this;i(this,t),s(this,"uqVs",0),s(this,"HSlP",""),s(this,"BjwE",""),s(this,"rlot",new C),s(this,"lUWN",new U),s(this,"rJJZ","AND"),s(this,"parse",(function(t){try{return e.uqVs=t.count_config.count,e.HSlP=t.count_config.operator,e.BjwE=t.event_type,e.rJJZ=t.combine_operator,e.lUWN.parse(t.details)&&e.rlot.parse(t.time_bounds)}catch(t){return F.error(t),!1}}))})),V=window.ApxorLogger,j=function(){function e(){var r=this;i(this,e),s(this,"pHBR",0),s(this,"FSaC",""),s(this,"sAud",new D),s(this,"DvlC",new q),s(this,"JUod",!1),s(this,"EvIS",!1),s(this,"RAcc",0),s(this,"rJJZ","AND"),s(this,"DdyK","OR"),s(this,"Tabs",-1),s(this,"yCGF",[]),s(this,"ZDVj",{}),s(this,"kCYB",!1),s(this,"initialize",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";if(r.FSaC=n,r.RAcc=i,r.yCGF=o,"termination"===s&&""!==s){r.DvlC.parse(e);return r.DdyK=r.DvlC.rJJZ,r.JFzz(),!0}var u=r.sAud.parse(e);if(u){if(r.rJJZ=r.sAud.rJJZ,r.sAud.qaem){var l=r.sAud.lUWN.OHIt;"APX_PAGE_OPENED"===l&&(l=r.sAud.lUWN.ejmU.navigation_id,l=d(l)?l:r.sAud.lUWN.OHIt),r.Tabs=t.getController().getEventCount(l);var c=r.sAud.uqVs,f=r.sAud.HSlP;if(r.EvIS=r.CZfx(r.Tabs-1,c,f,!1),r.JUod=r.EvIS,r.EvIS&&"APX_PAGE_OPENED"===r.sAud.lUWN.OHIt)return!0}return a&&0!==i||r.dwNm(),!0}return!1})),s(this,"dwNm",(function(){var t,e=r.sAud,n=e.EsNO,i=k.getInstance();"app_start"===n.BjwE?(r.JUod=!0,i.registerForEvent(p(e.BjwE)+"___"+e.lUWN.OHIt,r.cLGB)):i.registerForEvent(p(e.BjwE)+"___"+n.lUWN.OHIt,r.cLGB),null!==(t=window.ApxorRTM)&&void 0!==t&&t.badgesLists.includes(r.FSaC)&&i.registerForEvent(p(e.BjwE)+"___"+"apxor-badge-container-".concat("-".concat(r.FSaC).replaceAll(" ","").replace(/[^\w\s]/gi,"")),r.cLGB)})),s(this,"JFzz",(function(){var t=r.DvlC,e=k.getInstance();r.JUod=!0,e.registerForEvent(p(t.BjwE)+"___"+t.lUWN.OHIt,r.Ylhf)})),s(this,"xYlo",(function(t,e,n,i){var a,o=(Date.now()-r.ZDVj[e])/1e3;(null===(a=r.sAud)||void 0===a||null===(a=a.lUWN)||void 0===a||null===(a=a.ejmU)||void 0===a?void 0:a.time)/1e3>o&&r._displayCampaign(n)})),s(this,"DKEP",(function(t,e,n,i){var a,o;r.kCYB=!0;var s=Date.now(),u=null===(a=r.sAud)||void 0===a||null===(a=a.EsNO)||void 0===a?void 0:a.lUWN.OHIt,l=(s-r.ZDVj[u])/1e3,c=null===(o=r.sAud)||void 0===o||null===(o=o.lUWN)||void 0===o||null===(o=o.ejmU)||void 0===o?void 0:o.time;(c/=1e3)>l&&r._displayCampaign(n)})),s(this,"cLGB",(function(e,n,i,a){var o,s,u=k.getInstance();if(r.JUod){if(null!==(o=window.ApxorRTM)&&void 0!==o&&o.isBadgePresent&&null!==(s=window.ApxorRTM)&&void 0!==s&&s.badgesLists.includes(r.FSaC)&&t.getController().isBadgeTriggerSatisfied(r.FSaC))return r.EvIS=!0,r.sAud.bNdM=i,void u.validate(r.FSaC,r.RAcc);p(r.sAud.BjwE)===e&&r.quon(i-r.sAud.EsNO.bNdM,r.sAud.rlot)&&r.sAud.lUWN.OHIt===n&&r.HAOz(r.sAud.lUWN.ejmU,a)&&(r.pHBR+=1,r.EvIS=r.CZfx(r.pHBR,r.sAud.uqVs,r.sAud.HSlP),r.EvIS&&(r.sAud.bNdM=i,u.validate(r.FSaC,r.RAcc)))}else if(r.JUod=r.LLpm(e,n,i,a),r.JUod){var l=r.sAud,c=l.EsNO;if(c.bNdM=i,"activity_time"===(null==l?void 0:l.BjwE)){var d,f,v,h=null==l||null===(d=l.lUWN)||void 0===d||null===(d=d.ejmU)||void 0===d?void 0:d.time;(null==l||null===(f=l.lUWN)||void 0===f||null===(f=f.ejmU)||void 0===f?void 0:f.nkpi.length)>0&&(setTimeout((function(){r.kCYB||(r.EvIS=!0,r.EvIS&&(r.pHBR+=1,r.EvIS=r.CZfx(r.pHBR,r.sAud.uqVs,r.sAud.HSlP),r.EvIS&&(r.sAud.bNdM=i,u.validate(r.FSaC,r.RAcc)))),l.lUWN.ejmU.nkpi.map((function(t){u.unregisterFromEvent(m(l.lUWN.ejmU.et)+"___"+t,r)}))}),h),l.lUWN.ejmU.nkpi.map((function(t){u.registerForEvent(m(l.lUWN.ejmU.et)+"___"+t,r.DKEP)}))),(null==l||null===(v=l.lUWN)||void 0===v||null===(v=v.ejmU)||void 0===v?void 0:v.kpi.length)>0&&(setTimeout((function(){l.lUWN.ejmU.kpi.map((function(t){u.unregisterFromEvent(m(l.lUWN.ejmU.et)+"___"+t,r)}))}),h),l.lUWN.ejmU.kpi.map((function(t){t===l.EsNO.lUWN.OHIt?(u.unregisterFromEvent(p(c.BjwE)+"___"+c.lUWN.OHIt,r),u.registerForEvent(m(l.lUWN.ejmU.et)+"___"+t,r.xYlo)):u.registerForEvent(m(l.lUWN.ejmU.et)+"___"+t,r.DKEP)})))}else u.unregisterFromEvent(p(c.BjwE)+"___"+c.lUWN.OHIt,r),u.registerForEvent(p(l.BjwE)+"___"+l.lUWN.OHIt,r);r.ZDVj[n]=Date.now()}})),s(this,"Ylhf",(function(t,e,n,i){var a=k.getInstance();p(r.DvlC.BjwE)===t&&r.quon(n,r.DvlC.rlot)&&r.DvlC.lUWN.OHIt===e&&r.HAOz(r.DvlC.lUWN.ejmU,i)&&(r.pHBR+=1,r.EvIS=r.CZfx(r.pHBR,r.DvlC.uqVs,r.DvlC.HSlP),r.EvIS&&(r.DvlC.bNdM=n,a.validateForTermination(r.FSaC,r.RAcc)))})),s(this,"LLpm",(function(t,e,n,i){var a=r.sAud.EsNO;return p(a.BjwE)===t&&a.lUWN.OHIt===e&&r.quon(n,a.rlot)&&r.HAOz(a.lUWN.ejmU,i)})),s(this,"quon",(function(t,e){var r=Math.ceil(t);return r>e.ymTc&&r<e.tKNY})),s(this,"CZfx",(function(t,e,n){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];switch(i&&r.sAud.qaem&&(t+=r.Tabs),n){case"EQ":return t===e;case"GT":return t>e;case"GTE":return t>=e;case"LT":return t<e;case"LTE":return t<=e;default:return!1}})),s(this,"HAOz",(function(t,e){var r=!0;try{var i,a=function(){if(!1===r)return{v:!1};if("object"===n(t[o])){var i,a=t[o].op,s=t[o].t;if("s"===s)i=t[o].val;else if("l"===s||"f"===s)i=parseFloat(t[o].val);else if("b"===s)switch(t[o].val){case"true":i=!0;break;case"false":i=!1;break;default:i=t[o].val}var u=(Array.isArray(e[o])?e[o]:[e[o]]).some((function(t){return"s"===s?t="".concat(t):"l"===s?t=parseInt(t):"f"===s?t=parseFloat(t):"b"===s&&(t=!!t),g(t,i,a)}));r=r&&u}else r=r&&g(e[o],t[o],"EQ")};for(var o in t)if(i=a())return i.v}catch(t){V.error(t),r=!1}return r}))}return o(e,[{key:"_displayCampaign",value:function(t){var e=k.getInstance();this.EvIS=!0,this.EvIS&&(this.pHBR+=1,this.EvIS=this.CZfx(this.pHBR,this.sAud.uqVs,this.sAud.HSlP),this.EvIS&&(this.sAud.bNdM=t,e.validate(this.FSaC,this.RAcc)))}}]),e}(),H=window.ApxorLogger,P=o((function e(){var r=this;i(this,e),s(this,"rXlP",[]),s(this,"_ret_day",{}),s(this,"ORLM",{}),s(this,"ZeRp",!1),s(this,"OwqC",!1),s(this,"retainedDaysValidated",!0),s(this,"retainedSessionValidated",!0),s(this,"eventDoneInLT",!1),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{r.rXlP=t.overall_cfg.events,r._ret_day=t.overall_cfg.ret_day,r.ORLM=t.overall_cfg.session,r.ZeRp=t.overall_cfg.toggleRetDay,r.OwqC=t.overall_cfg.toggleSession}catch(t){return H.error(t),!1}return!0})),s(this,"validate",(function(){var e=parseInt(t.getController().getFromStorage("apx_retained_days")),n=parseInt(t.getController().getFromStorage("apx_retained_session"));if(r.ZeRp&&!isNaN(e)&&!(e>=r._ret_day.from&&e<=r._ret_day.to))return r.retainedDaysValidated=!1,!1;if(r.OwqC&&!isNaN(n)&&!(n>=r.ORLM.from&&n<=r.ORLM.to))return r.retainedSessionValidated=!1,!1;try{for(var i=t.getController().getFromStorage("_apx_lt_count"),a=t.getSiteId(),o=JSON.parse((new TextDecoder).decode(function(t){for(var e=new ArrayBuffer(t.length),r=new Uint8Array(e),n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return e}(h(a,i)))),s=0;s<r.rXlP.length;s++){if(o[r.rXlP[s].name.replace("'","").replace("’","")])return r.eventDoneInLT=!0,!1}}catch(t){H.error("Failed to validate the lt count:"+t)}return!0}))})),L=window.ApxorLogger,R=o((function t(){var e=this;i(this,t),s(this,"aoSO",[]),s(this,"Jgpj",[]),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(e.aoSO=t.attributes.user,e.Jgpj=t.attributes.session,!Array.isArray(e.aoSO)||!Array.isArray(e.Jgpj))return L.error("No attributes"),!1}catch(t){return L.error(t),!1}return!0})),s(this,"validate",(function(t,r){return e.sDdy(t,e.aoSO)&&e.sDdy(r,e.Jgpj)})),s(this,"sDdy",(function(t,e){var r=e.length,n=!0;try{for(var i,a=function(){var r=e[o];if(!t[r.name]||!1===n)return{v:!1};var i=r.operator,a=r.type,s=r.value.map((function(t){return"s"===a?t:"l"===a?parseInt(t):"f"===a?parseFloat(t):void 0})),u=(Array.isArray(t[r.name])?t[r.name]:[t[r.name]]).some((function(t){return s.some((function(e){return g(t,e,i)}))}));n=n&&u},o=0;o<r;o++)if(i=a())return i.v}catch(t){L.error(t),n=!1}return n}))})),T=o((function e(){var r=this;i(this,e),s(this,"PlZO",t.getController()),s(this,"type",""),s(this,"_duration_seconds",0),s(this,"jmVK",1),s(this,"parse",(function(t){try{var e,n,i;if(r.HrPf=null===(e=t.terminate_info.time_based)||void 0===e?void 0:e.type,r._duration_seconds=null===(n=t.terminate_info)||void 0===n?void 0:n.time_based.duration_seconds,r.jmVK=null===(i=t.terminate_info.time_based)||void 0===i?void 0:i.days,r.emnb(t._id))return r.PlZO.persistTerminationInfoLocally(t._id),!1}catch(t){return!1}return!0})),s(this,"emnb",(function(t){var e,n=JSON.parse(r.PlZO.getFromStorage("apx_termination_ID"));if(!n[t]||null===(e=n[t])||void 0===e||!e.startDate)return!1;var i,a=new Date(n[t].startDate),o=new Date((i=new Date).getMonth()+"/"+i.getDate()+"/"+i.getFullYear()),s=parseInt((o-a)/864e5,10),u=function(){var t=new Date;return{hours:t.getHours(),mins:t.getMinutes()}}(),l=n[t].KSeR;return s===r.jmVK&&u.hours>=l.hours||s>r.jmVK||n[t].goalAcheived}))})),W=o((function t(){var e=this;i(this,t),s(this,"enable_goal_events",!1),s(this,"attributes",{}),s(this,"BIlm",new R),s(this,"oAxZ",new T),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var r,n,i;if(e.enable_time_based=null==t||null===(r=t.terminate_info)||void 0===r?void 0:r.enable_time_based,e.enable_time_based&&!e.oAxZ.parse(t))return!1;if(e.enable_goal_events=null==t||null===(n=t.terminate_info)||void 0===n?void 0:n.enable_goal_events,e.enable_attributes=null==t||null===(i=t.terminate_info)||void 0===i?void 0:i.enable_attributes,e.enable_attributes&&!e.BIlm.parse(t.terminate_info))return!1}catch(t){return window.ApxorLogger.error(t),!1}return!0})),s(this,"validate",(function(t,r){return e.BIlm.validate(t,r)}))})),B=window.ApxorLogger,J=o((function e(){var n=this;i(this,e),s(this,"Evsr",[]),s(this,"URAF",[]),s(this,"FSaC",""),s(this,"UmOh",new b),s(this,"VQdZ",new O),s(this,"pvWD",new I),s(this,"HPfI",new A),s(this,"sqsD",new P),s(this,"jXIi",new W),s(this,"PHRv",!1),s(this,"UxwM",[]),s(this,"_variant_code",""),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var e;if(!d(t._id))return B.error("No Id"),!1;if(!d(t.enabled)||!t.enabled)return B.error("Not enabled"),!1;if(!(n.UmOh.parse(t)&&n.pvWD.parse(t)&&n.HPfI.parse(t)&&n.VQdZ.parse(t)&&n.sqsD.parse(t)&&n.jXIi.parse(t)))return!1;if(n._variant_code=n.UmOh._isExperiment||n.UmOh._only_context?null===(e=n.UmOh._attr)||void 0===e?void 0:e.apx_variant_code:"TG",!d(t.conditions)||!Array.isArray(t.conditions))return B.error("No valid conditions",t.conditions),!1;n.FSaC=t._id,n.PHRv=!!d(t.sequence_enabled)&&t.sequence_enabled,n.PHRv&&t.conditions.sort((function(t,e){return t.sequence<e.sequence}));for(var r=t.conditions,i=r.length,a=0;a<i;a++){n.UxwM=[];var o=r[a];if("didn't"===o.type){var s,l={trigger_key:o.trigger.details.name,no_kpi_array:null==o||null===(s=o.details)||void 0===s||null===(s=s.additional_info)||void 0===s?void 0:s.nkpi,condition_id:null==o?void 0:o._id,time_bounds:o.time_bounds.upper};n.UxwM=[].concat(u(n.UxwM),[l])}var c=new j;c.initialize(o,n.FSaC,a,n.PHRv,n.UxwM)&&n.Evsr.push(c)}if(n.jXIi.enable_goal_events)for(var f=t.terminate_info.goal_events.events,v=f.length,h=0;h<v;h++){var p=new j;p.initialize(f[h],n.FSaC,h,!0,[],"termination")&&n.URAF.push(p)}return n.Evsr.length>0}catch(t){return B.error(t),!1}})),s(this,"sBAE",(function(t){if(!(t<0))if(n.PHRv){var e=n.Evsr[t];if(d(e)&&e.EvIS){var r=n.Evsr[t-1];if(d(r)&&!r.EvIS)return;var i=n.Evsr[t+1];d(i)?i.dwNm():n.Szlv()}}else n.Szlv()})),s(this,"cJCR",(function(t){t<0||n.SXKd()})),s(this,"Szlv",(function(){var e,i,a=t.getController().getUserAttributes(),o=t.getController().getSessionAttributes();if(null!==(e=window.ApxorRTM)&&void 0!==e&&e.isBadgePresent&&null!==(i=window.ApxorRTM)&&void 0!==i&&i.badgesLists.includes(n.FSaC)&&t.getController().isBadgeTriggerSatisfied(n.FSaC)||null==t||t.logEvent("apx_trigger_satisfied",{apx_nudge_type:"SURVEY"===n.UmOh.HrPf?"survey":"campaign",apx_nudge_id:n.FSaC,apx_nudge_name:n.UmOh.OHIt,apx_variant_code:n.UmOh._isExperiment||n.UmOh._only_context?n.UmOh._attr.apx_variant_code:"TG"}),!n.pvWD.validate()||!n.VQdZ.validate(a,o)||!n.sqsD.validate())return n.sqsD.retainedDaysValidated?n.sqsD.retainedSessionValidated?n.sqsD.eventDoneInLT?void n.qOLq("Event done in life time"):n.VQdZ.userAttributesValidated?n.VQdZ.sessionAttributeValidated?n.pvWD._not_in_specified_time?void n.qOLq("Time limits check failed"):n.pvWD._not_yet_active?void n.qOLq("not in the scheduled time"):n.pvWD._nudge_expired?void n.qOLq("nudge expired"):void 0:void n.qOLq("Session property filter not met"):void n.qOLq("User property filter not met"):void n.qOLq("User session criteria not met"):void n.qOLq("Retained day criteria not met");for(var s=n.Evsr.length,u=s<1,l="",c=0;c<s;c++){var d=n.Evsr[c],f=d.EvIS;if(""===l.trim())u=f;else switch(l){case"AND":u=u&&f;break;case"OR":u=u||f}l=d.rJJZ}if(u){if(console.debug("onCondition satisfied"),!n.HPfI.pgAI(n.FSaC))return void console.warn("Maximum limit reached",n.FSaC);console.log("Dispatching event",n.UmOh.HrPf),t.logEvent("apx_context_evaluated",r(r({apx_nudge_type:"SURVEY"===n.UmOh.HrPf?"survey":"campaign",apx_nudge_id:n.FSaC,apx_nudge_name:n.UmOh.OHIt,apx_variant_code:n.UmOh._isExperiment||n.UmOh._only_context?n.UmOh._attr.apx_variant_code:"TG"},n.UmOh._attr),{},{message_name:n.UmOh.OHIt,id:n.FSaC})),t.getController().dispatchEvent(n.UmOh.HrPf,{name:n.UmOh.HrPf,additional_info:{uuid:n.FSaC,name:n.UmOh.OHIt}})}})),s(this,"SXKd",(function(){for(var e=n.URAF.length,i=e<1,a="",o=0;o<e;o++){var s=n.URAF[o],u=s.EvIS;if(""===a.trim())i=u;else switch(a){case"AND":i=i&&u;break;case"OR":i=i||u}a=s.DdyK}i&&(console.log("Dispatching event",n.UmOh.HrPf),t.getController().persistTerminationInfoLocally(n.FSaC),!0===n.UmOh._only_context&&t.logEvent("apx_context_evaluated",r(r({},n.UmOh._attr),{},{message_name:n.UmOh.OHIt,id:n.FSaC})),t.getController().dispatchEvent(n.UmOh.HrPf,{name:n.UmOh.HrPf,additional_info:{uuid:n.FSaC,name:n.UmOh.OHIt}}))})),s(this,"validateForTerminationAttributes",(function(){var e=t.getController().getUserAttributes(),r=t.getController().getSessionAttributes();return n.jXIi.validate(e,r)})),s(this,"QeuS",(function(){n.HPfI.QeuS()})),s(this,"getFrequencyCount",(function(){return n.HPfI.getFrequencyCount()})),s(this,"pSOr",(function(){return n.HPfI.ghch()})),s(this,"qOLq",(function(e){var r;null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===n.UmOh.HrPf?"survey":"campaign",apx_nudge_id:n.FSaC,apx_nudge_name:n.UmOh.OHIt,apx_variant_code:n.UmOh._isExperiment||n.UmOh._only_context?null===(r=n.UmOh._attr)||void 0===r?void 0:r.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:e})}))})),G=o((function t(){var e=this;i(this,t),s(this,"cfci",{}),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{configs:[]};if(d(t)&&d(t.configs)){var r=t.configs;if(!Array.isArray(r))return;r.sort((function(t,e){var r,n;return(null!==(r=t.prio)&&void 0!==r?r:-1)-(null!==(n=e.prio)&&void 0!==n?n:-1)}));for(var n=0;n<r.length;n++){var i=r[n],a=i._id,o=new J;o.parse(i)?e.cfci[a]=o:console.warn("Failed to parse cfg",a)}}})),s(this,"validate",(function(t,r){e.cfci[t]&&e.cfci[t].sBAE(r)})),s(this,"getVariantCode",(function(t){return e.cfci[t]?e.cfci[t]._variant_code:""})),s(this,"validateForTermination",(function(t,r){e.cfci[t]&&e.cfci[t].cJCR(r)})),s(this,"validateForTerminationAttributes",(function(t){return!!e.cfci[t]&&e.cfci[t].validateForTerminationAttributes()})),s(this,"QeuS",(function(t){e.cfci[t].QeuS()})),s(this,"getFrequencyCount",(function(t){return e.cfci[t].getFrequencyCount()})),s(this,"resetFrequencyCounts",(function(){var t=e.cfci;for(var r in t)t[r].pSOr()})),s(this,"yxou",(function(t){try{if(e.cfci){var r=e.cfci[t];if(r&&r.UmOh)return r.UmOh}}catch(t){console.log("Error in getting the campaign meta ".concat(t))}return{}}))})),Z=window.ApxorLogger,M=o((function e(){var r=this;i(this,e),s(this,"GDiE",{}),s(this,"RUXa",[]),s(this,"KZWh",!1),s(this,"initialize",(function(){var e=t.getController();e.registerForEvent("APP_EVENT",(function(t){return r.NImY(t,"AE")})),e.registerForEvent("CLIENT_EVENT",(function(t){return r.NImY(t,"CE")}))})),s(this,"vwSh",(function(){for(var t in r.RUXa)r.FFQA(t.event,t.key,t.type);r.KZWh=!0})),s(this,"gVSp",(function(t,e){var n;"function"==typeof e&&((n=r.GDiE[t]?r.GDiE[t]:[]).push(e),r.GDiE[t]=n,Z.debug("Listeners list: ",r.GDiE))})),s(this,"unregisterFromEvent",(function(t,e){if(r.GDiE[t]){for(var n=r.GDiE[t],i=[],a=0;a<n.length;a++){var o=n[a];o!==e&&i.push(o)}r.GDiE[t]=i}})),s(this,"NImY",(function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"AE",n=e+"___"+t.name;r.FFQA(t,n,e)})),s(this,"FFQA",(function(e,n,i){if(r.KZWh){if(Z.debug("Notifying listeners for event: "+e+", "+n,r.GDiE),r.GDiE[n])for(var a=r.GDiE[n],o=t.getController().getSDKRunningTimeInSec(),s=0;s<a.length;s++){(0,a[s])(i,e.name,o,e.additional_info)}}else r.RUXa.push({event:e,key:n,type:i})}))})),Q=window.ApxorLogger,k=function(){function e(){var r=this;return i(this,e),s(this,"CcRd",!1),s(this,"lVPb",null),s(this,"IGnr",y()),s(this,"LmrH",new M),s(this,"zTFX",t.getSiteId()),s(this,"tIba",{}),s(this,"getQeState",(function(){try{var e=t.getController().getFromStorage("qe_state");return e?JSON.parse(h(r.zTFX,e)):(r.tIba={},r.setQeState())}catch(t){return r.tIba={},r.setQeState()}})),s(this,"setQeState",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";try{t.getController().persistToStorage("qe_state",r.tIba,!0)}catch(n){""===e?r.tIba={}:r.tIba[e]={SESSION:0,OVERALL:0,DATES:{}},t.getController().persistToStorage("qe_state",r.tIba,!0)}return r.tIba})),s(this,"initialize",(function(){r.CcRd||(r.CcRd=!0,r.lVPb=new G,r.LmrH.initialize(),r.tIba=r.getQeState(),Q.info("QE Initialized.."))})),s(this,"parse",(function(t){r.fril()?(r.lVPb.parse(t),r.LmrH.vwSh()):Q.warn("Must call init first. Unable to proceed")})),s(this,"validate",(function(t,e){r.fril()&&r.lVPb.validate(t,e)})),s(this,"getVariantCode",(function(t){return r.lVPb.getVariantCode(t)})),s(this,"validateForTermination",(function(t,e){r.fril()&&r.lVPb.validateForTermination(t,e)})),s(this,"validateForTerminationAttributes",(function(t,e){return r.lVPb.validateForTerminationAttributes(t,e)})),s(this,"updateCount",(function(t){try{d(r.tIba[t])||r.createObjConfig(t),r.incrementFrequencies(t),r.setQeState(t),r.lVPb.QeuS(t)}catch(t){console.log("Could not update the count config:".concat(t))}})),s(this,"resetFrequencyCounts",(function(){r.lVPb.resetFrequencyCounts()})),s(this,"getFrequencyCount",(function(t){return r.lVPb.getFrequencyCount(t)})),s(this,"registerForEvent",(function(t,e){r.LmrH.gVSp(t,e)})),s(this,"unregisterFromEvent",(function(t,e){r.LmrH.unregisterFromEvent(t,e)})),s(this,"notifyEventListener",(function(t){r.LmrH.NImY(t)})),s(this,"fetch",(function(e,r,n,i){t.getController().fetchConfiguration(e,r,n,i)})),s(this,"fril",(function(){return r.CcRd})),s(this,"getCampaignMetaFromQueryEngine",(function(t){return r.lVPb.yxou(t)})),s(this,"UAnw",(function(){return r.IGnr})),e.instance||(e.instance=this),e.instance}return o(e,[{key:"createObjConfig",value:function(t){try{this.tIba=this.getQeState(),d(this.tIba[t])||(this.tIba[t]={SESSION:0,OVERALL:0,DATES:{}},this.IGnr&&(this.tIba[t].DATES[this.IGnr]=0),this.setQeState(t))}catch(t){Q.error("Can not create the frequency count object:"+t)}}},{key:"incrementFrequencies",value:function(t){this.tIba=this.getQeState();var e=this.tIba[t];e.SESSION=e.SESSION+1,e.OVERALL=e.OVERALL+1;var r=y();r===this.IGnr&&e.DATES&&e.DATES[r]||(this.IGnr=r,e.DATES={},e.DATES[this.IGnr]=0),e.DATES[this.IGnr]=e.DATES[this.IGnr]+1}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}();s(k,"instance",void 0),window.ceVersion=160;try{void 0===exports&&null===exports||(exports.default=k,module.exports=exports.default)}catch(t){}return k}));
