!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("apxor")):"function"==typeof define&&define.amd?define(["apxor"],e):(t=t||self)["apxor-qe"]=e(t.Apxor)}(this,(function(t){"use strict";function e(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function n(t){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?e(Object(r),!0).forEach((function(e){a(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,d(r.key),r)}}function s(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function a(t,e,n){return(e=d(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function l(t){return function(t){if(Array.isArray(t))return v(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||u(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t,e){if(t){if("string"==typeof t)return v(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(t,e):void 0}}function v(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function h(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=u(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){a=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function d(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;var c=function(t){return void 0===t},g=function(t){return void 0!==t&&!function(t){return null===t}(t)},_="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function y(t,e){return Array.from(e).map((function(e,n){return String.fromCharCode(e^function(t,e){return t.charCodeAt(Math.floor(e%t.length))}(t,n))})).join("")}var f=function(t,e){return y(t,e=function(t){var e,n,r,i,o,s,a=0,l=[];if(!t)return t;t+="";do{e=(s=_.indexOf(t.charAt(a++))<<18|_.indexOf(t.charAt(a++))<<12|(i=_.indexOf(t.charAt(a++)))<<6|(o=_.indexOf(t.charAt(a++))))>>16&255,n=s>>8&255,r=255&s,l.push(e),64!==i&&(l.push(n),64!==o&&l.push(r))}while(a<t.length);return l}(e))},p=function(t){switch(t){case"app_event":return"AE";case"client_event":return"CE";case"activity_time":case"activity_event":return"AE";case"apxor_event":return"AEV";case"customer_event":return"CEV";case"any_event":return"ANV";case"campaign_event":return"CNV";case"survey_event":return"SVE"}return"Unknown"},m=function(t){return t.toUpperCase()},w=function(t,e,n){switch(n){case"EQ":return t===e;case"GT":return t>e;case"GTE":return t>=e;case"LT":return t<e;case"LTE":return t<=e;case"NEQ":return t!==e;case"R":return E(e).test(t);default:return!1}},I=function(t,e){switch(t){case"second":return 1e3*e;case"minute":return 60*e*1e3;case"hour":return 60*e*60*1e3;case"day":return 24*e*60*60*1e3;default:return 1}},E=function(t){var e=t.replace(/.*\/([gimuy]*)$/,"$1");e===t&&(e="");var n=e?t.replace(new RegExp("^/(.*?)/"+e+"$"),"$1"):t;return new RegExp(n,e)},A=function(){var t=new Date;return t.getDate()+"/"+t.getMonth()+"/"+t.getFullYear()},b=window.ApxorLogger,T=s((function e(){var n=this;i(this,e),a(this,"WrlT","ALL"),a(this,"atlg",[]),a(this,"nCNt",[]),a(this,"userAttributesValidated",!0),a(this,"sessionAttributeValidated",!0),a(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(n.WrlT=t.audience.audience_type,n.atlg=t.audience.attributes.user,n.nCNt=t.audience.attributes.session,!Array.isArray(n.atlg)||!Array.isArray(n.nCNt))return b.error("No attributes"),!1}catch(t){return b.error(t),!1}return!0})),a(this,"validate",(function(e,r){var i=!0;"FTU"===n.WrlT&&(i=t.getController().getSessionInfo().is_first_session);var o=n.EWzj(e,n.atlg),s=n.EWzj(r,n.nCNt);return o||(n.userAttributesValidated=!1),s||(n.sessionAttributeValidated=!1),i&&o&&s})),a(this,"EWzj",(function(t,e){var n=e.length,r=!0;try{for(var i,o=function(){var n=e[s];if(c(t[n.name])||!1===r)return{v:!1};var i=n.operator,o=n.type,a=n.value.map((function(t){if("s"===o)return t;if("l"===o)return parseInt(t);if("f"===o)return parseFloat(t);if("b"===o)switch(t){case"true":return!0;case"false":return!1;default:return t}})),l=(Array.isArray(t[n.name])?t[n.name]:[t[n.name]]).some((function(t){return a.some((function(e){return"s"===o?t="".concat(t):"l"===o?t=parseInt(t):"f"===o?t=parseFloat(t):"b"===o&&(t=!!t),w(t,e,i)}))}));r=r&&l},s=0;s<n;s++)if(i=o())return i.v}catch(t){b.error(t),r=!1}return r}))})),B=s((function t(){var e=this;i(this,t),a(this,"WGsD",""),a(this,"puNH",{}),a(this,"VZCp",""),a(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{e.WGsD=t.name,e.puNH=t.additional_info,e.VZCp=null==t?void 0:t.path}catch(t){return!1}return!0}))})),D=s((function t(){var e=this;i(this,t),a(this,"GWgK",0),a(this,"GbIO",0),a(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(e.GWgK=Number(t.lower),e.GbIO=Number(t.upper),isNaN(e.GWgK)||isNaN(e.GbIO))return!1}catch(t){return!1}return!0}))})),C=s((function t(){var e=this;i(this,t),a(this,"xpWd",0),a(this,"HvBy",""),a(this,"LWXP",""),a(this,"uAhq",new B),a(this,"Eoev",new D),a(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return e.HvBy=t.event_type,e.LWXP=t.activity,e.uAhq.parse(t.details)&&e.Eoev.parse(t.time_bounds)}catch(t){return!1}}))})),q=window.ApxorLogger,W=s((function t(){var e=this;i(this,t),a(this,"xpWd",0),a(this,"LWbE",-1),a(this,"DupM",0),a(this,"lwvU",""),a(this,"LWXP",""),a(this,"HvBy",""),a(this,"Eoev",new D),a(this,"uAhq",new B),a(this,"UunA",new C),a(this,"oLDv","AND"),a(this,"koML",!1),a(this,"WrlT",void 0),a(this,"oTpE",""),a(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var n,r;return e.LWbE=null==t?void 0:t.sequence,e._conditionType=null==t?void 0:t.condition_type,e._id=null==t?void 0:t._id,e._eventCategory=null!=t&&t.event_category?null==t?void 0:t.event_category:"specific_event",e.DupM=null==t||null===(n=t.count_config)||void 0===n?void 0:n.count,e.lwvU=null==t||null===(r=t.count_config)||void 0===r?void 0:r.operator,e.LWXP=null==t?void 0:t.activity,e.HvBy=null==t?void 0:t.event_type,e.oLDv=t.combine_operator,e._timeEnabled=null==t?void 0:t.time_enabled,e._time=null==t?void 0:t.time,e.WrlT=null==t?void 0:t.type,e.oTpE=null==t?void 0:t.route,e.uAhq.parse(null==t?void 0:t.details)&&e.UunA.parse(t.trigger)&&e.Eoev.parse(t.time_bounds)}catch(t){return q.error(t),!1}}))})),x=window.ApxorLogger,K=s((function t(){var e=this;i(this,t),a(this,"DupM",0),a(this,"lwvU",""),a(this,"HvBy",""),a(this,"Eoev",new D),a(this,"uAhq",new B),a(this,"oLDv","AND"),a(this,"parse",(function(t){try{return e.DupM=t.count_config.count,e.lwvU=t.count_config.operator,e.HvBy=t.event_type,e.oLDv=t.combine_operator,e.uAhq.parse(t.details)&&e.Eoev.parse(t.time_bounds)}catch(t){return x.error(t),!1}}))})),F=window.ApxorLogger,G=function(){function e(){var n=this;i(this,e),a(this,"lBCr",0),a(this,"Ihpn",""),a(this,"htyt",new W),a(this,"vbIN",new K),a(this,"haCC",!1),a(this,"GtyK",!1),a(this,"Wzag",0),a(this,"oLDv","AND"),a(this,"oOXD","OR"),a(this,"FUUU",-1),a(this,"kzZI",[]),a(this,"qann",{}),a(this,"UphY",!1),a(this,"BTWT",void 0),a(this,"Woga",void 0),a(this,"TSNF",void 0),a(this,"efkO",void 0),a(this,"no_KPI_TriggerDetails",[]),a(this,"wxci",!1),a(this,"timerDidnt",void 0),a(this,"timerDid",void 0),a(this,"initialize",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"",u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:-1,v=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];if(n.Ihpn=r,n.Wzag=i,n.kzZI=s,n.BTWT=o,n.childConditionIndex=u,n.across_sessions=a||!1,"termination"===l&&""!==l){n.vbIN.parse(e);return n.oOXD=n.vbIN.oLDv,n.qdDx(),!0}var h=n.htyt.parse(e);if(h){if(n.oLDv=n.htyt.oLDv,n.htyt.koML){var d=n.htyt.uAhq.WGsD;"APX_PAGE_OPENED"===d&&(d=n.htyt.uAhq.puNH.navigation_id,d=g(d)?d:n.htyt.uAhq.WGsD),n.FUUU=t.getController().getEventCount(d);var c=n.htyt.DupM,_=n.htyt.lwvU;if(n.GtyK=n.eVJy(n.FUUU-1,c,_,!1),n.haCC=n.GtyK,n.GtyK&&"APX_PAGE_OPENED"===n.htyt.uAhq.WGsD)return!0}return!0===v&&(o&&0!==i&&"unordered"!==o||n.eavw()),!0}return!1})),a(this,"eavw",(function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;-1!=e&&(n.Woga=e);var r=n.htyt,i=null!=r&&r._eventCategory?null==r?void 0:r._eventCategory:"specific_event",o=r.UunA,s=tt.getInstance();if("app_start"===o.HvBy)if(n.haCC=!0,null!=r&&r._timeEnabled){if("session"!=(null==r?void 0:r._time.unit)){var a=I(r._time.unit,r._time.value);if("didn't"==(null==r?void 0:r.WrlT)){if(n.UphY=!1,console.log("in didnt"),console.log("in eavw didn't"),n.timerDidnt=setTimeout((function(){console.log("setTimeout timer compleetd"),n.UphY||(n.GtyK=!0,n.GtyK&&(n.lBCr+=1,n.GtyK=n.eVJy(n.lBCr,n.htyt.DupM,n.htyt.lwvU),n.GtyK&&(n.htyt.xpWd=Date.now(),s.validate(n.Ihpn,n.Wzag,n.Woga))),"specific_event"===i?s.unregisterFromEvent(p(n.htyt.HvBy)+"___"+n.htyt.uAhq.WGsD,n.KqXn):n.YJdY(i),n.haCC=!1)}),a),n.across_sessions){var l=I(r._time.unit,r._time.value),u=r._timeEnabled,v=r._id;n.Jrnj(r.WrlT,r.uAhq.WGsD,Date.now(),r.uAhq.puNH,l,u,v)}"specific_event"===i?(s.registerForEvent(p(n.htyt.HvBy)+"___"+n.htyt.uAhq.WGsD,n.KqXn),n.efkO=n.htyt):n.xOjL(i)}else if("did"==(null==r?void 0:r.WrlT)){if(console.log("did condition"),n.timerDid=setTimeout((function(){n.wxci||("specific_event"===i?s.unregisterFromEvent(p(n.htyt.HvBy)+"___"+n.htyt.uAhq.WGsD,n.srtg):n.VQeV(i))}),a),n.across_sessions){var h=I(r._time.unit,r._time.value),d=r._timeEnabled,c=r._id;n.Jrnj(r.WrlT,r.uAhq.WGsD,Date.now(),r.uAhq.puNH,h,d,c)}"specific_event"===i?(s.registerForEvent(p(n.htyt.HvBy)+"___"+n.htyt.uAhq.WGsD,n.srtg),n.TSNF=n.htyt):n.JzgU(i)}}}else console.log("on receive event1"),"specific_event"===i?s.registerForEvent(p(r.HvBy)+"___"+r.uAhq.WGsD,n.sKQg):n.XLVY(i);else if(null!=r&&r._timeEnabled){if("session"!=(null==r?void 0:r._time.unit)){var g=I(r._time.unit,r._time.value);"didn't"==(null==r?void 0:r.WrlT)?(n.UphY=!1,n.timerDidnt=setTimeout((function(){n.UphY||(n.GtyK=!0,n.GtyK&&(n.lBCr+=1,n.GtyK=n.eVJy(n.lBCr,n.htyt.DupM,n.htyt.lwvU),n.GtyK&&(n.htyt.xpWd=Date.now(),s.validate(n.Ihpn,n.Wzag)))),"specific_event"===i&&s.unregisterFromEvent(p(n.htyt.HvBy)+"___"+n.htyt.uAhq.WGsD,n.KqXn),n.haCC=!1}),g),"specific_event"===i?(s.registerForEvent(p(n.htyt.HvBy)+"___"+n.htyt.uAhq.WGsD,n.KqXn),n.efkO=n.htyt):n.xOjL()):"did"==(null==r?void 0:r.WrlT)&&(console.log("did condition"),n.timerDid=setTimeout((function(){n.wxci||"specific_event"===i&&s.unregisterFromEvent(p(n.htyt.HvBy)+"___"+n.htyt.uAhq.WGsD,n.srtg)}),g),"specific_event"===i&&s.registerForEvent(p(n.htyt.HvBy)+"___"+n.htyt.uAhq.WGsD,n.srtg))}}else"specific_event"===i&&s.registerForEvent(p(r.HvBy)+"___"+o.uAhq.WGsD,n.sKQg);null!==(t=window.ApxorRTM)&&void 0!==t&&t.badgesLists.includes(n.Ihpn)&&(console.log("on receive event3"),s.registerForEvent(p(r.HvBy)+"___"+"apxor-badge-container-".concat("-".concat(n.Ihpn).replaceAll(" ","").replace(/[^\w\s]/gi,"")),n.sKQg))})),a(this,"XLVY",(function(t){var e=new tt;"apxor_event"===t?e.registerForEvent("apxor_event",(function(t,e,r,i){n.sKQg(p(n.htyt.HvBy),n.htyt.uAhq.WGsD,r,n.htyt.uAhq.puNH)})):"customer_event"===t?e.registerForEvent("customer_event",(function(t,e,r,i){n.sKQg(p(n.htyt.HvBy),n.htyt.uAhq.WGsD,r,n.htyt.uAhq.puNH)})):"any_event"===t?e.registerForEvent("any_event",(function(t,e,r,i){n.sKQg(p(n.htyt.HvBy),n.htyt.uAhq.WGsD,r,n.htyt.uAhq.puNH)})):"campaign_event"===t?e.registerForEvent("campaign_event",(function(t,e,r,i){n.sKQg(p(n.htyt.HvBy),n.htyt.uAhq.WGsD,r,n.htyt.uAhq.puNH)})):"survey_event"===t&&e.registerForEvent("survey_event",(function(t,e,r,i){n.sKQg(p(n.htyt.HvBy),n.htyt.uAhq.WGsD,r,n.htyt.uAhq.puNH)}))})),a(this,"YJdY",(function(t){console.log("in new eavw");var e=new tt,r=n.htyt._eventCategory;"apxor_event"===r?e.unregisterFromEvent("apxor_event",n.KqXn):"customer_event"===r?e.unregisterFromEvent("customer_event",n.KqXn):"any_event"===r?e.unregisterFromEvent("any_event",n.KqXn):"campaign_event"===r?e.unregisterFromEvent("campaign_event",n.KqXn):"survey_event"===r&&e.unregisterFromEvent("survey_event",n.KqXn)})),a(this,"xOjL",(function(){console.log("in new eavw");var t=new tt,e=n.htyt._eventCategory;"apxor_event"===e?t.registerForEvent("apxor_event",n.KqXn):"customer_event"===e?t.registerForEvent("customer_event",n.KqXn):"any_event"===e?t.registerForEvent("any_event",n.KqXn):"campaign_event"===e?t.registerForEvent("campaign_event",n.KqXn):"survey_event"===e&&t.registerForEvent("survey_event",n.KqXn)})),a(this,"JzgU",(function(){var t=new tt,e=n.htyt._eventCategory;"apxor_event"===e?t.registerForEvent("apxor_event",n.srtg):"customer_event"===e?t.registerForEvent("customer_event",n.srtg):"any_event"===e?t.registerForEvent("any_event",n.srtg):"campaign_event"===e?t.registerForEvent("campaign_event",n.srtg):"survey_event"===e&&t.registerForEvent("survey_event",n.srtg)})),a(this,"VQeV",(function(){var t=new tt,e=n.htyt._eventCategory;"apxor_event"===e?t.unregisterFromEvent("apxor_event",n.srtg):"customer_event"===e?t.unregisterFromEvent("customer_event",n.srtg):"any_event"===e?t.unregisterFromEvent("any_event",n.srtg):"campaign_event"===e?t.unregisterFromEvent("campaign_event",n.srtg):"survey_event"===e&&t.unregisterFromEvent("survey_event",n.srtg)})),a(this,"qdDx",(function(){var t=n.vbIN,e=tt.getInstance();n.haCC=!0,e.registerForEvent(p(t.HvBy)+"___"+t.uAhq.WGsD,n.ioAt)})),a(this,"oECM",(function(t,e,r,i){var o,s=(Date.now()-n.qann[e])/1e3;(null===(o=n.htyt)||void 0===o||null===(o=o.uAhq)||void 0===o||null===(o=o.puNH)||void 0===o?void 0:o.time)/1e3>s&&n._displayCampaign(r)})),a(this,"INsS",(function(t,e,r,i){var o,s;n.UphY=!0;var a=Date.now(),l=null===(o=n.htyt)||void 0===o||null===(o=o.UunA)||void 0===o?void 0:o.uAhq.WGsD,u=(a-n.qann[l])/1e3,v=null===(s=n.htyt)||void 0===s||null===(s=s.uAhq)||void 0===s||null===(s=s.puNH)||void 0===s?void 0:s.time;(v/=1e3)>u&&n._displayCampaign(r)})),a(this,"srtg",(function(){n.wxci=!0,console.log("configitem kpi check2");var t=new tt;clearTimeout(n.timerDid),n.lBCr+=1,n.GtyK=n.eVJy(n.lBCr,n.htyt.DupM,n.htyt.lwvU),n.GtyK&&(t.unregisterFromEvent(p(n.TSNF.HvBy)+"___"+n.TSNF.uAhq.WGsD,n.srtg),t.validate(n.Ihpn,n.Wzag,n.Woga))})),a(this,"KqXn",(function(t,e,r,i){n.UphY=!0,clearTimeout(n.timerDidnt),console.log("received event for nkpi"),(new tt).unregisterFromEvent(p(n.efkO.HvBy)+"___"+n.efkO.uAhq.WGsD,n.KqXn)})),a(this,"sKQg",(function(e,r,i,o){var s,a;console.log("in onreceive event"),console.log("across session value is ",n.across_sessions);var l=tt.getInstance();if(n.haCC){if(null!==(s=window.ApxorRTM)&&void 0!==s&&s.isBadgePresent&&null!==(a=window.ApxorRTM)&&void 0!==a&&a.badgesLists.includes(n.Ihpn)&&t.getController().isBadgeTriggerSatisfied(n.Ihpn))return n.GtyK=!0,n.htyt.xpWd=i,void l.validate(n.Ihpn,n.Wzag);if(p(n.htyt.HvBy)===e&&n.lFEz(i-n.htyt.UunA.xpWd,n.htyt.Eoev)&&n.htyt.uAhq.WGsD===r&&n.wRvv(n.htyt.uAhq.puNH,o)&&(console.log("increasing satisfaction count for",n.htyt.uAhq.WGsD),n.lBCr+=1,n.GtyK=n.eVJy(n.lBCr,n.htyt.DupM,n.htyt.lwvU),n.GtyK)){if(n.htyt.xpWd=i,n.across_sessions){var u=I(n.htyt._time.unit,n.htyt._time.value),v=n.htyt._timeEnabled,h=n.htyt._id,d=n.lBCr;n.Jrnj(n.htyt.WrlT,r,i,o,u,v,h,d)}l.validate(n.Ihpn,n.Wzag,n.Woga)}}else if(n.haCC=n.aFkd(e,r,i,o),n.haCC){var c=n.htyt,g=c.UunA;if(g.xpWd=i,"activity_time"===(null==c?void 0:c.HvBy)){var _,y,f,w,E=null==c||null===(_=c.uAhq)||void 0===_||null===(_=_.puNH)||void 0===_?void 0:_.time;(null==c||null===(y=c.oTpE)||void 0===y?void 0:y.length)>0?setTimeout((function(){var e;(null===(e=t.getController())||void 0===e?void 0:e._appEventsNoKpi).length<=2&&c.oTpE===location.pathname&&n._displayCampaign(i)}),E):(null==c||null===(f=c.uAhq)||void 0===f||null===(f=f.puNH)||void 0===f?void 0:f.nkpi.length)>0?(setTimeout((function(){n.UphY||(n.GtyK=!0,n.GtyK&&(n.lBCr+=1,n.GtyK=n.eVJy(n.lBCr,n.htyt.DupM,n.htyt.lwvU),n.GtyK&&(n.htyt.xpWd=i,l.validate(n.Ihpn,n.Wzag)))),c.uAhq.puNH.nkpi.map((function(t){l.unregisterFromEvent(m(c.uAhq.puNH.et)+"___"+t,n),n.haCC=!1}))}),E),c.uAhq.puNH.nkpi.map((function(t){l.registerForEvent(m(c.uAhq.puNH.et)+"___"+t,n.KqXn)}))):(null==c||null===(w=c.uAhq)||void 0===w||null===(w=w.puNH)||void 0===w?void 0:w.kpi.length)>0&&(setTimeout((function(){c.uAhq.puNH.kpi.map((function(t){l.unregisterFromEvent(m(c.uAhq.puNH.et)+"___"+t,n)}))}),E),c.uAhq.puNH.kpi.map((function(t){t===c.UunA.uAhq.WGsD?(l.unregisterFromEvent(p(g.HvBy)+"___"+g.uAhq.WGsD,n),l.registerForEvent(m(c.uAhq.puNH.et)+"___"+t,n.oECM)):l.registerForEvent(m(c.uAhq.puNH.et)+"___"+t,n.INsS)})))}else l.unregisterFromEvent(p(g.HvBy)+"___"+g.uAhq.WGsD,n),l.registerForEvent(p(c.HvBy)+"___"+c.uAhq.WGsD,n);n.qann[r]=Date.now()}})),a(this,"ioAt",(function(t,e,r,i){var o=tt.getInstance();p(n.vbIN.HvBy)===t&&n.lFEz(r,n.vbIN.Eoev)&&n.vbIN.uAhq.WGsD===e&&n.wRvv(n.vbIN.uAhq.puNH,i)&&(console.log("increasing satisfaction count for termination",n.htyt.uAhq.WGsD),n.lBCr+=1,n.GtyK=n.eVJy(n.lBCr,n.vbIN.DupM,n.vbIN.lwvU),n.GtyK&&(n.vbIN.xpWd=r,o.validateForTermination(n.Ihpn,n.Wzag)))})),a(this,"aFkd",(function(t,e,r,i){var o=n.htyt.UunA,s=p(o.HvBy)===t&&o.uAhq.WGsD===e&&n.lFEz(r,o.Eoev)&&n.wRvv(o.uAhq.puNH,i);return s="APX_PAGE_OPENED"===e?s&&location.pathname===o.uAhq.VZCp:s})),a(this,"lFEz",(function(t,e){var n=Math.ceil(t);return n>e.GWgK&&n<e.GbIO})),a(this,"eVJy",(function(t,e,r){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];switch(i&&n.htyt.koML&&(t+=n.FUUU),r){case"EQ":return t===e;case"GT":return t>e;case"GTE":return t>=e;case"LT":return t<e;case"LTE":return t<=e;default:return!1}})),a(this,"wRvv",(function(t,e){var n=!0;try{var i,o=function(){if(!1===n)return{v:!1};if("object"===r(t[s])){var i,o,a,l=t[s].op,u=t[s].t;if("s"===u)a=t[s].val;else if("l"===u||"f"===u)a=parseFloat(t[s].val);else if("b"===u)switch(t[s].val){case"true":a=!0;break;case"false":a=!1;break;default:a=t[s].val}var v,h=(Array.isArray(e[s])?e[s]:[e[s]]).some((function(t){return"s"===u?t="".concat(t):"l"===u?t=parseInt(t):"f"===u?t=parseFloat(t):"b"===u&&(t=!!t),w(t,a,l)}));if(!(null===(i=t[s])||void 0===i||!i.present)&&(null===(o=t[s])||void 0===o?void 0:o.present))v=!!e.hasOwn(e,s),n=n&&v;n=n&&h}else n=n&&w(e[s],t[s],"EQ")};for(var s in t)if(i=o())return i.v}catch(t){F.error(t),n=!1}return n})),a(this,"Jrnj",(function(e,r,i,o,s,a,l,u){console.log("persisting satisfied conditions");var v,h=!1;n.no_KPI_TriggerDetails=t.getController().getFromStorage("apx_nokpi_triggerdetails"),null===n.no_KPI_TriggerDetails||void 0===n.no_KPI_TriggerDetails?n.no_KPI_TriggerDetails=[]:n.no_KPI_TriggerDetails=JSON.parse(n.no_KPI_TriggerDetails);var d,c=0;a&&(c=Date.now()+s);for(var g=0;g<n.no_KPI_TriggerDetails.length;g++)if(n.no_KPI_TriggerDetails[g].id===l){h=!0,v=n.no_KPI_TriggerDetails[g];break}h?v.satisfiedCount+=1:(d={id:l,type:e,time:i,name:r,additionalInfo:o,satisfiedCount:u,timeBased:a,finishTime:c},n.no_KPI_TriggerDetails.push(d)),t.getController().persistToStorage("apx_nokpi_triggerdetails",JSON.stringify(n.no_KPI_TriggerDetails))})),a(this,"YmQR",(function(t){console.log("unregister all conditions");var e,r=new tt,i=h(t);try{for(i.s();!(e=i.n()).done;){var o=e.value;if(1===(null==o?void 0:o.length)||void 0===(null==o?void 0:o.length))r.unregisterFromEvent(p(null==o?void 0:o.htyt.HvBy)+"___"+(null==o?void 0:o.htyt.uAhq.WGsD),n.sKQg);else{var s,a=h(o);try{for(a.s();!(s=a.n()).done;){var l,u=s.value;r.unregisterFromEvent(p(null==u?void 0:u.htyt.HvBy)+"___"+(null==u||null===(l=u.htyt)||void 0===l?void 0:l.uAhq.WGsD),n.sKQg)}}catch(t){a.e(t)}finally{a.f()}}}}catch(t){i.e(t)}finally{i.f()}}))}return s(e,[{key:"_displayCampaign",value:function(t){console.log("in display campaign");var e=tt.getInstance();this.GtyK=!0,this.GtyK&&(this.lBCr+=1,this.GtyK=this.eVJy(this.lBCr,this.htyt.DupM,this.htyt.lwvU),this.GtyK&&(this.htyt.xpWd=t,e.validate(this.Ihpn,this.Wzag)))}}]),e}(),S=window.ApxorLogger,N=s((function e(){var n=this;i(this,e),a(this,"DupM",0),a(this,"LOYG",0),a(this,"vIGL","SESSION"),a(this,"uEjq",0),a(this,"smKZ",0),a(this,"KwCq",0),a(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{n.Ihpn=t._id,n.robm=t.meta,n.DupM=t.frequency.count,-1===n.DupM&&(n.DupM=1e3),n.KwCq=n.DupM,n.LOYG=t.frequency.time_interval,n.vIGL=t.frequency.validity,n.smKZ=t.frequency.ses_lmt,n._dayCount=t.frequency.day_lmt;var e=tt.getInstance().getQeState();if(!g(e)||!g(e[t._id]))return!0;if("SESSION"===n.vIGL){if(n.DupM=parseInt(n.DupM)-parseInt(e[t._id].SESSION),n.DupM<=0)return n.cldn("Session limit reached"),console.warn("Max count limit reached for session:"+t._id),!1}else{if("OVERALL"!==n.vIGL)return S.info("Invalid config."),!1;if(n.DupM=parseInt(n.DupM)-parseInt(e[t._id].OVERALL),n.DupM<=0)return n.cldn("Overall limit reached"),console.warn("Max count limit reached for overall:"+t._id),!1}}catch(t){return S.error(t),!1}return!0})),a(this,"iFHl",(function(){n.DupM=n.DupM-1})),a(this,"getFrequencyCount",(function(){return n.DupM})),a(this,"oHOA",(function(){"SESSION"===n.vIGL&&(n.DupM=n.KwCq,S.info("Campaign Limit reset"))})),a(this,"Mlxr",(function(t){try{if(n.DupM<=0)return"OVERALL"===n.vIGL?n.cldn("Overall limit reached"):"SESSION"===n.vIGL&&n.cldn("Session limit reached"),!1;var e=tt.getInstance().getQeState();if(!g(e)||!g(e[t]))return!0;if(0!==n.smKZ)if(parseInt(n.smKZ)-parseInt(e[t].SESSION)<=0)return n.cldn("Session limit reached"),!1;if(0!==n._dayCount){var r,i=A();if(parseInt(n._dayCount)-parseInt((null===(r=e[t])||void 0===r?void 0:r.DATES[i])||0)<=0)return n.cldn("Day limit reached"),!1}}catch(t){n.cldn("Error validating the frequency: ".concat(t)),S.error("Error validating the frequency:"+t)}return!0})),a(this,"cldn",(function(e){var r;null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===n.robm.type?"survey":"campaign",apx_nudge_id:n.Ihpn,apx_nudge_name:n.robm.name,apx_variant_code:n.robm.isExperiment||n.robm.only_context?null===(r=n.robm.attr)||void 0===r?void 0:r.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:e})}))})),L=window.ApxorLogger,O=s((function t(){var e=this;i(this,t),a(this,"laXI",[]),a(this,"deKL",0),a(this,"FVBZ",!1),a(this,"lLCK",void 0),a(this,"initialize",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"unordered",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],s=arguments.length>5?arguments[5]:void 0,a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];e.Ihpn=n,e.Wzag=r,e.kzZI=o,e.BTWT=i,e.across_sessions=a;var l=[];e.deKL=t.length;try{if(null!=l)return i=null==t?void 0:t.sequence_type,l=e.jxDh(t,e.deKL),"unordered"!==s&&0!==e.Wzag||e.eavw(),e.laXI}catch(t){return L.error(t),!1}})),a(this,"jxDh",(function(t,n){for(var r=0;r<n;r++){e.lLCK=new G;try{e.lLCK.initialize(t[r],e.Ihpn,e.Wzag,e.BTWT,e.sWSS,e.across_sessions,"",-1,!1)&&(e.laXI.push(e.lLCK),e.laXI.sequence_type=e.BTWT)}catch(t){L.error(t)}}return e.laXI})),a(this,"eavw",(function(){if("ordered"===e.BTWT||"strictly_ordered"===e.BTWT)e.laXI[0].eavw(0);else{var t,n=h(e.laXI);try{for(n.s();!(t=n.n()).done;){t.value.eavw()}}catch(t){n.e(t)}finally{n.f()}}})),a(this,"YmQR",(function(t){console.log("unregister all conditions group"),e.lLCK.YmQR(t)}))})),H=s((function t(){var e=this;i(this,t),a(this,"WGsD",""),a(this,"WrlT",""),a(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var n,r;e.WGsD=t.meta.name,e.WrlT=t.meta.type,e._only_context=t.meta.only_context,e._attr=(null===(n=t.meta)||void 0===n?void 0:n.attr)||{},e._isExperiment=null===(r=t.meta)||void 0===r?void 0:r.isExperiment}catch(t){return window.ApxorLogger.error(t),!1}return!0}))})),X=window.ApxorLogger,U=s((function e(){var n=this;i(this,e),a(this,"iIqe",[]),a(this,"_ret_day",{}),a(this,"tCUX",{}),a(this,"cnQP",!1),a(this,"PPjB",!1),a(this,"retainedDaysValidated",!0),a(this,"retainedSessionValidated",!0),a(this,"eventDoneInLT",!1),a(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{n.iIqe=t.overall_cfg.events,n._ret_day=t.overall_cfg.ret_day,n.tCUX=t.overall_cfg.session,n.cnQP=t.overall_cfg.toggleRetDay,n.PPjB=t.overall_cfg.toggleSession}catch(t){return X.error(t),!1}return!0})),a(this,"validate",(function(){var e=parseInt(t.getController().getFromStorage("apx_retained_days")),r=parseInt(t.getController().getFromStorage("apx_retained_session"));if(n.cnQP&&!isNaN(e)&&!(e>=n._ret_day.from&&e<=n._ret_day.to))return n.retainedDaysValidated=!1,!1;if(n.PPjB&&!isNaN(r)&&!(r>=n.tCUX.from&&r<=n.tCUX.to))return n.retainedSessionValidated=!1,!1;try{for(var i=t.getController().getFromStorage("_apx_lt_count"),o=t.getSiteId(),s=JSON.parse((new TextDecoder).decode(function(t){for(var e=new ArrayBuffer(t.length),n=new Uint8Array(e),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return e}(f(o,i)))),a=0;a<n.iIqe.length;a++){if(s[n.iIqe[a].name.replace("'","").replace("â€™","")])return n.eventDoneInLT=!0,!1}}catch(t){X.error("Failed to validate the lt count:"+t)}return!0}))})),k=window.ApxorLogger,P=s((function t(){var e=this;i(this,t),a(this,"atlg",[]),a(this,"nCNt",[]),a(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(e.atlg=t.attributes.user,e.nCNt=t.attributes.session,!Array.isArray(e.atlg)||!Array.isArray(e.nCNt))return k.error("No attributes"),!1}catch(t){return k.error(t),!1}return!0})),a(this,"validate",(function(t,n){return e.EWzj(t,e.atlg)&&e.EWzj(n,e.nCNt)})),a(this,"EWzj",(function(t,e){var n=e.length,r=!0;try{for(var i,o=function(){var n=e[s];if(!t[n.name]||!1===r)return{v:!1};var i=n.operator,o=n.type,a=n.value.map((function(t){return"s"===o?t:"l"===o?parseInt(t):"f"===o?parseFloat(t):void 0})),l=(Array.isArray(t[n.name])?t[n.name]:[t[n.name]]).some((function(t){return a.some((function(e){return w(t,e,i)}))}));r=r&&l},s=0;s<n;s++)if(i=o())return i.v}catch(t){k.error(t),r=!1}return r}))})),M=s((function e(){var n=this;i(this,e),a(this,"jkVT",t.getController()),a(this,"type",""),a(this,"_duration_seconds",0),a(this,"MxIR",1),a(this,"parse",(function(t){try{var e,r,i;if(n.WrlT=null===(e=t.terminate_info.time_based)||void 0===e?void 0:e.type,n._duration_seconds=null===(r=t.terminate_info)||void 0===r?void 0:r.time_based.duration_seconds,n.MxIR=null===(i=t.terminate_info.time_based)||void 0===i?void 0:i.days,n.enVr(t._id))return n.jkVT.persistTerminationInfoLocally(t._id),!1}catch(t){return!1}return!0})),a(this,"enVr",(function(t){var e,r=JSON.parse(n.jkVT.getFromStorage("apx_termination_ID"));if(!r[t]||null===(e=r[t])||void 0===e||!e.startDate)return!1;var i,o=new Date(r[t].startDate),s=new Date((i=new Date).getMonth()+"/"+i.getDate()+"/"+i.getFullYear()),a=parseInt((s-o)/864e5,10),l=function(){var t=new Date;return{hours:t.getHours(),mins:t.getMinutes()}}(),u=r[t].wXlC;return a===n.MxIR&&l.hours>=u.hours||a>n.MxIR||r[t].goalAcheived}))})),V=s((function t(){var e=this;i(this,t),a(this,"enable_goal_events",!1),a(this,"attributes",{}),a(this,"Fcrd",new P),a(this,"KzPh",new M),a(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var n,r,i;if(e.enable_time_based=null==t||null===(n=t.terminate_info)||void 0===n?void 0:n.enable_time_based,e.enable_time_based&&!e.KzPh.parse(t))return!1;if(e.enable_goal_events=null==t||null===(r=t.terminate_info)||void 0===r?void 0:r.enable_goal_events,e.enable_attributes=null==t||null===(i=t.terminate_info)||void 0===i?void 0:i.enable_attributes,e.enable_attributes&&!e.Fcrd.parse(t.terminate_info))return!1}catch(t){return window.ApxorLogger.error(t),!1}return!0})),a(this,"validate",(function(t,n){return e.Fcrd.validate(t,n)}))})),j=window.ApxorLogger,J=s((function t(){var e=this;i(this,t),a(this,"gDpQ",-1),a(this,"WWXk",-1),a(this,"wXlC",-1),a(this,"MpoD",-1),a(this,"Oyqh",!1),a(this,"_nudge_expired",!1),a(this,"_not_yet_active",!1),a(this,"_not_in_specified_time",!1),a(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(isNaN(Date.parse(t.validity.start_date))||isNaN(Date.parse(t.validity.end_date)))return j.error("Not valid dates"),!1;if(e.gDpQ=Date.parse(t.validity.start_date),e.WWXk=Date.parse(t.validity.end_date),g(t.at_specific_time)&&(e.Oyqh=t.at_specific_time,e.Oyqh&&g(t.time_limits))){var n=(new Date).toISOString().split("T")[0];if(e.wXlC=Date.parse(n+"T"+t.time_limits.start_time+":00.000Z"),e.MpoD=Date.parse(n+"T"+t.time_limits.end_time+":00.000Z"),isNaN(e.wXlC)||isNaN(e.MpoD))return j.error("Not valid times"),!1}}catch(t){return j.error(t),!1}return!0})),a(this,"validate",(function(){var t=Date.now();return t>e.gDpQ&&t<e.WWXk?(!e.Oyqh||t>=e.wXlC&&t<=e.MpoD||(e._not_in_specified_time=!0),!e.Oyqh||t>=e.wXlC&&t<=e.MpoD):(t<e.gDpQ?e._not_yet_active=!0:t>e.WWXk&&(e._nudge_expired=!0),!1)}))})),z=window.ApxorLogger,Y=s((function e(){var r=this;i(this,e),a(this,"wIrB",[]),a(this,"EEsA",[]),a(this,"Ihpn",""),a(this,"robm",new H),a(this,"zWSn",new T),a(this,"vIGL",new J),a(this,"FGQd",new N),a(this,"XkIk",new U),a(this,"xanb",new V),a(this,"BTWT",!1),a(this,"sWSS",[]),a(this,"_variant_code",""),a(this,"FVBZ",!1),a(this,"groupCombineOperator","OR"),a(this,"UphY",!1),a(this,"VkHM",!1),a(this,"UDET",void 0),a(this,"timeForKPI",void 0),a(this,"kpiIndex",0),a(this,"Fjex",void 0),a(this,"_across_sessions",!1),a(this,"uhlI",void 0),a(this,"RPHo",!1),a(this,"uTcy",void 0),a(this,"KXTL",void 0),a(this,"dGDk",void 0),a(this,"QtRl",void 0),a(this,"wtNA",void 0),a(this,"tnsW",void 0),a(this,"LkPK",void 0),a(this,"LAus",void 0),a(this,"qIvz",void 0),a(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var e,n;if(!g(t._id))return z.error("No Id"),!1;if(!g(t.enabled)||!t.enabled)return z.error("Not enabled"),!1;if(!(r.robm.parse(t)&&r.vIGL.parse(t)&&r.FGQd.parse(t)&&r.zWSn.parse(t)&&r.XkIk.parse(t)&&r.xanb.parse(t)))return!1;if(r._variant_code=r.robm._isExperiment||r.robm._only_context?null===(e=r.robm._attr)||void 0===e?void 0:e.apx_variant_code:"TG",r._across_sessions=!(null==t||!t.across_sessions)&&(null==t?void 0:t.across_sessions),!g(t.conditions)||!Array.isArray(t.conditions))return z.error("No valid conditions",t.conditions),!1;r.Ihpn=t._id,r.BTWT=!!g(t.sequence_enabled)&&t.sequence_enabled,g(t.conditions_v2)&&(r.BTWT=null==t?void 0:t.sequence_type),!0===r.BTWT&&t.conditions.sort((function(t,e){return t.sequence<e.sequence})),g(t.conditions_v2)?(n=t.conditions_v2,r.RPHo=!0):n=t.conditions,r.uhlI=n;var i=n.length;if(r.bRoh(n,i),console.log(r.wIrB),r.bTOD(),console.log(r.wIrB),r.xanb.enable_goal_events)for(var o=t.terminate_info.goal_events.events,s=o.length,a=0;a<s;a++){var l=new G;l.initialize(o[a],r.Ihpn,a,!0,[],r._across_sessions,"termination")&&r.EEsA.push(l)}return console.log("conditional validator parse"),r.wIrB.length>0}catch(t){return z.error(t),!1}})),a(this,"bRoh",(function(t,e){for(var n=0;n<e;n++){r.sWSS=[];var i=t[n];if("group"===(null!=i&&i.condition_type?null==i?void 0:i.condition_type:"single")){var o=i.conditions_v2;r.groupCombineOperator=i.combine_operator;var s=null==i?void 0:i.sequence_type;r.qIvz=new O;var a=r.qIvz.initialize(o,r.Ihpn,n,s,r.sWSS,r.BTWT,r._across_sessions);r.wIrB.push(a),console.log(r.qIvz)}else{if("didn't"===i.type){var u,v={trigger_key:i.trigger.details.name,no_kpi_array:null==i||null===(u=i.details)||void 0===u||null===(u=u.additional_info)||void 0===u?void 0:u.nkpi,condition_id:null==i?void 0:i._id,time_bounds:i.time_bounds.upper};r.sWSS=[].concat(l(r.sWSS),[v])}r.qIvz=new G,r.qIvz.initialize(i,r.Ihpn,n,r.BTWT,r.sWSS,r._across_sessions)&&(r.wIrB.push(r.qIvz),console.log(r.wIrB))}}})),a(this,"bTOD",(function(){if(r._across_sessions&&"ordered"===r.BTWT){var e=!1;console.log("across_sesions_case");var n=t.getController().getFromStorage("apx_nokpi_triggerdetails");if(null!=(n=JSON.parse(n))&&null!=n)for(var i=function(t){var i,o,s;if(null!==(i=r.wIrB[t])&&void 0!==i&&null!==(i=i.htyt)&&void 0!==i&&i._timeEnabled&&void 0===r.wIrB[t].length){if("didn't"===r.wIrB[t].htyt.WrlT){var a=r.wIrB[t].htyt._id,l=r.JFCI(a,n);if(l)if(Date.now()>l.finishTime)r.wIrB[t].GtyK=!0,r.wIrB[t].lBCr=l.satisfiedCount,e=!0;else{var u=l.finishTime-Date.now(),v=r.wIrB[t].htyt._eventCategory?r.wIrB[t].htyt._eventCategory:"specific_event",h=new tt;"specific_event"===v?(h.registerForEvent(p(r.wIrB[t].htyt.HvBy)+"___"+r.wIrB[t].htyt.uAhq.WGsD,r.KqXn),r.wtNA=r.wIrB[t]):r.xOjL(v),setTimeout((function(){t!==r.wIrB.length-1||r.UphY||(r.wIrB[t].GtyK=!0,r.wIrB[t].lBCr=l.satisfiedCount,e=!0,"specific_event"===v?h.unregisterFromEvent(p(r.wIrB[t].htyt.HvBy)+"___"+r.wIrB[t].htyt.uAhq.WGsD,r.KqXn):r.itRr(r.wIrB[t]),r.pKYM())}),u)}}if("did"===r.wIrB[t].htyt.WrlT){var d=r.wIrB[t].htyt._id,c=r.JFCI(d,n);if(c)if(null==c.satisfiedCount){if(Date.now()<c.finishTime){console.log("time is left will add set time out again"),r.dGDk=c,r.KXTL=t;var g=c.finishTime-Date.now(),_=r.wIrB[t].htyt._eventCategory?r.wIrB[t].htyt._eventCategory:"specific_event",y=new tt;"specific_event"===_?y.registerForEvent(p(r.wIrB[t].htyt.HvBy)+"___"+r.wIrB[t].htyt.uAhq.WGsD,r.BmGp):r.xOjL(_),setTimeout((function(){"specific_event"===_?y.unregisterFromEvent(p(r.wIrB[t].htyt.HvBy)+"___"+r.wIrB[t].htyt.uAhq.WGsD,r.BmGp):r.itRr(r.wIrB[t])}),g)}}else r.wIrB[t].lBCr=c.satisfiedCount,r.wIrB[t].GtyK=!0}}else e=r.OcoJ(t,n);e&&(null===(o=r.wIrB[t])||void 0===o||null===(o=o.htyt)||void 0===o||!o._timeEnabled||(null===(s=r.wIrB[t])||void 0===s?void 0:s.length)>1)?t===r.wIrB.length-1&&r.pKYM():e||void 0===!r.wIrB[t].length&&r.wIrB[t].eavw()},o=0;o<r.wIrB.length;o++)i(o)}else if(r._across_sessions&&"unordered"===r.BTWT){var s=t.getController().getFromStorage("apx_nokpi_triggerdetails");if(null!=(s=JSON.parse(s))&&null!=s)for(var a=0;a<r.wIrB.length;a++)r.OcoJ(a,s)}})),a(this,"OcoJ",(function(t,e){if(void 0===r.wIrB[t].length||1===r.wIrB[t].length){var n=r.wIrB[t].htyt._id,i=!1,o=r.JFCI(n,e);if(o)r.uTcy=o,i=(new G).eVJy(o.satisfiedCount,r.wIrB[t].htyt.DupM,r.wIrB[t].htyt.lwvU),o&&(i?r.wIrB[t].GtyK=!0:r.wIrB[t].lBCr=o.satisfiedCount);else r.wIrB[t].eavw();return i}if(r.wIrB[t].length>=1){var s,a,l;if("ordered"===(a=null===(s=r.wIrB[t])||void 0===s?void 0:s.sequence_type)||"strictly_ordered"===a){for(var u=0;u<r.wIrB[t].length;u++){var v=r.wIrB[t][u],h=v.htyt._id;l=!1;var d=r.JFCI(h,e);if(d){if(l=(new G).eVJy(d.satisfiedCount,v.htyt.DupM,v.htyt.lwvU),d)if(l){r.wIrB[t][u].GtyK=!0;var _=u+1;console.log("nested and then");var y=r.wIrB[t][u+1];void 0===y&&g(r.wIrB[t+1])&&(r.wIrB[t+1].eavw(),l=!0),null!=y&&r.wIrB[t][u+1].eavw(_)}else r.wIrB[t][u].lBCr=d.satisfiedCount}else(g(r.wIrB[t][u-1])&&!0===r.wIrB[t][u].GtyK||c(r.wIrB[t][u-1]))&&r.wIrB[t][u].eavw()}return l}for(var f,p=0;p<r.wIrB[t].length;p++){var m=r.wIrB[t][0].htyt.oLDv;f="OR"!==m;var w=r.wIrB[t][p],I=w.htyt._id;l=!1;var E=r.JFCI(I,e);if(E)l=(new G).eVJy(E.satisfiedCount,w.htyt.DupM,w.htyt.lwvU),E&&(l?r.wIrB[t][p].GtyK=!0:r.wIrB[t][p].lBCr=E.satisfiedCount);else w.eavw();f="AND"===m?f&&l:f||l}return f}})),a(this,"JFCI",(function(t,e){return e.find((function(e){return e.id===t}))})),a(this,"YHBT",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;console.log("coming to YHBT");var i=tt.getInstance();if(!(e<0)){var o=r.wIrB[e],s="unordered";if((null==o?void 0:o.length)>1&&(s=null==o?void 0:o.sequence_type),!0===r.BTWT||"ordered"===r.BTWT||"strictly_ordered"===r.BTWT||"ordered"===s||"strictly_ordered"===s){console.log("respect sequence ordered"),r.kpiIndex=e+1;var a=r.wIrB[e];if((null==a?void 0:a.length)>0){if(g(a))if("unordered"===r.BTWT&&"ordered"===s){var l=o[n-1];if(g(l))if(void 0===l.length||1==l.length){if(!l.GtyK)return}else if(l.length>1&&!r.ramd(l))return;var u,v=o[n+1];if(g(v)){if(v.eavw(n+1),"strictly_ordered"===r.BTWT){r._currentEventname=a[n].htyt.uAhq.WGsD;var d=t.getController();d.registerForEvent("APP_EVENT",r.UcZS),d.registerForEvent("CLIENT_EVENT",r.UcZS)}}else if("strictly_ordered"===s)1!=r.FVBZ&&r.pKYM();else(null===(u=o[n])||void 0===u?void 0:u.length)>0?r.ramd(o)&&r.pKYM():r.pKYM()}else{var c,_=r.wIrB[e-1];if(g(_))if(void 0===_.length||1==_.length){if(!_.GtyK)return}else if(_.length>1&&!r.ramd(_))return;if(void 0===a.length||1===a.length?c=r.wIrB[e+1]:a.length>1&&("ordered"===s||"strictly_ordered"===s?c=n===a.length-1?r.wIrB[e+1]:r.wIrB[e][n+1]:r.ramd(a)&&(c=r.wIrB[e+1])),g(c)){if(void 0===c.length||1===c.length)c.eavw(n+1);else if(r.ramd(a))if(void 0===c.length)c.eavw();else if(c.length>1)if("unordered"===c.sequence_type)for(var y=0;y<c.length;y++)c[y].eavw(y);else"ordered"!==c.sequence_type&&"strictly_ordered"!==c.sequence_type||c[0].eavw(0);if("strictly_ordered"===r.BTWT){r._currentEventname=a[n].htyt.uAhq.WGsD;var f=t.getController();f.registerForEvent("APP_EVENT",r.UcZS),f.registerForEvent("CLIENT_EVENT",r.UcZS)}}else"strictly_ordered"===r.BTWT?1!=r.FVBZ&&r.pKYM():r.ramd(a)&&r.pKYM()}}else if(g(a)&&a.GtyK){a.qann[a.htyt.uAhq.WGsD]=Date.now();var m=r.wIrB[e-1];if(g(m))if(void 0===m.length||1==m.length){if(!m.GtyK)return}else if(m.length>1&&!r.ramd(m))return;var w=r.wIrB[e+1];if(g(w)){var E,A;if(null!=w&&null!==(E=w.htyt)&&void 0!==E&&E._timeEnabled){if("session"!=(null===(A=w.htyt)||void 0===A?void 0:A._time.unit)){var b,T,B=I(w.htyt._time.unit,w.htyt._time.value);if("didn't"==(null===(b=w.htyt)||void 0===b?void 0:b.WrlT)){if(r.LkPK=setTimeout((function(){if(!r.UphY){if(w.GtyK=!0,w.GtyK){w.lBCr+=1;var t=new G;if(w.GtyK=t.eVJy(w.lBCr,w.htyt.DupM,w.htyt.lwvU),console.log("expected here"),w.GtyK){w.htyt.xpWd=Date.now();var n=e+1,o=r.wIrB[n+1];g(o)?(console.log("registering next condition"),o.eavw()):r.pKYM()}}i.unregisterFromEvent(p(w.htyt.HvBy)+"___"+w.htyt.uAhq.WGsD,r.KqXn),w.haCC=!1}}),B),console.log("expected here"),r._across_sessions){var D=I(w.htyt._time.unit,w.htyt._time.value),C=w.htyt._timeEnabled,q=w.htyt._id,W=new G;W.Jrnj(w.htyt.WrlT,w.htyt.uAhq.WGsD,Date.now(),w.htyt.uAhq.puNH,D,C,q)}console.log(w.htyt._timeEnabled),"specific_event"===w.htyt._eventCategory?(i.registerForEvent(p(w.htyt.HvBy)+"___"+w.htyt.uAhq.WGsD,r.KqXn),r.wtNA=w):r.xOjL(w)}else if("did"==(null===(T=w.htyt)||void 0===T?void 0:T.WrlT)&&(r.UphY=!1,r.Fjex=w,g(r.wIrB[e+2])&&r._across_sessions&&(r.QtRl=r.wIrB[e+2]),r.LAus=setTimeout((function(){r.UphY||(r.UphY=!1,i.unregisterFromEvent(p(w.htyt.HvBy)+"___"+w.htyt.uAhq.WGsD,r.INsS))}),B),r.UDET=a,r.timeForKPI=B,i.registerForEvent(p(w.htyt.HvBy)+"___"+w.htyt.uAhq.WGsD,r.INsS),r.tnsW=w,console.log("error check"),r._across_sessions)){var x=I(w.htyt._time.unit,w.htyt._time.value),K=w.htyt._timeEnabled,F=w.htyt._id,S=new G;S.Jrnj(w.htyt.WrlT,w.htyt.uAhq.WGsD,Date.now(),w.htyt.uAhq.puNH,x,K,F)}}}else if(w.length>0)if("ordered"===w.sequence_type||"strictly_ordered"===w.sequence_type)w[0].eavw(n+1);else{var N,L=h(w);try{for(L.s();!(N=L.n()).done;){var O=N.value;O.eavw()}}catch(t){L.e(t)}finally{L.f()}}else w.eavw();if(console.log("validating second condition"),"strictly_ordered"===r.BTWT){r._currentEventname=a.htyt.uAhq.WGsD;var H=t.getController();H.registerForEvent("APP_EVENT",r.UcZS),H.registerForEvent("CLIENT_EVENT",r.UcZS)}}else"strictly_ordered"===r.BTWT?1!=r.FVBZ&&r.pKYM():r.pKYM()}}else r.yHuO(),console.log(r.wIrB),r.pKYM()}})),a(this,"UcZS",(function(t){t&&t.name!=r._currentEventname&&(r.FVBZ=!0)})),a(this,"xOjL",(function(t){var e=new tt,n=t.htyt._eventCategory;"apxor_event"===n?e.registerForEvent("apxor_event",r.KqXn):"customer_event"===n?e.registerForEvent("customer_event",r.KqXn):"any_event"===n?e.registerForEvent("any_event",r.KqXn):"campaign_event"===n?e.registerForEvent("campaign_event",r.KqXn):"survey_event"===n&&e.registerForEvent("survey_event",r.KqXn)})),a(this,"itRr",(function(t){var e=new tt,n=t.htyt._eventCategory;"apxor_event"===n?e.unregisterFromEvent("apxor_event",r.KqXn):"customer_event"===n?e.unregisterFromEvent("customer_event",r.KqXn):"any_event"===n?e.unregisterFromEvent("any_event",r.KqXn):"campaign_event"===n?e.unregisterFromEvent("campaign_event",r.KqXn):"survey_event"===n&&e.unregisterFromEvent("survey_event",r.KqXn)})),a(this,"KqXn",(function(){var t,e;console.log("received event of nkpi"),r.LkPK&&clearTimeout(r.LkPK);var n=new tt;r.UphY=!0,r._across_sessions&&null!==localStorage.getItem("apx_nokpi_triggerdetails")&&localStorage.removeItem("apx_nokpi_triggerdetails"),n.unregisterFromEvent(p(null===(t=r.wtNA)||void 0===t||null===(t=t.htyt)||void 0===t?void 0:t.HvBy)+"___"+(null===(e=r.wtNA)||void 0===e||null===(e=e.htyt)||void 0===e||null===(e=e.uAhq)||void 0===e?void 0:e.WGsD),r.KqXn)})),a(this,"INsS",(function(){var e,n,i,o=new tt;console.log("configitem kpi check"),r.UphY=!0,r.LAus&&clearTimeout(r.LAus);var s=new G;if(r.Fjex.lBCr+=1,r.Fjex.GtyK=s.eVJy(r.Fjex.lBCr,r.Fjex.htyt.DupM,r.Fjex.htyt.lwvU),o.unregisterFromEvent(p(null===(e=r.tnsW)||void 0===e||null===(e=e.htyt)||void 0===e?void 0:e.HvBy)+"___"+(null===(n=r.tnsW)||void 0===n||null===(n=n.htyt)||void 0===n?void 0:n.uAhq.WGsD),r.INsS),r._across_sessions&&null!==(i=r.QtRl)&&void 0!==i&&i.htyt._timeBased){var a,l,u,v=t.getController().getFromStorage("apx_nokpi_triggerdetails");v=null==v?[]:JSON.parse(v);for(var h=0;h<v.length;h++)if(r.no_KPI_TriggerDetails[h].id===r.QtRl.htyt._id){a=!0,l=v[h];break}if(a)l.satisfiedCount+=1;else{var d=r.Fjex.htyt._id,c=r.Fjex.htyt.WrlT,_=r.Fjex.htyt.uAhq.WGsD,y=r.Fjex.htyt.uAhq.puNH;u={id:d,type:c,time:Date.now(),name:_,additionalInfo:y,satisfiedCount:r.Fjex.htyt._timeEnabled,timeBased:r.Fjex.htyt._timeEnabled},r.no_KPI_TriggerDetails.push(u)}}if(r.Fjex.GtyK){var f=r.wIrB[r.kpiIndex+1];g(f)?f.eavw():r.pKYM()}})),a(this,"BmGp",(function(){if(r.KXTL===r.wIrB.length-1){r.VkHM=!0;r.wIrB[r.KXTL]&&(r.wIrB[r.KXTL].lBCr=r.dGDk.satisfiedCount,r.wIrB[r.KXTL].GtyK=!0,r.pKYM())}else{var e,n,i=t.getController().getFromStorage("apx_nokpi_triggerdetails");i=null==i?[]:JSON.parse(i);for(var o=0;o<i.length;o++)if(i[o].id===r.KXTL){n=!0,e=i[o];break}if(n&&(e.satisfiedCount=1),t.getController().persistToStorage("apx_nokpi_triggerdetails",JSON.stringify(i)),r.wIrB[r.KXTL].lBCr=r.dGDk.satisfiedCount,r.wIrB[r.KXTL].GtyK=!0,r.wIrB[r.KXTL+1].htyt._timeEnabled){var s=I(r.wIrB[r.KXTL+1].htyt._time.unit,r.wIrB[r.KXTL+1].htyt._time.value),a=r.wIrB[r.KXTL+1].htyt._timeEnabled,l=r.wIrB[r.KXTL+1].htyt._id,u=r.wIrB[r.KXTL+1].lBCr,v=r.wIrB[r.KXTL+1].htyt.uAhq.WGsD,h=r.wIrB[r.KXTL+1].uAhq.puNH;(new G).Jrnj(r.htyt.WrlT,v,Date.now(),h,s,a,l,u)}}})),a(this,"yHuO",(function(){if(r._across_sessions&&r.RPHo){var e,n,i,o="single",s=!1,a=t.getController().getFromStorage("apx_nokpi_triggerdetails");if(a=JSON.parse(a),console.log(a),a.length>0){var l,u=h(a);try{var v=function(){var t=l.value;console.log(t);var a=t.id,u=t.satisfiedCount;if(e=r.wIrB.find((function(t,e){if(1===(null==t?void 0:t.length)||void 0===(null==t?void 0:t.length)){if(t.htyt._id===a)return o="single",n=e,!0}else if(t.length>0){var r=t.findIndex((function(t){return t.htyt._id===a}));if(-1!==r)return console.log("Matching Condition Index:",e),n=e,console.log("Nested Condition Index:",r),i=r,o="group",!0}return!1})),"single"===o&&e){var v=new G;s=v.eVJy(u,e.htyt.DupM,e.htyt.lwvU);var h=r.wIrB.findIndex((function(t){var e;return(null==t||null===(e=t.htyt)||void 0===e?void 0:e._id)===a}));void 0===h&&(h=n),s&&(r.wIrB[h].GtyK=!0)}else if("group"===o&&e){var d=new G;(s=d.eVJy(u,e[i].htyt.DupM,e[i].htyt.lwvU))&&(r.wIrB[n][i].GtyK=!0,console.log(r.wIrB))}};for(u.s();!(l=u.n()).done;)v()}catch(t){u.e(t)}finally{u.f()}}}})),a(this,"BQPt",(function(t){t<0||r.JjjT()})),a(this,"pKYM",(function(){var e,i;console.log("in validate all conditions");var o=t.getController().getUserAttributes(),s=t.getController().getSessionAttributes();if(null!==(e=window.ApxorRTM)&&void 0!==e&&e.isBadgePresent&&null!==(i=window.ApxorRTM)&&void 0!==i&&i.badgesLists.includes(r.Ihpn)&&t.getController().isBadgeTriggerSatisfied(r.Ihpn)||null==t||t.logEvent("apx_trigger_satisfied",{apx_nudge_type:"SURVEY"===r.robm.WrlT?"survey":"campaign",apx_nudge_id:r.Ihpn,apx_nudge_name:r.robm.WGsD,apx_variant_code:r.robm._isExperiment||r.robm._only_context?r.robm._attr.apx_variant_code:"TG"}),!r.vIGL.validate()||!r.zWSn.validate(o,s)||!r.XkIk.validate()){r.robm.WrlT;return r.XkIk.retainedDaysValidated?r.XkIk.retainedSessionValidated?r.XkIk.eventDoneInLT?void r.cldn("Event done in life time"):r.zWSn.userAttributesValidated?r.zWSn.sessionAttributeValidated?r.vIGL._not_in_specified_time?void r.cldn("Time limits check failed"):r.vIGL._not_yet_active?void r.cldn("not in the scheduled time"):r.vIGL._nudge_expired?void r.cldn("nudge expired"):void 0:void r.cldn("Session property filter not met"):void r.cldn("User property filter not met"):void r.cldn("User session criteria not met"):void r.cldn("Retained day criteria not met")}for(var a=r.wIrB.length,l=a<1,u="",v=0;v<a;v++){var d=void 0,c=r.wIrB[v];if(c.length>1){d="AND"===c[0].htyt.oLDv;for(var g=0;g<c.length;g++){d="AND"===c[0].htyt.oLDv?d&&c[g].GtyK:d||c[g].GtyK}}else d=c.GtyK;if(""===u.trim())l=d;else switch(u){case"AND":l=l&&d;break;case"OR":l=l||d}u=c.length>1?r.groupCombineOperator:c.oLDv}if(l){var _,y;if(console.debug("onCondition satisfied"),!r.FGQd.Mlxr(r.Ihpn))return void console.warn("Maximum limit reached",r.Ihpn);if(!(null!==(_=window.ApxorRTM)&&void 0!==_&&_.isBadgePresent&&null!==(y=window.ApxorRTM)&&void 0!==y&&y.badgesLists.includes(r.Ihpn)&&t.getController().isBadgeTriggerSatisfied(r.Ihpn))){var f="SURVEY"===r.robm.WrlT?"survey":"campaign";null==t||t.logEvent("apx_trigger_satisfied",{apx_nudge_type:"SURVEY"===r.robm.WrlT?"survey":"campaign",apx_nudge_id:r.Ihpn,apx_nudge_name:r.robm.WGsD,apx_variant_code:r.robm._isExperiment||r.robm._only_context?r.robm._attr.apx_variant_code:"TG"},!1,"",f)}console.log("Dispatching event",r.robm.WrlT),r._across_sessions&&localStorage.removeItem("apx_nokpi_triggerdetails");var p,m=h(r.wIrB);try{for(m.s();!(p=m.n()).done;){var w=p.value;if(1===(null==w?void 0:w.length)||void 0===(null==w?void 0:w.length))w.GtyK=!1,w.lBCr=0;else{var I,E=h(w);try{for(E.s();!(I=E.n()).done;){var A=I.value;A.GtyK=!1,A.lBCr=0}}catch(t){E.e(t)}finally{E.f()}}}}catch(t){m.e(t)}finally{m.f()}if(console.log("got cv well"),r.qIvz.YmQR(r.wIrB),console.log(r.wIrB),!0===r.robm._only_context){var b="SURVEY"===r.robm.WrlT?"survey":"campaign";t.logEvent("apx_context_evaluated",n(n({},r.robm._attr),{},{message_name:r.robm.WGsD,id:r.Ihpn}),!1,"",b)}t.getController().dispatchEvent(r.robm.WrlT,{name:r.robm.WrlT,additional_info:{uuid:r.Ihpn,name:r.robm.WGsD}})}})),a(this,"JjjT",(function(){for(var e=r.EEsA.length,i=e<1,o="",s=0;s<e;s++){var a=r.EEsA[s],l=a.GtyK;if(""===o.trim())i=l;else switch(o){case"AND":i=i&&l;break;case"OR":i=i||l}o=a.oOXD}if(i){if(console.log("Dispatching event",r.robm.WrlT),t.getController().persistTerminationInfoLocally(r.Ihpn),!0===r.robm._only_context){var u="SURVEY"===r.robm.WrlT?"survey":"campaign";t.logEvent("apx_context_evaluated",n(n({},r.robm._attr),{},{message_name:r.robm.WGsD,id:r.Ihpn}),!1,"apxor",u)}t.getController().dispatchEvent(r.robm.WrlT,{name:r.robm.WrlT,additional_info:{uuid:r.Ihpn,name:r.robm.WGsD}})}})),a(this,"validateForTerminationAttributes",(function(){var e=t.getController().getUserAttributes(),n=t.getController().getSessionAttributes();return r.xanb.validate(e,n)})),a(this,"iFHl",(function(){r.FGQd.iFHl()})),a(this,"getFrequencyCount",(function(){return r.FGQd.getFrequencyCount()})),a(this,"rWIX",(function(){return r.FGQd.oHOA()})),a(this,"ramd",(function(t){var e;e="AND"===t[0].htyt.oLDv;for(var n=0;n<t.length;n++){e="AND"===t[0].htyt.oLDv?e&&t[n].GtyK:e||t[n].GtyK}return e})),a(this,"cldn",(function(e){var n;null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===r.robm.WrlT?"survey":"campaign",apx_nudge_id:r.Ihpn,apx_nudge_name:r.robm.WGsD,apx_variant_code:r.robm._isExperiment||r.robm._only_context?null===(n=r.robm._attr)||void 0===n?void 0:n.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:e})}))})),Q=s((function t(){var e=this;i(this,t),a(this,"nXOm",{}),a(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{configs:[]};if(g(t)&&g(t.configs)){var n=t.configs;if(!Array.isArray(n))return;n.sort((function(t,e){var n,r;return(null!==(n=t.prio)&&void 0!==n?n:-1)-(null!==(r=e.prio)&&void 0!==r?r:-1)}));for(var r=0;r<n.length;r++){var i=n[r],o=i._id,s=new Y;s.parse(i)?e.nXOm[o]=s:console.warn("Failed to parse cfg",o)}}})),a(this,"validate",(function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(e.nXOm[t]){var i=e.nXOm[t];i.YHBT(n,r)}})),a(this,"getVariantCode",(function(t){return e.nXOm[t]?e.nXOm[t]._variant_code:""})),a(this,"validateForTermination",(function(t,n){e.nXOm[t]&&e.nXOm[t].BQPt(n)})),a(this,"validateForTerminationAttributes",(function(t){return!!e.nXOm[t]&&e.nXOm[t].validateForTerminationAttributes()})),a(this,"iFHl",(function(t){e.nXOm[t].iFHl()})),a(this,"getFrequencyCount",(function(t){return e.nXOm[t].getFrequencyCount()})),a(this,"resetFrequencyCounts",(function(){var t=e.nXOm;for(var n in t)t[n].rWIX()})),a(this,"jogV",(function(t){try{if(e.nXOm){var n=e.nXOm[t];if(n&&n.robm)return n.robm}}catch(t){console.log("Error in getting the campaign meta ".concat(t))}return{}}))})),R=window.ApxorLogger,Z=s((function e(){var n=this;i(this,e),a(this,"nKAZ",{}),a(this,"peLA",[]),a(this,"leTe",!1),a(this,"initialize",(function(){var e=t.getController();e.registerForEvent("APP_EVENT",(function(t){return n.ZkKI(t,"AE")})),e.registerForEvent("CLIENT_EVENT",(function(t){return n.ZkKI(t,"CE")}))})),a(this,"wQSY",(function(){for(var t in n.peLA)n.drFb(t.event,t.key,t.type);n.leTe=!0})),a(this,"WMvV",(function(t,e){var r;(console.log("eavw To Event"),"function"==typeof e)&&((r=n.nKAZ[t]?n.nKAZ[t]:[]).push(e),n.nKAZ[t]=r,R.debug("Listeners list: ",n.nKAZ))})),a(this,"unregisterFromEvent",(function(t,e){if(n.nKAZ[t]){for(var r=n.nKAZ[t],i=[],o=0;o<r.length;o++){var s=r[o];s!==e&&i.push(s)}n.nKAZ[t]=i}})),a(this,"ZkKI",(function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"AE";n.drFb(t,"any_event",e),"apxor"===(null==t?void 0:t.loggedBy)?(console.log("notifying apxor event listeners"),n.drFb(t,"apxor_event",e)):"customer"===(null==t?void 0:t.loggedBy)&&n.drFb(t,"customer_event",e),"campaign"===(null==t?void 0:t.apx_nudge_type)?n.drFb(t,"campaign_event",e):"survey"===(null==t?void 0:t.apx_nudge_type)&&n.drFb(t,"survey_event",e);var r=e+"___"+t.name;n.drFb(t,r,e)})),a(this,"drFb",(function(e,r,i){if(n.leTe){if(R.debug("Notifying listeners for event: "+e+", "+r,n.nKAZ),n.nKAZ[r])for(var o=n.nKAZ[r],s=t.getController().getSDKRunningTimeInSec(),a=0;a<o.length;a++){(0,o[a])(i,e.name,s,e.additional_info)}}else n.peLA.push({event:e,key:r,type:i})}))})),$=window.ApxorLogger,tt=function(){function e(){var n=this;return i(this,e),a(this,"HKpz",!1),a(this,"ziYU",null),a(this,"qIHt",A()),a(this,"rgbo",new Z),a(this,"gIhL",t.getSiteId()),a(this,"PZyJ",{}),a(this,"getQeState",(function(){try{var e=t.getController().getFromStorage("qe_state");return e?JSON.parse(f(n.gIhL,e)):(n.PZyJ={},n.setQeState())}catch(t){return n.PZyJ={},n.setQeState()}})),a(this,"setQeState",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";try{t.getController().persistToStorage("qe_state",n.PZyJ,!0)}catch(r){""===e?n.PZyJ={}:n.PZyJ[e]={SESSION:0,OVERALL:0,DATES:{}},t.getController().persistToStorage("qe_state",n.PZyJ,!0)}return n.PZyJ})),a(this,"initialize",(function(){n.HKpz||(n.HKpz=!0,n.ziYU=new Q,n.rgbo.initialize(),n.PZyJ=n.getQeState(),$.info("QE Initialized.."))})),a(this,"parse",(function(t){n.neJo()?(n.ziYU.parse(t),n.rgbo.wQSY()):$.warn("Must call init first. Unable to proceed")})),a(this,"validate",(function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;n.neJo()&&n.ziYU.validate(t,e,r)})),a(this,"getVariantCode",(function(t){return n.ziYU.getVariantCode(t)})),a(this,"validateForTermination",(function(t,e){n.neJo()&&n.ziYU.validateForTermination(t,e)})),a(this,"validateForTerminationAttributes",(function(t,e){return n.ziYU.validateForTerminationAttributes(t,e)})),a(this,"updateCount",(function(t){try{g(n.PZyJ[t])||n.createObjConfig(t),n.incrementFrequencies(t),n.setQeState(t),n.ziYU.iFHl(t)}catch(t){console.log("Could not update the count config:".concat(t))}})),a(this,"resetFrequencyCounts",(function(){n.ziYU.resetFrequencyCounts()})),a(this,"getFrequencyCount",(function(t){return n.ziYU.getFrequencyCount(t)})),a(this,"registerForEvent",(function(t,e){console.log("registered event",t),n.rgbo.WMvV(t,e)})),a(this,"unregisterFromEvent",(function(t,e){console.log("in unregister"),n.rgbo.unregisterFromEvent(t,e)})),a(this,"notifyEventListener",(function(t){n.rgbo.ZkKI(t)})),a(this,"fetch",(function(e,n,r,i){t.getController().fetchConfiguration(e,n,r,i)})),a(this,"neJo",(function(){return n.HKpz})),a(this,"getCampaignMetaFromQueryEngine",(function(t){return n.ziYU.jogV(t)})),a(this,"QHkn",(function(){return n.qIHt})),e.instance||(e.instance=this),e.instance}return s(e,[{key:"createObjConfig",value:function(t){try{this.PZyJ=this.getQeState(),g(this.PZyJ[t])||(this.PZyJ[t]={SESSION:0,OVERALL:0,DATES:{}},this.qIHt&&(this.PZyJ[t].DATES[this.qIHt]=0),this.setQeState(t))}catch(t){$.error("Can not create the frequency count object:"+t)}}},{key:"incrementFrequencies",value:function(t){this.PZyJ=this.getQeState();var e=this.PZyJ[t];e.SESSION=e.SESSION+1,e.OVERALL=e.OVERALL+1;var n=A();n===this.qIHt&&e.DATES&&e.DATES[n]||(this.qIHt=n,e.DATES={},e.DATES[this.qIHt]=0),e.DATES[this.qIHt]=e.DATES[this.qIHt]+1}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}();a(tt,"instance",void 0),window.ceVersion=160;try{void 0===exports&&null===exports||(exports.default=tt,module.exports=exports.default)}catch(t){}return tt}));
