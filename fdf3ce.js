!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("apxor")):"function"==typeof define&&define.amd?define(["apxor"],t):(e=e||self)["apxor-qe"]=t(e.Apxor)}(this,(function(e){"use strict";function t(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function i(e){for(var i=1;i<arguments.length;i++){var n=null!=arguments[i]?arguments[i]:{};i%2?t(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):t(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,u(n.key),n)}}function a(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e,t,i){return(t=u(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||d(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,t){if(e){if("string"==typeof e)return c(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?c(e,t):void 0}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function l(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=d(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,s=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return a=e.done,e},e:function(e){s=!0,r=e},f:function(){try{a||null==i.return||i.return()}finally{if(s)throw r}}}}function u(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e;var v=function(e){return void 0===e},g=function(e){return void 0!==e&&!function(e){return null===e}(e)},p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function f(e,t){return Array.from(t).map((function(t,i){return String.fromCharCode(t^function(e,t){return e.charCodeAt(Math.floor(t%e.length))}(e,i))})).join("")}var m=function(e,t){return f(e,t=function(e){var t,i,n,o,r,a,s=0,_=[];if(!e)return e;e+="";do{t=(a=p.indexOf(e.charAt(s++))<<18|p.indexOf(e.charAt(s++))<<12|(o=p.indexOf(e.charAt(s++)))<<6|(r=p.indexOf(e.charAt(s++))))>>16&255,i=a>>8&255,n=255&a,_.push(t),64!==o&&(_.push(i),64!==r&&_.push(n))}while(s<e.length);return _}(t))},h=function(e){switch(e){case"app_event":return"AE";case"client_event":return"CE";case"activity_time":case"activity_event":return"AE";case"apxor_event":return"AEV";case"customer_event":return"CEV";case"any_event":return"ANV";case"campaign_event":return"CNV";case"survey_event":return"SVE"}return"Unknown"},y=function(e){return e.toUpperCase()},E=function(e,t,i){switch(i){case"EQ":return e===t;case"GT":return e>t;case"GTE":return e>=t;case"LT":return e<t;case"LTE":return e<=t;case"NEQ":return e!==t;case"R":return S(t).test(e);default:return!1}},C=function(e,t){switch(e){case"second":return 1e3*t;case"minute":return 60*t*1e3;case"hour":return 60*t*60*1e3;case"day":return 24*t*60*60*1e3;default:return 1}},S=function(e){var t=e.replace(/.*\/([gimuy]*)$/,"$1");t===e&&(t="");var i=t?e.replace(new RegExp("^/(.*?)/"+t+"$"),"$1"):e;return new RegExp(i,t)},x=function(){var e=new Date;return e.getDate()+"/"+e.getMonth()+"/"+e.getFullYear()},F=window.ApxorLogger,b=a((function t(){var i=this;o(this,t),s(this,"_type","ALL"),s(this,"_userAttributes",[]),s(this,"_sessionAttributes",[]),s(this,"userAttributesValidated",!0),s(this,"sessionAttributeValidated",!0),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(i._type=e.audience.audience_type,i._userAttributes=e.audience.attributes.user,i._sessionAttributes=e.audience.attributes.session,!Array.isArray(i._userAttributes)||!Array.isArray(i._sessionAttributes))return F.error("No attributes"),!1}catch(e){return F.error(e),!1}return!0})),s(this,"validate",(function(t,n){var o=!0;"FTU"===i._type&&(o=e.getController().getSessionInfo().is_first_session);var r=i._compareAttributes(t,i._userAttributes),a=i._compareAttributes(n,i._sessionAttributes);return r||(i.userAttributesValidated=!1),a||(i.sessionAttributeValidated=!1),o&&r&&a})),s(this,"_compareAttributes",(function(e,t){var i=t.length,n=!0;try{for(var o,r=function(){var i=t[a];if(v(e[i.name])||!1===n)return{v:!1};var o=i.operator,r=i.type,s=i.value.map((function(e){if("s"===r)return e;if("l"===r)return parseInt(e);if("f"===r)return parseFloat(e);if("b"===r)switch(e){case"true":return!0;case"false":return!1}})),_=(Array.isArray(e[i.name])?e[i.name]:[e[i.name]]).some((function(e){return s.some((function(t){return"s"===r?e="".concat(e):"l"===r?e=parseInt(e):"f"===r?e=parseFloat(e):"b"===r&&(e=!!e),E(e,t,o)}))}));n=n&&_},a=0;a<i;a++)if(o=r())return o.v}catch(e){F.error(e),n=!1}return n}))})),T=window.ApxorLogger,V=a((function e(){var t=this;o(this,e),s(this,"_count",0),s(this,"_timeInterval",0),s(this,"_validity","SESSION"),s(this,"_shownCount",0),s(this,"_sessionCount",0),s(this,"_originalCount",0),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{t._count=e.frequency.count,-1===t._count&&(t._count=1e3),t._originalCount=t._count,t._timeInterval=e.frequency.time_interval,t._validity=e.frequency.validity,t._sessionCount=e.frequency.ses_lmt,t._dayCount=e.frequency.day_lmt;var i=ee.getInstance().getQeState();if(!g(i)||!g(i[e._id]))return!0;if("SESSION"===t._validity){if(t._count=parseInt(t._count)-parseInt(i[e._id].SESSION),t._count<=0)return console.warn("Max count limit reached for session:"+e._id),!1}else{if("OVERALL"!==t._validity)return T.info("Invalid config."),!1;if(t._count=parseInt(t._count)-parseInt(i[e._id].OVERALL),t._count<=0)return console.warn("Max count limit reached for overall:"+e._id),!1}}catch(e){return T.error(e),!1}return!0})),s(this,"decrementCampaignCount",(function(){t._count=t._count-1})),s(this,"getFrequencyCount",(function(){return t._count})),s(this,"resetCampaignCount",(function(){"SESSION"===t._validity&&(t._count=t._originalCount,T.info("Campaign Limit reset"))})),s(this,"isFrequencyWithInLimits",(function(e){try{if(t._count<=0)return!1;var i=ee.getInstance().getQeState();if(!g(i)||!g(i[e]))return!0;if(0!==t._sessionCount)if(parseInt(t._sessionCount)-parseInt(i[e].SESSION)<=0)return!1;if(0!==t._dayCount){var n,o=x();if(parseInt(t._dayCount)-parseInt((null===(n=i[e])||void 0===n?void 0:n.DATES[o])||0)<=0)return!1}}catch(e){T.error("Error validating the frequency:"+e)}return!0}))})),w=a((function e(){var t=this;o(this,e),s(this,"_name",""),s(this,"_type",""),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var i,n;t._name=e.meta.name,t._type=e.meta.type,t._only_context=e.meta.only_context,t._attr=(null===(i=e.meta)||void 0===i?void 0:i.attr)||{},t._isExperiment=null===(n=e.meta)||void 0===n?void 0:n.isExperiment}catch(e){return window.ApxorLogger.error(e),!1}return!0}))})),A=window.ApxorLogger,I=a((function e(){var t=this;o(this,e),s(this,"_startDate",-1),s(this,"_endDate",-1),s(this,"_startTime",-1),s(this,"_endTime",-1),s(this,"_timeLimits",!1),s(this,"_nudge_expired",!1),s(this,"_not_yet_active",!1),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(isNaN(Date.parse(e.validity.start_date))||isNaN(Date.parse(e.validity.end_date)))return A.error("Not valid dates"),!1;if(t._startDate=Date.parse(e.validity.start_date),t._endDate=Date.parse(e.validity.end_date),g(e.time_limits_in_day)&&(t._timeLimits=e.time_limits_in_day,t._timeLimits&&g(e.time_limits))){var i=(new Date).toISOString().split("T")[0];if(t._startTime=Date.parse(i+"T"+e.time_limits.start_time+".000Z"),t._endTime=Date.parse(i+"T"+e.time_limits.end_time+".000Z"),isNaN(t._startTime)||isNaN(t._endTime))return A.error("Not valid times"),!1}}catch(e){return A.error(e),!1}return!0})),s(this,"validate",(function(){var e=Date.now();return e>t._startDate&&e<t._endDate?!t._timeLimits||e>=t._startTime&&e<=t._endTime:(e<t._startDate?t._not_yet_active=!0:e>t._endDate&&(t._nudge_expired=!0),!1)}))})),N=a((function e(){var t=this;o(this,e),s(this,"_name",""),s(this,"_additionalInfo",{}),s(this,"_path",""),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{t._name=e.name,t._additionalInfo=e.additional_info,t._path=null==e?void 0:e.path}catch(e){return!1}return!0}))})),O=a((function e(){var t=this;o(this,e),s(this,"_lower",0),s(this,"_upper",0),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(t._lower=Number(e.lower),t._upper=Number(e.upper),isNaN(t._lower)||isNaN(t._upper))return!1}catch(e){return!1}return!0}))})),R=a((function e(){var t=this;o(this,e),s(this,"_occurredTime",0),s(this,"_eventType",""),s(this,"_navigation",""),s(this,"_details",new N),s(this,"_timeBounds",new O),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return t._eventType=e.event_type,t._navigation=e.activity,t._details.parse(e.details)&&t._timeBounds.parse(e.time_bounds)}catch(e){return!1}}))})),D=window.ApxorLogger,K=a((function e(){var t=this;o(this,e),s(this,"_occurredTime",0),s(this,"_sequence",-1),s(this,"_count",0),s(this,"_countOperator",""),s(this,"_navigation",""),s(this,"_eventType",""),s(this,"_timeBounds",new O),s(this,"_details",new N),s(this,"_precondition",new R),s(this,"_combineOperator","AND"),s(this,"_canCheckOldData",!1),s(this,"_type",void 0),s(this,"_route",""),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var i,n;return t._sequence=null==e?void 0:e.sequence,t._conditionType=null==e?void 0:e.condition_type,t._id=null==e?void 0:e._id,t._eventCategory=null!=e&&e.event_category?null==e?void 0:e.event_category:"specific_event",t._count=null==e||null===(i=e.count_config)||void 0===i?void 0:i.count,t._countOperator=null==e||null===(n=e.count_config)||void 0===n?void 0:n.operator,t._navigation=null==e?void 0:e.activity,t._eventType=null==e?void 0:e.event_type,t._combineOperator=e.combine_operator,t._timeEnabled=null==e?void 0:e.time_enabled,t._time=null==e?void 0:e.time,t._type=null==e?void 0:e.type,t._route=null==e?void 0:e.route,t._details.parse(null==e?void 0:e.details)&&t._precondition.parse(e.trigger)&&t._timeBounds.parse(e.time_bounds)}catch(e){return D.error(e),!1}}))})),k=window.ApxorLogger,q=a((function e(){var t=this;o(this,e),s(this,"_count",0),s(this,"_countOperator",""),s(this,"_eventType",""),s(this,"_timeBounds",new O),s(this,"_details",new N),s(this,"_combineOperator","AND"),s(this,"parse",(function(e){try{return t._count=e.count_config.count,t._countOperator=e.count_config.operator,t._eventType=e.event_type,t._combineOperator=e.combine_operator,t._details.parse(e.details)&&t._timeBounds.parse(e.time_bounds)}catch(e){return k.error(e),!1}}))})),L=window.ApxorLogger,P=function(){function t(){var i=this;o(this,t),s(this,"_satisfiedCount",0),s(this,"_uuid",""),s(this,"_condition",new K),s(this,"_goalevent",new q),s(this,"_triggered",!1),s(this,"_isSatisfied",!1),s(this,"_index",0),s(this,"_combineOperator","AND"),s(this,"_conbineOperatorForGoalEvent","OR"),s(this,"_oldEventCount",-1),s(this,"_kpi",[]),s(this,"_eventTimes",{}),s(this,"_receivedEventForKpi",!1),s(this,"_respectSequence",void 0),s(this,"_childConditionIndex",void 0),s(this,"no_KPI_TriggerDetails",[]),s(this,"initialize",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],_=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"",d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:-1,c=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];if(i._uuid=n,i._index=o,i._kpi=a,i._respectSequence=r,i.childConditionIndex=d,i.across_sessions=s||!1,"termination"===_&&""!==_){i._goalevent.parse(t);return i._conbineOperatorForGoalEvent=i._goalevent._combineOperator,i.registerForTermination(),!0}var l=i._condition.parse(t);if(l){if(i._combineOperator=i._condition._combineOperator,i._condition._canCheckOldData){var u=i._condition._details._name;"APX_PAGE_OPENED"===u&&(u=i._condition._details._additionalInfo.navigation_id,u=g(u)?u:i._condition._details._name),i._oldEventCount=e.getController().getEventCount(u);var v=i._condition._count,p=i._condition._countOperator;if(i._isSatisfied=i._compare(i._oldEventCount-1,v,p,!1),i._triggered=i._isSatisfied,i._isSatisfied&&"APX_PAGE_OPENED"===i._condition._details._name)return!0}return!0===c&&(r&&0!==o&&"unordered"!==r||i.register()),!0}return!1})),s(this,"register",(function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;-1!=t&&(i._childConditionIndex=t);var n=i._condition,o=null!=n&&n._eventCategory?null==n?void 0:n._eventCategory:"specific_event",r=n._precondition,a=ee.getInstance();if("app_start"===r._eventType)if(i._triggered=!0,null!=n&&n._timeEnabled){if("session"!=(null==n?void 0:n._time.unit)){var s=C(n._time.unit,n._time.value);if("didn't"==(null==n?void 0:n._type)){if(console.log("in didnt"),setTimeout((function(){i._receivedEventForKpi||(i._isSatisfied=!0,i._isSatisfied&&(i._satisfiedCount+=1,i._isSatisfied=i._compare(i._satisfiedCount,i._condition._count,i._condition._countOperator),i._isSatisfied&&(i._condition._occurredTime=Date.now(),a.validate(i._uuid,i._index,i._childConditionIndex)))),"specific_event"===o?a.unregisterFromEvent(h(i._condition._eventType)+"___"+i._condition._details._name,i._onReceiveEventForNoKpi):i.unregisterForGivenEventCategoryNOKPI(o),i._triggered=!1}),s),i.across_sessions){var _=C(n._time.unit,n._time.value),d=n._timeEnabled,c=n._id;i._persistSatisfiedConditions(n._type,n._details._name,Date.now(),n._details._additionalInfo,_,d,c)}"specific_event"===o?a.registerForEvent(h(i._condition._eventType)+"___"+i._condition._details._name,i._onReceiveEventForNoKpi):i.registerForGivenEventCategoryNOkpi(o)}else if("did"==(null==n?void 0:n._type)){if(console.log("did condition"),setTimeout((function(){"specific_event"===o?a.unregisterFromEvent(h(i._condition._eventType)+"___"+i._condition._details._name,i._onReceiveEventForKpiNew):i.unregisterFromGivenEventCategoryKPI(o)}),s),i.across_sessions){var l=C(n._time.unit,n._time.value),u=n._timeEnabled,v=n._id;i._persistSatisfiedConditions(n._type,n._details._name,Date.now(),n._details._additionalInfo,l,u,v)}"specific_event"===o?a.registerForEvent(h(i._condition._eventType)+"___"+i._condition._details._name,i._onReceiveEventForKpiNew):i.registerForGivenEventCategoryKPI(o)}}}else console.log("on receive event1"),"specific_event"===o?a.registerForEvent(h(n._eventType)+"___"+n._details._name,i._onReceiveEvent):i.registerForGivenEventCategory(o);else if(null!=n&&n._timeEnabled){if("session"!=(null==n?void 0:n._time.unit)){var g=C(n._time.unit,n._time.value);"didn't"==(null==n?void 0:n._type)?(setTimeout((function(){i._receivedEventForKpi||(i._isSatisfied=!0,i._isSatisfied&&(i._satisfiedCount+=1,i._isSatisfied=i._compare(i._satisfiedCount,i._condition._count,i._condition._countOperator),i._isSatisfied&&(i._condition._occurredTime=Date.now(),a.validate(i._uuid,i._index)))),"specific_event"===o&&a.unregisterFromEvent(h(i._condition._eventType)+"___"+i._condition._details._name,i),i._triggered=!1}),g),"specific_event"===o?a.registerForEvent(h(i._condition._eventType)+"___"+i._condition._details._name,i._onReceiveEventForNoKpi):i.registerForGivenEventCategoryNOkpi()):"did"==(null==n?void 0:n._type)&&(console.log("did condition"),setTimeout((function(){"specific_event"===o&&a.unregisterFromEvent(h(i._condition._eventType)+"___"+i._condition._details._name,i._onReceiveEventForKpiNew)}),g),"specific_event"===o&&a.registerForEvent(h(i._condition._eventType)+"___"+i._condition._details._name,i._onReceiveEventForKpiNew))}}else"specific_event"===o&&a.registerForEvent(h(n._eventType)+"___"+r._details._name,i._onReceiveEvent);null!==(e=window.ApxorRTM)&&void 0!==e&&e.badgesLists.includes(i._uuid)&&(console.log("on receive event3"),a.registerForEvent(h(n._eventType)+"___"+"apxor-badge-container-".concat("-".concat(i._uuid).replaceAll(" ","").replace(/[^\w\s]/gi,"")),i._onReceiveEvent))})),s(this,"registerForGivenEventCategory",(function(e){var t=new ee;"apxor_event"===e?t.registerForEvent("apxor_event",(function(e,t,n,o){i._onReceiveEvent(h(i._condition._eventType),i._condition._details._name,n,i._condition._details._additionalInfo)})):"customer_event"===e?t.registerForEvent("customer_event",(function(e,t,n,o){i._onReceiveEvent(h(i._condition._eventType),i._condition._details._name,n,i._condition._details._additionalInfo)})):"any_event"===e?t.registerForEvent("any_event",(function(e,t,n,o){i._onReceiveEvent(h(i._condition._eventType),i._condition._details._name,n,i._condition._details._additionalInfo)})):"campaign_event"===e?t.registerForEvent("campaign_event",(function(e,t,n,o){i._onReceiveEvent(h(i._condition._eventType),i._condition._details._name,n,i._condition._details._additionalInfo)})):"survey_event"===e&&t.registerForEvent("survey_event",(function(e,t,n,o){i._onReceiveEvent(h(i._condition._eventType),i._condition._details._name,n,i._condition._details._additionalInfo)}))})),s(this,"unregisterForGivenEventCategoryNOKPI",(function(e){console.log("in new register");var t=new ee,n=i._condition._eventCategory;"apxor_event"===n?t.unregisterFromEvent("apxor_event",i._onReceiveEventForNoKpi):"customer_event"===n?t.unregisterFromEvent("customer_event",i._onReceiveEventForNoKpi):"any_event"===n?t.unregisterFromEvent("any_event",i._onReceiveEventForNoKpi):"campaign_event"===n?t.unregisterFromEvent("campaign_event",i._onReceiveEventForNoKpi):"survey_event"===n&&t.unregisterFromEvent("survey_event",i._onReceiveEventForNoKpi)})),s(this,"registerForGivenEventCategoryNOkpi",(function(){console.log("in new register");var e=new ee,t=i._condition._eventCategory;"apxor_event"===t?e.registerForEvent("apxor_event",i._onReceiveEventForNoKpi):"customer_event"===t?e.registerForEvent("customer_event",i._onReceiveEventForNoKpi):"any_event"===t?e.registerForEvent("any_event",i._onReceiveEventForNoKpi):"campaign_event"===t?e.registerForEvent("campaign_event",i._onReceiveEventForNoKpi):"survey_event"===t&&e.registerForEvent("survey_event",i._onReceiveEventForNoKpi)})),s(this,"registerForGivenEventCategoryKPI",(function(){var e=new ee,t=i._condition._eventCategory;"apxor_event"===t?e.registerForEvent("apxor_event",i._onReceiveEventForKpiNew):"customer_event"===t?e.registerForEvent("customer_event",i._onReceiveEventForKpiNew):"any_event"===t?e.registerForEvent("any_event",i._onReceiveEventForKpiNew):"campaign_event"===t?e.registerForEvent("campaign_event",i._onReceiveEventForKpiNew):"survey_event"===t&&e.registerForEvent("survey_event",i._onReceiveEventForKpiNew)})),s(this,"unregisterFromGivenEventCategoryKPI",(function(){var e=new ee,t=i._condition._eventCategory;"apxor_event"===t?e.unregisterFromEvent("apxor_event",i._onReceiveEventForKpiNew):"customer_event"===t?e.unregisterFromEvent("customer_event",i._onReceiveEventForKpiNew):"any_event"===t?e.unregisterFromEvent("any_event",i._onReceiveEventForKpiNew):"campaign_event"===t?e.unregisterFromEvent("campaign_event",i._onReceiveEventForKpiNew):"survey_event"===t&&e.unregisterFromEvent("survey_event",i._onReceiveEventForKpiNew)})),s(this,"registerForTermination",(function(){var e=i._goalevent,t=ee.getInstance();i._triggered=!0,t.registerForEvent(h(e._eventType)+"___"+e._details._name,i._onReceiveEventForTermination)})),s(this,"_onReceiveEventForKpiForSameEvent",(function(e,t,n,o){var r,a=(Date.now()-i._eventTimes[t])/1e3;(null===(r=i._condition)||void 0===r||null===(r=r._details)||void 0===r||null===(r=r._additionalInfo)||void 0===r?void 0:r.time)/1e3>a&&i._displayCampaign(n)})),s(this,"_onReceiveEventForKpi",(function(e,t,n,o){var r,a;i._receivedEventForKpi=!0;var s=Date.now(),_=null===(r=i._condition)||void 0===r||null===(r=r._precondition)||void 0===r?void 0:r._details._name,d=(s-i._eventTimes[_])/1e3,c=null===(a=i._condition)||void 0===a||null===(a=a._details)||void 0===a||null===(a=a._additionalInfo)||void 0===a?void 0:a.time;(c/=1e3)>d&&i._displayCampaign(n)})),s(this,"_onReceiveEventForKpiNew",(function(){console.log("configitem kpi check2");var e=new ee;i._satisfiedCount+=1,i._isSatisfied=i._compare(i._satisfiedCount,i._condition._count,i._condition._countOperator),i._isSatisfied&&e.validate(i._uuid,i._index,i._childConditionIndex)})),s(this,"_onReceiveEventForNoKpi",(function(e,t,n,o){i._receivedEventForKpi=!0})),s(this,"_onReceiveEvent",(function(t,n,o,r){var a,s;console.log("in onreceive event"),console.log("across session value is ",i.across_sessions);var _=ee.getInstance();if(i._triggered){if(null!==(a=window.ApxorRTM)&&void 0!==a&&a.isBadgePresent&&null!==(s=window.ApxorRTM)&&void 0!==s&&s.badgesLists.includes(i._uuid)&&e.getController().isBadgeTriggerSatisfied(i._uuid))return i._isSatisfied=!0,i._condition._occurredTime=o,void _.validate(i._uuid,i._index);if(h(i._condition._eventType)===t&&i._validateTimeBounds(o-i._condition._precondition._occurredTime,i._condition._timeBounds)&&i._condition._details._name===n&&i._compareAdditionalInfo(i._condition._details._additionalInfo,r)&&(i._satisfiedCount+=1,i._isSatisfied=i._compare(i._satisfiedCount,i._condition._count,i._condition._countOperator),i._isSatisfied)){if(i._condition._occurredTime=o,i.across_sessions){var d=C(i._condition._time.unit,i._condition._time.value),c=i._condition._timeEnabled,l=i._condition._id,u=i._satisfiedCount;i._persistSatisfiedConditions(i._condition._type,n,o,r,d,c,l,u)}_.validate(i._uuid,i._index,i._childConditionIndex)}}else if(i._triggered=i._validatePrecondition(t,n,o,r),i._triggered){var v=i._condition,g=v._precondition;if(g._occurredTime=o,"activity_time"===(null==v?void 0:v._eventType)){var p,f,m,E,S=null==v||null===(p=v._details)||void 0===p||null===(p=p._additionalInfo)||void 0===p?void 0:p.time;(null==v||null===(f=v._route)||void 0===f?void 0:f.length)>0?setTimeout((function(){var t;(null===(t=e.getController())||void 0===t?void 0:t._appEventsNoKpi).length<=2&&v._route===location.pathname&&i._displayCampaign(o)}),S):(null==v||null===(m=v._details)||void 0===m||null===(m=m._additionalInfo)||void 0===m?void 0:m.nkpi.length)>0?(setTimeout((function(){i._receivedEventForKpi||(i._isSatisfied=!0,i._isSatisfied&&(i._satisfiedCount+=1,i._isSatisfied=i._compare(i._satisfiedCount,i._condition._count,i._condition._countOperator),i._isSatisfied&&(i._condition._occurredTime=o,_.validate(i._uuid,i._index)))),v._details._additionalInfo.nkpi.map((function(e){_.unregisterFromEvent(y(v._details._additionalInfo.et)+"___"+e,i),i._triggered=!1}))}),S),v._details._additionalInfo.nkpi.map((function(e){_.registerForEvent(y(v._details._additionalInfo.et)+"___"+e,i._onReceiveEventForNoKpi)}))):(null==v||null===(E=v._details)||void 0===E||null===(E=E._additionalInfo)||void 0===E?void 0:E.kpi.length)>0&&(setTimeout((function(){v._details._additionalInfo.kpi.map((function(e){_.unregisterFromEvent(y(v._details._additionalInfo.et)+"___"+e,i)}))}),S),v._details._additionalInfo.kpi.map((function(e){e===v._precondition._details._name?(_.unregisterFromEvent(h(g._eventType)+"___"+g._details._name,i),_.registerForEvent(y(v._details._additionalInfo.et)+"___"+e,i._onReceiveEventForKpiForSameEvent)):_.registerForEvent(y(v._details._additionalInfo.et)+"___"+e,i._onReceiveEventForKpi)})))}else _.unregisterFromEvent(h(g._eventType)+"___"+g._details._name,i),_.registerForEvent(h(v._eventType)+"___"+v._details._name,i);i._eventTimes[n]=Date.now()}})),s(this,"_onReceiveEventForTermination",(function(e,t,n,o){var r=ee.getInstance();h(i._goalevent._eventType)===e&&i._validateTimeBounds(n,i._goalevent._timeBounds)&&i._goalevent._details._name===t&&i._compareAdditionalInfo(i._goalevent._details._additionalInfo,o)&&(i._satisfiedCount+=1,i._isSatisfied=i._compare(i._satisfiedCount,i._goalevent._count,i._goalevent._countOperator),i._isSatisfied&&(i._goalevent._occurredTime=n,r.validateForTermination(i._uuid,i._index)))})),s(this,"_validatePrecondition",(function(e,t,n,o){var r=i._condition._precondition,a=h(r._eventType)===e&&r._details._name===t&&i._validateTimeBounds(n,r._timeBounds)&&i._compareAdditionalInfo(r._details._additionalInfo,o);return a="APX_PAGE_OPENED"===t?a&&location.pathname===r._details._path:a})),s(this,"_validateTimeBounds",(function(e,t){var i=Math.ceil(e);return i>t._lower&&i<t._upper})),s(this,"_compare",(function(e,t,n){var o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];switch(o&&i._condition._canCheckOldData&&(e+=i._oldEventCount),n){case"EQ":return e===t;case"GT":return e>t;case"GTE":return e>=t;case"LT":return e<t;case"LTE":return e<=t;default:return!1}})),s(this,"_compareAdditionalInfo",(function(e,t){var i=!0;try{var o,r=function(){if(!t[a]||!1===i)return{v:!1};if("object"===n(e[a])){var o,r,s,_=e[a].op,d=e[a].t;"s"===d?s=e[a].val:"l"!==d&&"f"!==d||(s=parseFloat(e[a].val));var c,l=(Array.isArray(t[a])?t[a]:[t[a]]).some((function(e){return E(e,s,_)}));if(!(null===(o=e[a])||void 0===o||!o.present)&&(null===(r=e[a])||void 0===r?void 0:r.present))c=!!t.hasOwn(t,a),i=i&&c;i=i&&l}else i=i&&E(t[a],e[a],"EQ")};for(var a in e)if(o=r())return o.v}catch(e){L.error(e),i=!1}return i})),s(this,"_persistSatisfiedConditions",(function(t,n,o,r,a,s,_,d){console.log("persisting satisfied conditions");var c,l=!1;i.no_KPI_TriggerDetails=e.getController().getFromStorage("apx_nokpi_triggerdetails"),null===i.no_KPI_TriggerDetails||void 0===i.no_KPI_TriggerDetails?i.no_KPI_TriggerDetails=[]:i.no_KPI_TriggerDetails=JSON.parse(i.no_KPI_TriggerDetails);var u,v=0;s&&(v=Date.now()+a);for(var g=0;g<i.no_KPI_TriggerDetails.length;g++)if(i.no_KPI_TriggerDetails[g].id===_){l=!0,c=i.no_KPI_TriggerDetails[g];break}l?c.satisfiedCount+=1:(u={id:_,type:t,time:o,name:n,additionalInfo:r,satisfiedCount:d,timeBased:s,finishTime:v},i.no_KPI_TriggerDetails.push(u)),e.getController().persistToStorage("apx_nokpi_triggerdetails",JSON.stringify(i.no_KPI_TriggerDetails))}))}return a(t,[{key:"_displayCampaign",value:function(e){console.log("in display campaign");var t=ee.getInstance();this._isSatisfied=!0,this._isSatisfied&&(this._satisfiedCount+=1,this._isSatisfied=this._compare(this._satisfiedCount,this._condition._count,this._condition._countOperator),this._isSatisfied&&(this._condition._occurredTime=e,t.validate(this._uuid,this._index)))}}]),t}(),G=window.ApxorLogger,j=a((function e(){var t=this;o(this,e),s(this,"_groupValidator",[]),s(this,"_childValidatorsLength",0),s(this,"_andThenChecker",!1),s(this,"initialize",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"unordered",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],a=arguments.length>5?arguments[5]:void 0,s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];t._uuid=i,t._index=n,t._kpi=r,t._respectSequence=o,t.across_sessions=s;var _=[];t._childValidatorsLength=e.length;try{if(null!=_)return o=null==e?void 0:e.sequence_type,_=t.getChildConditions(e,t._childValidatorsLength),"unordered"!==a&&0!==t._index||t.register(),t._groupValidator}catch(e){return G.error(e),!1}})),s(this,"getChildConditions",(function(e,i){for(var n=0;n<i;n++){var o=new P;try{o.initialize(e[n],t._uuid,t._index,t._respectSequence,t._noKpiArray,t.across_sessions,"",-1,!1)&&(t._groupValidator.push(o),t._groupValidator.sequence_type=t._respectSequence)}catch(e){G.error(e)}}return t._groupValidator})),s(this,"register",(function(){if("ordered"===t._respectSequence||"strictly_ordered"===t._respectSequence)t._groupValidator[0].register(0);else{var e,i=l(t._groupValidator);try{for(i.s();!(e=i.n()).done;){e.value.register()}}catch(e){i.e(e)}finally{i.f()}}}))})),U=window.ApxorLogger,B=a((function t(){var i=this;o(this,t),s(this,"_events",[]),s(this,"_ret_day",{}),s(this,"_session",{}),s(this,"_toggleRetDay",!1),s(this,"_toggleSession",!1),s(this,"retainedDaysValidated",!0),s(this,"retainedSessionValidated",!0),s(this,"eventDoneInLT",!1),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{i._events=e.overall_cfg.events,i._ret_day=e.overall_cfg.ret_day,i._session=e.overall_cfg.session,i._toggleRetDay=e.overall_cfg.toggleRetDay,i._toggleSession=e.overall_cfg.toggleSession}catch(e){return U.error(e),!1}return!0})),s(this,"validate",(function(){var t=parseInt(e.getController().getFromStorage("apx_retained_days")),n=parseInt(e.getController().getFromStorage("apx_retained_session"));if(i._toggleRetDay&&!isNaN(t)&&!(t>=i._ret_day.from&&t<=i._ret_day.to))return i.retainedDaysValidated=!1,!1;if(i._toggleSession&&!isNaN(n)&&!(n>=i._session.from&&n<=i._session.to))return i.retainedSessionValidated=!1,!1;try{for(var o=e.getController().getFromStorage("_apx_lt_count"),r=e.getSiteId(),a=JSON.parse((new TextDecoder).decode(function(e){for(var t=new ArrayBuffer(e.length),i=new Uint8Array(t),n=0;n<e.length;n++)i[n]=e.charCodeAt(n);return t}(m(r,o)))),s=0;s<i._events.length;s++){if(a[i._events[s].name.replace("'","").replace("’","")])return i.eventDoneInLT=!0,!1}}catch(e){U.error("Failed to validate the lt count:"+e)}return!0}))})),M=window.ApxorLogger,Q=a((function e(){var t=this;o(this,e),s(this,"_userAttributes",[]),s(this,"_sessionAttributes",[]),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(t._userAttributes=e.attributes.user,t._sessionAttributes=e.attributes.session,!Array.isArray(t._userAttributes)||!Array.isArray(t._sessionAttributes))return M.error("No attributes"),!1}catch(e){return M.error(e),!1}return!0})),s(this,"validate",(function(e,i){return t._compareAttributes(e,t._userAttributes)&&t._compareAttributes(i,t._sessionAttributes)})),s(this,"_compareAttributes",(function(e,t){var i=t.length,n=!0;try{for(var o,r=function(){var i=t[a];if(!e[i.name]||!1===n)return{v:!1};var o=i.operator,r=i.type,s=i.value.map((function(e){return"s"===r?e:"l"===r?parseInt(e):"f"===r?parseFloat(e):void 0})),_=(Array.isArray(e[i.name])?e[i.name]:[e[i.name]]).some((function(e){return s.some((function(t){return E(e,t,o)}))}));n=n&&_},a=0;a<i;a++)if(o=r())return o.v}catch(e){M.error(e),n=!1}return n}))})),z=a((function t(){var i=this;o(this,t),s(this,"_controller",e.getController()),s(this,"type",""),s(this,"_duration_seconds",0),s(this,"_days",1),s(this,"parse",(function(e){try{var t,n,o;if(i._type=null===(t=e.terminate_info.time_based)||void 0===t?void 0:t.type,i._duration_seconds=null===(n=e.terminate_info)||void 0===n?void 0:n.time_based.duration_seconds,i._days=null===(o=e.terminate_info.time_based)||void 0===o?void 0:o.days,i.compare(e._id))return i._controller.persistTerminationInfoLocally(e._id),!1}catch(e){return!1}return!0})),s(this,"compare",(function(e){var t,n=JSON.parse(i._controller.getFromStorage("apx_termination_ID"));if(!n[e]||null===(t=n[e])||void 0===t||!t.startDate)return!1;var o,r=new Date(n[e].startDate),a=new Date((o=new Date).getMonth()+"/"+o.getDate()+"/"+o.getFullYear()),s=parseInt((a-r)/864e5,10),_=function(){var e=new Date;return{hours:e.getHours(),mins:e.getMinutes()}}(),d=n[e]._startTime;return s===i._days&&_.hours>=d.hours||s>i._days||n[e].goalAcheived}))})),Y=a((function e(){var t=this;o(this,e),s(this,"enable_goal_events",!1),s(this,"attributes",{}),s(this,"_attributes",new Q),s(this,"_timebasedtermination",new z),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var i,n,o;if(t.enable_time_based=null==e||null===(i=e.terminate_info)||void 0===i?void 0:i.enable_time_based,t.enable_time_based&&!t._timebasedtermination.parse(e))return!1;if(t.enable_goal_events=null==e||null===(n=e.terminate_info)||void 0===n?void 0:n.enable_goal_events,t.enable_attributes=null==e||null===(o=e.terminate_info)||void 0===o?void 0:o.enable_attributes,t.enable_attributes&&!t._attributes.parse(e.terminate_info))return!1}catch(e){return window.ApxorLogger.error(e),!1}return!0})),s(this,"validate",(function(e,i){return t._attributes.validate(e,i)}))})),J=window.ApxorLogger,$=a((function t(){var n=this;o(this,t),s(this,"_conditionValidators",[]),s(this,"_terminationGoalEventValidators",[]),s(this,"_uuid",""),s(this,"_meta",new w),s(this,"_audience",new b),s(this,"_validity",new I),s(this,"_frequency",new V),s(this,"_overallconfig",new B),s(this,"_terminationconfig",new Y),s(this,"_respectSequence",!1),s(this,"_noKpiArray",[]),s(this,"_variant_code",""),s(this,"_andThenChecker",!1),s(this,"groupCombineOperator","OR"),s(this,"_receivedEventForKpi",!1),s(this,"_receivedEventForKpiAcrossSessions",!1),s(this,"_kpinextValidator",void 0),s(this,"timeForKPI",void 0),s(this,"kpiIndex",0),s(this,"_nextValidator",void 0),s(this,"_across_sessions",!1),s(this,"_conditionsFromConfig",void 0),s(this,"_advanceConditionsChecker",!1),s(this,"_matchedConditionObject",void 0),s(this,"_acrossSessionsConditionIndex",void 0),s(this,"_acrossSessionsmatchingObject",void 0),s(this,"_nextUpcomingValidator",void 0),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var t,i;if(!g(e._id))return J.error("No Id"),!1;if(!g(e.enabled)||!e.enabled)return J.error("Not enabled"),!1;if(!(n._meta.parse(e)&&n._validity.parse(e)&&n._frequency.parse(e)&&n._audience.parse(e)&&n._overallconfig.parse(e)&&n._terminationconfig.parse(e)))return!1;if(n._variant_code=n._meta._isExperiment||n._meta._only_context?null===(t=n._meta._attr)||void 0===t?void 0:t.apx_variant_code:"TG",n._across_sessions=!(null==e||!e.across_sessions)&&(null==e?void 0:e.across_sessions),!g(e.conditions)||!Array.isArray(e.conditions))return J.error("No valid conditions",e.conditions),!1;n._uuid=e._id,n._respectSequence=!!g(e.sequence_enabled)&&e.sequence_enabled,g(e.conditions_v2)&&(n._respectSequence=null==e?void 0:e.sequence_type),!0===n._respectSequence&&e.conditions.sort((function(e,t){return e.sequence<t.sequence})),g(e.conditions_v2)?(i=e.conditions_v2,n._advanceConditionsChecker=!0):i=e.conditions,n._conditionsFromConfig=i;var o=i.length;if(n.handleConditions(i,o),console.log(n._conditionValidators),n.getSequencedConditionsFromStorageandUpdate(),console.log(n._conditionValidators),n._terminationconfig.enable_goal_events)for(var r=e.terminate_info.goal_events.events,a=r.length,s=0;s<a;s++){var _=new P;_.initialize(r[s],n._uuid,s,!0,[],n._across_sessions,"termination")&&n._terminationGoalEventValidators.push(_)}return console.log("conditional validator parse"),n._conditionValidators.length>0}catch(e){return J.error(e),!1}})),s(this,"handleConditions",(function(e,t){for(var i=0;i<t;i++){n._noKpiArray=[];var o=e[i];if("group"===(null!=o&&o.condition_type?null==o?void 0:o.condition_type:"single")){var r=o.conditions_v2;n.groupCombineOperator=o.combine_operator;var a=null==o?void 0:o.sequence_type,s=new j,d=s.initialize(r,n._uuid,i,a,n._noKpiArray,n._respectSequence,n._across_sessions);n._conditionValidators.push(d),console.log(s)}else{if("didn't"===o.type){var c,l={trigger_key:o.trigger.details.name,no_kpi_array:null==o||null===(c=o.details)||void 0===c||null===(c=c.additional_info)||void 0===c?void 0:c.nkpi,condition_id:null==o?void 0:o._id,time_bounds:o.time_bounds.upper};n._noKpiArray=[].concat(_(n._noKpiArray),[l])}var u=new P;u.initialize(o,n._uuid,i,n._respectSequence,n._noKpiArray,n._across_sessions)&&(n._conditionValidators.push(u),console.log(n._conditionValidators))}}})),s(this,"getSequencedConditionsFromStorageandUpdate",(function(){if(n._across_sessions&&"ordered"===n._respectSequence){var t=!1;console.log("across_sesions_case");var i=e.getController().getFromStorage("apx_nokpi_triggerdetails");if(null!=(i=JSON.parse(i))&&null!=i)for(var o=function(e){var o,r,a;if(null!==(o=n._conditionValidators[e])&&void 0!==o&&null!==(o=o._condition)&&void 0!==o&&o._timeEnabled&&void 0===n._conditionValidators[e].length){if("didn't"===n._conditionValidators[e]._condition._type){var s=n._conditionValidators[e]._condition._id,_=n.findObjectById(s,i);if(_)if(Date.now()>_.finishTime)n._conditionValidators[e]._isSatisfied=!0,n._conditionValidators[e]._satisfiedCount=_.satisfiedCount,t=!0;else{var d=_.finishTime-Date.now(),c=n._conditionValidators[e]._condition._eventCategory?n._conditionValidators[e]._condition._eventCategory:"specific_event",l=new ee;"specific_event"===c?l.registerForEvent(h(n._conditionValidators[e]._condition._eventType)+"___"+n._conditionValidators[e]._condition._details._name,n._onReceiveEventForNoKpi):n.registerForGivenEventCategoryNOkpi(c),setTimeout((function(){e!==n._conditionValidators.length-1||n._receivedEventForKpi||(n._conditionValidators[e]._isSatisfied=!0,n._conditionValidators[e]._satisfiedCount=_.satisfiedCount,t=!0,"specific_event"===c?l.unregisterFromEvent(h(n._conditionValidators[e]._condition._eventType)+"___"+n._conditionValidators[e]._condition._details._name,n._onReceiveEventForNoKpi):n.unRegisterForGivenEventCategoryNOkpi(n._conditionValidators[e]),n._validateAllConditions())}),d)}}if("did"===n._conditionValidators[e]._condition._type){var u=n._conditionValidators[e]._condition._id,v=n.findObjectById(u,i);if(v)if(null==v.satisfiedCount){if(Date.now()<v.finishTime){console.log("time is left will add set time out again"),n._acrossSessionsmatchingObject=v,n._acrossSessionsConditionIndex=e;var g=v.finishTime-Date.now(),p=n._conditionValidators[e]._condition._eventCategory?n._conditionValidators[e]._condition._eventCategory:"specific_event",f=new ee;"specific_event"===p?f.registerForEvent(h(n._conditionValidators[e]._condition._eventType)+"___"+n._conditionValidators[e]._condition._details._name,n._onReceiveEventForKPIAcrossSessions):n.registerForGivenEventCategoryNOkpi(p),setTimeout((function(){"specific_event"===p?f.unregisterFromEvent(h(n._conditionValidators[e]._condition._eventType)+"___"+n._conditionValidators[e]._condition._details._name,n._onReceiveEventForKPIAcrossSessions):n.unRegisterForGivenEventCategoryNOkpi(n._conditionValidators[e])}),g)}}else n._conditionValidators[e]._satisfiedCount=v.satisfiedCount,n._conditionValidators[e]._isSatisfied=!0}}else t=n.checkConditionsatisfiedStatus(e,i);t&&(null===(r=n._conditionValidators[e])||void 0===r||null===(r=r._condition)||void 0===r||!r._timeEnabled||(null===(a=n._conditionValidators[e])||void 0===a?void 0:a.length)>1)?e===n._conditionValidators.length-1&&n._validateAllConditions():t||void 0===!n._conditionValidators[e].length&&n._conditionValidators[e].register()},r=0;r<n._conditionValidators.length;r++)o(r)}else if(n._across_sessions&&"unordered"===n._respectSequence){var a=e.getController().getFromStorage("apx_nokpi_triggerdetails");if(null!=(a=JSON.parse(a))&&null!=a)for(var s=0;s<n._conditionValidators.length;s++)n.checkConditionsatisfiedStatus(s,a)}})),s(this,"checkConditionsatisfiedStatus",(function(e,t){if(void 0===n._conditionValidators[e].length||1===n._conditionValidators[e].length){var i=n._conditionValidators[e]._condition._id,o=!1,r=n.findObjectById(i,t);if(r)n._matchedConditionObject=r,o=(new P)._compare(r.satisfiedCount,n._conditionValidators[e]._condition._count,n._conditionValidators[e]._condition._countOperator),r&&(o?n._conditionValidators[e]._isSatisfied=!0:n._conditionValidators[e]._satisfiedCount=r.satisfiedCount);else n._conditionValidators[e].register();return o}if(n._conditionValidators[e].length>=1){var a,s,_;if("ordered"===(s=null===(a=n._conditionValidators[e])||void 0===a?void 0:a.sequence_type)||"strictly_ordered"===s){for(var d=0;d<n._conditionValidators[e].length;d++){var c=n._conditionValidators[e][d],l=c._condition._id;_=!1;var u=n.findObjectById(l,t);if(u){if(_=(new P)._compare(u.satisfiedCount,c._condition._count,c._condition._countOperator),u)if(_){n._conditionValidators[e][d]._isSatisfied=!0;var p=d+1;console.log("nested and then");var f=n._conditionValidators[e][d+1];void 0===f&&g(n._conditionValidators[e+1])&&(n._conditionValidators[e+1].register(),_=!0),null!=f&&n._conditionValidators[e][d+1].register(p)}else n._conditionValidators[e][d]._satisfiedCount=u.satisfiedCount}else(g(n._conditionValidators[e][d-1])&&!0===n._conditionValidators[e][d]._isSatisfied||v(n._conditionValidators[e][d-1]))&&n._conditionValidators[e][d].register()}return _}for(var m,h=0;h<n._conditionValidators[e].length;h++){var y=n._conditionValidators[e][0]._condition._combineOperator;m="OR"!==y;var E=n._conditionValidators[e][h],C=E._condition._id;_=!1;var S=n.findObjectById(C,t);if(S)_=(new P)._compare(S.satisfiedCount,E._condition._count,E._condition._countOperator),S&&(_?n._conditionValidators[e][h]._isSatisfied=!0:n._conditionValidators[e][h]._satisfiedCount=S.satisfiedCount);else E.register();m="AND"===y?m&&_:m||_}return m}})),s(this,"findObjectById",(function(e,t){return t.find((function(t){return t.id===e}))})),s(this,"evaluate",(function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;console.log("coming to evaluate");var o=ee.getInstance();if(!(t<0)){var r=n._conditionValidators[t],a="unordered";if((null==r?void 0:r.length)>1&&(a=null==r?void 0:r.sequence_type),!0===n._respectSequence||"ordered"===n._respectSequence||"strictly_ordered"===n._respectSequence||"ordered"===a||"strictly_ordered"===a){console.log("respect sequence ordered"),n.kpiIndex=t+1;var s=n._conditionValidators[t];if((null==s?void 0:s.length)>0){if(g(s))if("unordered"===n._respectSequence&&"ordered"===a){var _=r[i-1];if(g(_))if(void 0===_.length||1==_.length){if(!_._isSatisfied)return}else if(_.length>1&&!n.validateChildConditions(_))return;var d,c=r[i+1];if(g(c)){if(c.register(i+1),"strictly_ordered"===n._respectSequence){n._currentEventname=s[i]._condition._details._name;var u=e.getController();u.registerForEvent("APP_EVENT",n.immediateEventChecker),u.registerForEvent("CLIENT_EVENT",n.immediateEventChecker)}}else if("strictly_ordered"===a)1!=n._andThenChecker&&n._validateAllConditions();else(null===(d=r[i])||void 0===d?void 0:d.length)>0?n.validateChildConditions(r)&&n._validateAllConditions():n._validateAllConditions()}else{var v,p=n._conditionValidators[t-1];if(g(p))if(void 0===p.length||1==p.length){if(!p._isSatisfied)return}else if(p.length>1&&!n.validateChildConditions(p))return;if(void 0===s.length||1===s.length?v=n._conditionValidators[t+1]:s.length>1&&("ordered"===a||"strictly_ordered"===a?v=i===s.length-1?n._conditionValidators[t+1]:n._conditionValidators[t][i+1]:n.validateChildConditions(s)&&(v=n._conditionValidators[t+1])),g(v)){if(void 0===v.length||1===v.length)v.register(i+1);else if(n.validateChildConditions(s))if(void 0===v.length)v.register();else if(v.length>1)if("unordered"===v.sequence_type)for(var f=0;f<v.length;f++)v[f].register(f);else"ordered"!==v.sequence_type&&"strictly_ordered"!==v.sequence_type||v[0].register(0);if("strictly_ordered"===n._respectSequence){n._currentEventname=s[i]._condition._details._name;var m=e.getController();m.registerForEvent("APP_EVENT",n.immediateEventChecker),m.registerForEvent("CLIENT_EVENT",n.immediateEventChecker)}}else"strictly_ordered"===n._respectSequence?1!=n._andThenChecker&&n._validateAllConditions():n.validateChildConditions(s)&&n._validateAllConditions()}}else if(g(s)&&s._isSatisfied){s._eventTimes[s._condition._details._name]=Date.now();var y=n._conditionValidators[t-1];if(g(y))if(void 0===y.length||1==y.length){if(!y._isSatisfied)return}else if(y.length>1&&!n.validateChildConditions(y))return;var E=n._conditionValidators[t+1];if(g(E)){var S,x;if(null!=E&&null!==(S=E._condition)&&void 0!==S&&S._timeEnabled){if("session"!=(null===(x=E._condition)||void 0===x?void 0:x._time.unit)){var F,b,T=C(E._condition._time.unit,E._condition._time.value);if("didn't"==(null===(F=E._condition)||void 0===F?void 0:F._type)){if(setTimeout((function(){if(!n._receivedEventForKpi&&(E._isSatisfied=!0,E._isSatisfied)){E._satisfiedCount+=1;var e=new P;if(E._isSatisfied=e._compare(E._satisfiedCount,E._condition._count,E._condition._countOperator),console.log("expected here"),E._isSatisfied){E._condition._occurredTime=Date.now();var i=t+1,r=n._conditionValidators[i+1];g(r)?(console.log("registering next condition"),r.register()):n._validateAllConditions()}}o.unregisterFromEvent(h(E._condition._eventType)+"___"+E._condition._details._name,n._onReceiveEventForNoKpi),E._triggered=!1}),T),console.log("expected here"),n._across_sessions){var V=C(E._condition._time.unit,E._condition._time.value),w=E._condition._timeEnabled,A=E._condition._id,I=new P;I._persistSatisfiedConditions(E._condition._type,E._condition._details._name,Date.now(),E._condition._details._additionalInfo,V,w,A)}console.log(E._condition._timeEnabled),"specific_event"===E._condition._eventCategory?o.registerForEvent(h(E._condition._eventType)+"___"+E._condition._details._name,n._onReceiveEventForNoKpi):n.registerForGivenEventCategoryNOkpi(E)}else if("did"==(null===(b=E._condition)||void 0===b?void 0:b._type)&&(n._nextValidator=E,g(n._conditionValidators[t+2])&&n._across_sessions&&(n._nextUpcomingValidator=n._conditionValidators[t+2]),setTimeout((function(){o.unregisterFromEvent(h(E._condition._eventType)+"___"+E._condition._details._name,n._onReceiveEventForKpi)}),T),n._kpinextValidator=s,n.timeForKPI=T,o.registerForEvent(h(E._condition._eventType)+"___"+E._condition._details._name,n._onReceiveEventForKpi),console.log("error check"),n._across_sessions)){var N=C(E._condition._time.unit,E._condition._time.value),O=E._condition._timeEnabled,R=E._condition._id,D=new P;D._persistSatisfiedConditions(E._condition._type,E._condition._details._name,Date.now(),E._condition._details._additionalInfo,N,O,R)}}}else if(E.length>0)if("ordered"===E.sequence_type||"strictly_ordered"===E.sequence_type)E[0].register(i+1);else{var K,k=l(E);try{for(k.s();!(K=k.n()).done;){var q=K.value;q.register()}}catch(e){k.e(e)}finally{k.f()}}else E.register();if(console.log("validating second condition"),"strictly_ordered"===n._respectSequence){n._currentEventname=s._condition._details._name;var L=e.getController();L.registerForEvent("APP_EVENT",n.immediateEventChecker),L.registerForEvent("CLIENT_EVENT",n.immediateEventChecker)}}else"strictly_ordered"===n._respectSequence?1!=n._andThenChecker&&n._validateAllConditions():n._validateAllConditions()}}else n._getSatisfiedConditionsFromStorageAndUpdate(),console.log(n._conditionValidators),n._validateAllConditions()}})),s(this,"immediateEventChecker",(function(e){e&&e.name!=n._currentEventname&&(n._andThenChecker=!0)})),s(this,"registerForGivenEventCategoryNOkpi",(function(e){var t=new ee,i=e._condition._eventCategory;"apxor_event"===i?t.registerForEvent("apxor_event",n._onReceiveEventForNoKpi):"customer_event"===i?t.registerForEvent("customer_event",n._onReceiveEventForNoKpi):"any_event"===i?t.registerForEvent("any_event",n._onReceiveEventForNoKpi):"campaign_event"===i?t.registerForEvent("campaign_event",n._onReceiveEventForNoKpi):"survey_event"===i&&t.registerForEvent("survey_event",n._onReceiveEventForNoKpi)})),s(this,"unRegisterForGivenEventCategoryNOkpi",(function(e){var t=new ee,i=e._condition._eventCategory;"apxor_event"===i?t.unregisterFromEvent("apxor_event",n._onReceiveEventForNoKpi):"customer_event"===i?t.unregisterFromEvent("customer_event",n._onReceiveEventForNoKpi):"any_event"===i?t.unregisterFromEvent("any_event",n._onReceiveEventForNoKpi):"campaign_event"===i?t.unregisterFromEvent("campaign_event",n._onReceiveEventForNoKpi):"survey_event"===i&&t.unregisterFromEvent("survey_event",n._onReceiveEventForNoKpi)})),s(this,"_onReceiveEventForNoKpi",(function(){console.log("received event of nkpi"),n._receivedEventForKpi=!0,n._across_sessions&&null!==localStorage.getItem("apx_nokpi_triggerdetails")&&localStorage.removeItem("apx_nokpi_triggerdetails")})),s(this,"_onReceiveEventForKpi",(function(){var t;console.log("configitem kpi check"),n._receivedEventForKpi=!0;var i=new P;if(n._nextValidator._satisfiedCount+=1,n._nextValidator._isSatisfied=i._compare(n._nextValidator._satisfiedCount,n._nextValidator._condition._count,n._nextValidator._condition._countOperator),n._across_sessions&&null!==(t=n._nextUpcomingValidator)&&void 0!==t&&t._condition._timeBased){var o,r,a,s=e.getController().getFromStorage("apx_nokpi_triggerdetails");s=null==s?[]:JSON.parse(s);for(var _=0;_<s.length;_++)if(n.no_KPI_TriggerDetails[_].id===n._nextUpcomingValidator._condition._id){o=!0,r=s[_];break}if(o)r.satisfiedCount+=1;else{var d=n._nextValidator._condition._id,c=n._nextValidator._condition._type,l=n._nextValidator._condition._details._name,u=n._nextValidator._condition._details._additionalInfo;a={id:d,type:c,time:Date.now(),name:l,additionalInfo:u,satisfiedCount:n._nextValidator._condition._timeEnabled,timeBased:n._nextValidator._condition._timeEnabled,finishTime:finishTime},n.no_KPI_TriggerDetails.push(a)}}if(n._nextValidator._isSatisfied){var v=n._conditionValidators[n.kpiIndex+1];g(v)?v.register():n._validateAllConditions()}})),s(this,"_onReceiveEventForKPIAcrossSessions",(function(){if(n._acrossSessionsConditionIndex===n._conditionValidators.length-1){n._receivedEventForKpiAcrossSessions=!0;n._conditionValidators[n._acrossSessionsConditionIndex]&&(n._conditionValidators[n._acrossSessionsConditionIndex]._satisfiedCount=n._acrossSessionsmatchingObject.satisfiedCount,n._conditionValidators[n._acrossSessionsConditionIndex]._isSatisfied=!0,n._validateAllConditions())}else{var t,i,o=e.getController().getFromStorage("apx_nokpi_triggerdetails");o=null==o?[]:JSON.parse(o);for(var r=0;r<o.length;r++)if(o[r].id===n._acrossSessionsConditionIndex){i=!0,t=o[r];break}if(i&&(t.satisfiedCount=1),e.getController().persistToStorage("apx_nokpi_triggerdetails",JSON.stringify(o)),n._conditionValidators[n._acrossSessionsConditionIndex]._satisfiedCount=n._acrossSessionsmatchingObject.satisfiedCount,n._conditionValidators[n._acrossSessionsConditionIndex]._isSatisfied=!0,n._conditionValidators[n._acrossSessionsConditionIndex+1]._condition._timeEnabled){var a=C(n._conditionValidators[n._acrossSessionsConditionIndex+1]._condition._time.unit,n._conditionValidators[n._acrossSessionsConditionIndex+1]._condition._time.value),s=n._conditionValidators[n._acrossSessionsConditionIndex+1]._condition._timeEnabled,_=n._conditionValidators[n._acrossSessionsConditionIndex+1]._condition._id,d=n._conditionValidators[n._acrossSessionsConditionIndex+1]._satisfiedCount,c=n._conditionValidators[n._acrossSessionsConditionIndex+1]._condition._details._name,l=n._conditionValidators[n._acrossSessionsConditionIndex+1]._details._additionalInfo;(new P)._persistSatisfiedConditions(n._condition._type,c,Date.now(),l,a,s,_,d)}}})),s(this,"_getSatisfiedConditionsFromStorageAndUpdate",(function(){if(n._across_sessions&&n._advanceConditionsChecker){var t,i,o,r="single",a=!1,s=e.getController().getFromStorage("apx_nokpi_triggerdetails");if(s=JSON.parse(s),console.log(s),s.length>0){var _,d=l(s);try{var c=function(){var e=_.value;console.log(e);var s=e.id,d=e.satisfiedCount;if(t=n._conditionValidators.find((function(e,t){if(1===(null==e?void 0:e.length)||void 0===(null==e?void 0:e.length)){if(e._condition._id===s)return r="single",i=t,!0}else if(e.length>0){var n=e.findIndex((function(e){return e._condition._id===s}));if(-1!==n)return console.log("Matching Condition Index:",t),i=t,console.log("Nested Condition Index:",n),o=n,r="group",!0}return!1})),"single"===r&&t){var c=new P;a=c._compare(d,t._condition._count,t._condition._countOperator);var l=n._conditionValidators.findIndex((function(e){var t;return(null==e||null===(t=e._condition)||void 0===t?void 0:t._id)===s}));void 0===l&&(l=i),a&&(n._conditionValidators[l]._isSatisfied=!0)}else if("group"===r&&t){var u=new P;(a=u._compare(d,t[o]._condition._count,t[o]._condition._countOperator))&&(n._conditionValidators[i][o]._isSatisfied=!0,console.log(n._conditionValidators))}};for(d.s();!(_=d.n()).done;)c()}catch(e){d.e(e)}finally{d.f()}}}})),s(this,"terminationEvaluate",(function(e){e<0||n._validateAllGoalEvents()})),s(this,"_validateAllConditions",(function(){console.log("in validate all conditions");var t=e.getController().getUserAttributes(),o=e.getController().getSessionAttributes();if(!n._validity.validate()||!n._audience.validate(t,o)||!n._overallconfig.validate()){var r="SURVEY"===n._meta._type?"survey":"campaign";return n._overallconfig.retainedDaysValidated||null==e||e.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===n._meta._type?"survey":"campaign",apx_nudge_id:n._uuid,apx_nudge_name:n._meta._name,apx_variant_code:n._meta._isExperiment||n._meta._only_context?n._meta._attr.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:"Retained day criteria not met"},!1,"apxor",r),n._overallconfig.retainedSessionValidated||null==e||e.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===n._meta._type?"survey":"campaign",apx_nudge_id:n._uuid,apx_nudge_name:n._meta._name,apx_variant_code:n._meta._isExperiment||n._meta._only_context?n._meta._attr.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:"User session criteria not met"},!1,"apxor",r),n._overallconfig.eventDoneInLT&&(null==e||e.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===n._meta._type?"survey":"campaign",apx_nudge_id:n._uuid,apx_nudge_name:n._meta._name,apx_variant_code:n._meta._isExperiment||n._meta._only_context?n._meta._attr.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:"Event done in life time"},!1,"apxor",r)),n._audience.userAttributesValidated||null==e||e.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===n._meta._type?"survey":"campaign",apx_nudge_id:n._uuid,apx_nudge_name:n._meta._name,apx_variant_code:n._meta._isExperiment||n._meta._only_context?n._meta._attr.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:"User property filter not met"},!1,"apxor",r),n._audience.sessionAttributeValidated||null==e||e.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===n._meta._type?"survey":"campaign",apx_nudge_id:n._uuid,apx_nudge_name:n._meta._name,apx_variant_code:n._meta._isExperiment||n._meta._only_context?n._meta._attr.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:"Session property filter not met"},!1,"apxor",r),n._validity._not_yet_active&&(null==e||e.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===n._meta._type?"survey":"campaign",apx_nudge_id:n._uuid,apx_nudge_name:n._meta._name,apx_variant_code:n._meta._isExperiment||n._meta._only_context?n._meta._attr.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:"nudge not yet active"},!1,"apxor",r)),void(n._validity._nudge_expired&&(null==e||e.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===n._meta._type?"survey":"campaign",apx_nudge_id:n._uuid,apx_nudge_name:n._meta._name,apx_variant_code:n._meta._isExperiment||n._meta._only_context?n._meta._attr.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:"nudge expired"},!1,"apxor",r)))}for(var a=n._conditionValidators.length,s=a<1,_="",d=0;d<a;d++){var c=void 0,u=n._conditionValidators[d];if(u.length>1){c="AND"===u[0]._condition._combineOperator;for(var v=0;v<u.length;v++){c="AND"===u[0]._condition._combineOperator?c&&u[v]._isSatisfied:c||u[v]._isSatisfied}}else c=u._isSatisfied;if(""===_.trim())s=c;else switch(_){case"AND":s=s&&c;break;case"OR":s=s||c}_=u.length>1?n.groupCombineOperator:u._combineOperator}if(s){var g,p;if(console.debug("onCondition satisfied"),!n._frequency.isFrequencyWithInLimits(n._uuid))return console.warn("Maximum limit reached",n._uuid),void(null==e||e.logEvent("apx_non_eligible_user",{apx_nudge_type:"campaign",apx_nudge_id:n._uuid,apx_nudge_name:n._meta._name,apx_variant_code:n._meta._isExperiment||n._meta._only_context?n._meta._attr.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:"Campaign limit reached"},!1,"apxor","campaign"));if(!(null!==(g=window.ApxorRTM)&&void 0!==g&&g.isBadgePresent&&null!==(p=window.ApxorRTM)&&void 0!==p&&p.badgesLists.includes(n._uuid)&&e.getController().isBadgeTriggerSatisfied(n._uuid))){var f="SURVEY"===n._meta._type?"survey":"campaign";null==e||e.logEvent("apx_trigger_satisfied",{apx_nudge_type:"SURVEY"===n._meta._type?"survey":"campaign",apx_nudge_id:n._uuid,apx_nudge_name:n._meta._name,apx_variant_code:n._meta._isExperiment||n._meta._only_context?n._meta._attr.apx_variant_code:"TG"},!1,"",f)}console.log("Dispatching event",n._meta._type),n._across_sessions&&localStorage.removeItem("apx_nokpi_triggerdetails");var m,h=l(n._conditionValidators);try{for(h.s();!(m=h.n()).done;){var y=m.value;if(1===(null==y?void 0:y.length)||void 0===(null==y?void 0:y.length))y._isSatisfied=!1,y._satisfiedCount=0;else{var E,C=l(y);try{for(C.s();!(E=C.n()).done;){var S=E.value;S._isSatisfied=!1,S._satisfiedCount=0}}catch(e){C.e(e)}finally{C.f()}}}}catch(e){h.e(e)}finally{h.f()}if(!0===n._meta._only_context){var x="SURVEY"===n._meta._type?"survey":"campaign";e.logEvent("apx_context_evaluated",i(i({},n._meta._attr),{},{message_name:n._meta._name,id:n._uuid}),!1,"",x)}e.getController().dispatchEvent(n._meta._type,{name:n._meta._type,additional_info:{uuid:n._uuid,name:n._meta._name}})}})),s(this,"_validateAllGoalEvents",(function(){for(var t=n._terminationGoalEventValidators.length,o=t<1,r="",a=0;a<t;a++){var s=n._terminationGoalEventValidators[a],_=s._isSatisfied;if(""===r.trim())o=_;else switch(r){case"AND":o=o&&_;break;case"OR":o=o||_}r=s._conbineOperatorForGoalEvent}if(o){if(console.log("Dispatching event",n._meta._type),e.getController().persistTerminationInfoLocally(n._uuid),!0===n._meta._only_context){var d="SURVEY"===n._meta._type?"survey":"campaign";e.logEvent("apx_context_evaluated",i(i({},n._meta._attr),{},{message_name:n._meta._name,id:n._uuid}),!1,"apxor",d)}e.getController().dispatchEvent(n._meta._type,{name:n._meta._type,additional_info:{uuid:n._uuid,name:n._meta._name}})}})),s(this,"validateForTerminationAttributes",(function(){var t=e.getController().getUserAttributes(),i=e.getController().getSessionAttributes();return n._terminationconfig.validate(t,i)})),s(this,"decrementCampaignCount",(function(){n._frequency.decrementCampaignCount()})),s(this,"getFrequencyCount",(function(){return n._frequency.getFrequencyCount()})),s(this,"resetFrequencyCount",(function(){return n._frequency.resetCampaignCount()})),s(this,"validateChildConditions",(function(e){var t;t="AND"===e[0]._condition._combineOperator;for(var i=0;i<e.length;i++){t="AND"===e[0]._condition._combineOperator?t&&e[i]._isSatisfied:t||e[i]._isSatisfied}return t}))})),X=a((function e(){var t=this;o(this,e),s(this,"_configs",{}),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{configs:[]};if(g(e)&&g(e.configs)){var i=e.configs;if(!Array.isArray(i))return;i.sort((function(e,t){var i,n;return(null!==(i=e.prio)&&void 0!==i?i:-1)-(null!==(n=t.prio)&&void 0!==n?n:-1)}));for(var n=0;n<i.length;n++){var o=i[n],r=o._id,a=new $;a.parse(o)?t._configs[r]=a:console.warn("Failed to parse cfg",r)}}})),s(this,"validate",(function(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(t._configs[e]){var o=t._configs[e];o.evaluate(i,n)}})),s(this,"getVariantCode",(function(e){return t._configs[e]?t._configs[e]._variant_code:""})),s(this,"validateForTermination",(function(e,i){t._configs[e]&&t._configs[e].terminationEvaluate(i)})),s(this,"validateForTerminationAttributes",(function(e){return!!t._configs[e]&&t._configs[e].validateForTerminationAttributes()})),s(this,"decrementCampaignCount",(function(e){t._configs[e].decrementCampaignCount()})),s(this,"getFrequencyCount",(function(e){return t._configs[e].getFrequencyCount()})),s(this,"resetFrequencyCounts",(function(){var e=t._configs;for(var i in e)e[i].resetFrequencyCount()})),s(this,"getCampaignMeta",(function(e){try{if(t._configs){var i=t._configs[e];if(i&&i._meta)return i._meta}}catch(e){console.log("Error in getting the campaign meta ".concat(e))}return{}}))})),W=window.ApxorLogger,Z=a((function t(){var i=this;o(this,t),s(this,"_listeners",{}),s(this,"_buffer",[]),s(this,"_isEnabled",!1),s(this,"initialize",(function(){var t=e.getController();t.registerForEvent("APP_EVENT",(function(e){return i._onEvent(e,"AE")})),t.registerForEvent("CLIENT_EVENT",(function(e){return i._onEvent(e,"CE")}))})),s(this,"enable",(function(){for(var e in i._buffer)i._notifyListeners(e.event,e.key,e.type);i._isEnabled=!0})),s(this,"registerToEvent",(function(e,t){var n;(console.log("register To Event"),"function"==typeof t)&&((n=i._listeners[e]?i._listeners[e]:[]).push(t),i._listeners[e]=n,W.debug("Listeners list: ",i._listeners))})),s(this,"unregisterFromEvent",(function(e,t){if(i._listeners[e]){for(var n=i._listeners[e],o=[],r=0;r<n.length;r++){var a=n[r];a!==t&&o.push(a)}i._listeners[e]=o}})),s(this,"_onEvent",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"AE";i._notifyListeners(e,"any_event",t),"apxor"===(null==e?void 0:e.loggedBy)?(console.log("notifying apxor event listeners"),i._notifyListeners(e,"apxor_event",t)):"customer"===(null==e?void 0:e.loggedBy)&&i._notifyListeners(e,"customer_event",t),"campaign"===(null==e?void 0:e.apx_nudge_type)?i._notifyListeners(e,"campaign_event",t):"survey"===(null==e?void 0:e.apx_nudge_type)&&i._notifyListeners(e,"survey_event",t);var n=t+"___"+e.name;i._notifyListeners(e,n,t)})),s(this,"_notifyListeners",(function(t,n,o){if(i._isEnabled){if(W.debug("Notifying listeners for event: "+t+", "+n,i._listeners),i._listeners[n])for(var r=i._listeners[n],a=e.getController().getSDKRunningTimeInSec(),s=0;s<r.length;s++){(0,r[s])(o,t.name,a,t.additional_info)}}else i._buffer.push({event:t,key:n,type:o})}))})),H=window.ApxorLogger,ee=function(){function t(){var i=this;return o(this,t),s(this,"_isInitialized",!1),s(this,"_configLookup",null),s(this,"_date",x()),s(this,"_eventsListener",new Z),s(this,"_siteId",e.getSiteId()),s(this,"_qeState",{}),s(this,"getQeState",(function(){try{var t=e.getController().getFromStorage("qe_state");return t?JSON.parse(m(i._siteId,t)):(i._qeState={},i.setQeState())}catch(e){return i._qeState={},i.setQeState()}})),s(this,"setQeState",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";try{e.getController().persistToStorage("qe_state",i._qeState,!0)}catch(n){""===t?i._qeState={}:i._qeState[t]={SESSION:0,OVERALL:0,DATES:{}},e.getController().persistToStorage("qe_state",i._qeState,!0)}return i._qeState})),s(this,"initialize",(function(){i._isInitialized||(i._isInitialized=!0,i._configLookup=new X,i._eventsListener.initialize(),i._qeState=i.getQeState(),H.info("QE Initialized.."))})),s(this,"parse",(function(e){i._check()?(i._configLookup.parse(e),i._eventsListener.enable()):H.warn("Must call init first. Unable to proceed")})),s(this,"validate",(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;i._check()&&i._configLookup.validate(e,t,n)})),s(this,"getVariantCode",(function(e){return i._configLookup.getVariantCode(e)})),s(this,"validateForTermination",(function(e,t){i._check()&&i._configLookup.validateForTermination(e,t)})),s(this,"validateForTerminationAttributes",(function(e,t){return i._configLookup.validateForTerminationAttributes(e,t)})),s(this,"updateCount",(function(e){try{g(i._qeState[e])||i.createObjConfig(e),i.incrementFrequencies(e),i.setQeState(e),i._configLookup.decrementCampaignCount(e)}catch(e){console.log("Could not update the count config:".concat(e))}})),s(this,"resetFrequencyCounts",(function(){i._configLookup.resetFrequencyCounts()})),s(this,"getFrequencyCount",(function(e){return i._configLookup.getFrequencyCount(e)})),s(this,"registerForEvent",(function(e,t){console.log("registered event",e),i._eventsListener.registerToEvent(e,t)})),s(this,"unregisterFromEvent",(function(e,t){console.log("in unregister"),i._eventsListener.unregisterFromEvent(e,t)})),s(this,"notifyEventListener",(function(e){i._eventsListener._onEvent(e)})),s(this,"fetch",(function(t,i,n,o){e.getController().fetchConfiguration(t,i,n,o)})),s(this,"_check",(function(){return i._isInitialized})),s(this,"getCampaignMetaFromQueryEngine",(function(e){return i._configLookup.getCampaignMeta(e)})),s(this,"getCEStartDate",(function(){return i._date})),t.instance||(t.instance=this),t.instance}return a(t,[{key:"createObjConfig",value:function(e){try{this._qeState=this.getQeState(),g(this._qeState[e])||(this._qeState[e]={SESSION:0,OVERALL:0,DATES:{}},this._date&&(this._qeState[e].DATES[this._date]=0),this.setQeState(e))}catch(e){H.error("Can not create the frequency count object:"+e)}}},{key:"incrementFrequencies",value:function(e){this._qeState=this.getQeState();var t=this._qeState[e];t.SESSION=t.SESSION+1,t.OVERALL=t.OVERALL+1;var i=x();i===this._date&&t.DATES&&t.DATES[i]||(this._date=i,t.DATES={},t.DATES[this._date]=0),t.DATES[this._date]=t.DATES[this._date]+1}}],[{key:"getInstance",value:function(){return t.instance||(t.instance=new t),t.instance}}]),t}();s(ee,"instance",void 0),window.ceVersion=151;try{void 0===exports&&null===exports||(exports.default=ee,module.exports=exports.default)}catch(e){}return ee}));
