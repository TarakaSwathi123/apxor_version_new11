!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Apxor=t()}(this,(function(){"use strict";function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function t(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?e(Object(i),!0).forEach((function(e){s(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,c(i.key),i)}}function o(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e,t,n){return(t=c(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o,s,a=[],u=!0,l=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(i=o.call(n)).done)&&(a.push(i.value),a.length!==t);u=!0);}catch(e){l=!0,r=e}finally{try{if(!u&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(l)throw r}}return a}}(e,t)||l(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e){return function(e){if(Array.isArray(e))return d(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||l(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){if(e){if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function c(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}var _={enable:!0,api_root:"https://server.apxor.com/v2/api",auto_track_events:["click","submit"],cookie_expiration:730,name:"",domain:"",cookie_prefix:"_apx_",idle_time_out:1800,ed_t_time:-1,sct_time:108e5,events:{stop:[],action:[]}},g={debug:!1,honorDNT:!1,idle_time_out:1800,client_id:null,session_id:null,plugins:[],version:"ALL",events_upload_time:-1,retry_time:-1,bulk_upload:!0},h=["inline_shown","inapp_shown","apx_onboarding_screen_shown"],f=["apx_survey_dialog_launched","apx_survey_launched"],p=["inline_dismissed","walk_through_cancelled","inapp_dismissed","apx_onboarding_completed","apx_onboarding_screen_dismissed"],v=["apx_survey_completed"],m=["apx_app_opened","install","apx_context_evaluated","InlineTargetViewClicked","InAppBackButtonPressed","InAppRedirectionFailed","inapp_show_failed","InAppXIconClicked","apx_video_inapp_button_clicked","apx_video_inapp_close_button_clicked","apx_video_inapp_failed","apx_video_inapp_maximised","apx_video_inapp_minimised","apx_video_inapp_volume_button_clicked"],b=["apx_survey_dialog_yes_clicked","apx_survey_dialog_close_icon_clicked","apx_survey_close_button_clicked","apx_survey_back_button_pressed","apx_survey_dialog_no_clicked","apx_survey_question_asked","apx_survey_question_answered","apx_survey_skip_button_clicked","apx_survey_back_button_clicked","apx_survey_"],S="Opera Mini",I="Opera",k="BlackBerry",C="Internet Explorer Mobile",y="Microsoft Edge",w="Facebook Mobile",x="Chrome",E="Chrome iOS",D="UC Browser",A="Firefox iOS",T="Mobile Safari",O="Safari",N="Android Mobile",M="Konqueror",P="Firefox",R="Internet Explorer",F="Mozilla",U="Brave",L=["apx_debug_enable","apx_log_level","_apx_config","apx_id","apx_ver","apx_ver","apx_in","_apx_od","_apx_use","_apx_cd","qe_state","apx_retained_session","apx_retained_days","_apx_ua","_apx_sc","_apx_ledt","_apx_lef","_apx_ch","_apx_lct","_apx_uih","apx_lbgt","_apx_lEt","_apx_sId","_apx_lt_count","apx_sst","apx_termination_ID","_apx_ew","_apx_scnm","0__lcfht","1__lcfht","_apx_td"],q=o((function e(){i(this,e)}));s(q,"isCookieAvailable",(function(){try{var e=(new Date).getTime()+864e5;document.cookie="cookie_set=cookie_value; expires="+e;for(var t=document.cookie.split(";"),n=0;n<t.length;n++){if(-1!==t[n].indexOf("cookie_set"))return document.cookie="cookie_set=cookie_value; expires=Thu, 01 Jan 1970 00:00:01 GMT;",!0}return!1}catch(e){return!1}})),s(q,"get",(function(e){if(window.document)for(var t=e+"=",n=window.document.cookie.split(";"),i=0;i<n.length;i++){for(var r=n[i];" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(t))return decodeURIComponent(r.substring(t.length,r.length))}return null}));var B,z,j,J,H=function(e){return void 0===e},V=function(e){return null===e},K=function(e){return void 0!==e&&!V(e)},W=function(e){return!K(e)},G=function(e){return"function"==typeof e},Y=function(e){return"string"==typeof e},X=function(e){return"boolean"==typeof e},$=function(e){return K(e)&&!V(e)&&!isNaN(e)},Z=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return null};G(t)&&(e.removeEventListener("pagehide",t),e.removeEventListener("beforeunload",t),e.removeEventListener("onunload",t))},Q=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];G(e.addEventListener)?e.addEventListener(t,n,i):G(e.attachEvent)?e.attachEvent(t,n):e["on"+t]=n},ee=function(e,t,n){G(e.removeEventListener)?e.removeEventListener(t,n):G(e.detachEvent)?e.detachEvent(t,n):e["on"+t]=n},te=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=function(e){return e<10?"0"+e:e},i=e.getFullYear()+"-"+n(e.getMonth()+1)+"-"+n(e.getDate())+"T"+n(e.getHours())+":"+n(e.getMinutes())+":"+n(e.getSeconds());return t?i+e.toTimeString().split(" ")[1].replace(/GMT([+|-])(\d{2})(\d{2})/,"$1$2:$3"):i},ne=function(){return Date.now()},ie=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e)},re=function(){var e=window.navigator,t=(void 0===e?{}:e).userAgent,n=void 0===t?"":t;switch(!0){case/Windows Phone/i.test(n)||/WPDesktop/.test(n):return"Windows Phone";case/iPad/.test(n):return"iPad";case/iPod/.test(n):return"iPod Touch";case/iPhone/.test(n):return"iPhone";case/(BlackBerry|PlayBook|BB10)/i.test(n):return"BlackBerry";case/Android/.test(n):return"Android";default:return"Desktop"}},oe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.navigator,i=void 0===n?{}:n,r=i.userAgent,o=void 0===r?"":r,a=i.vendor,u=void 0===a?"":a,l=S,d=I,c=k,_=C,g=y,h=w,f=x,p=E,v=D,m=A,b=T,L=O,q=N,B=M,z=P,j=R,J=F,H=U,V=function(){var e;if(null!==(e=navigator)&&void 0!==e&&e.brave)return H;switch(!0){case o.includes(" OPR/"):return o.includes("Mini")?l:d;case/(BlackBerry|PlayBook|BB10)/i.test(o):return c;case o.includes("IEMobile")||o.includes("WPDesktop"):return _;case o.includes("FBIOS"):return h;case o.includes("Chrome"):return f;case o.includes("CriOS"):return p;case o.includes("Edge"):return g;case o.includes("UCWEB")||o.includes("UCBrowser"):return v;case o.includes("FxiOS"):return m;case u.includes("Apple"):return o.includes("Mobile")?b:L;case o.includes("Android"):return q;case o.includes("Konqueror"):return B;case o.includes("Firefox"):return z;case o.includes("MSIE")||o.includes("Trident/"):return j;case o.includes("Gecko"):return J;default:return""}},K=V(),W=function(){var e,t=(e={},s(e,_,/rv:(\d+(\.\d+)?)/),s(e,g,/Edge\/(\d+(\.\d+)?)/),s(e,f,/Chrome\/(\d+(\.\d+)?)/),s(e,p,/CriOS\/(\d+(\.\d+)?)/),s(e,v,/(UCBrowser|UCWEB)\/(\d+(\.\d+)?)/),s(e,L,/Version\/(\d+(\.\d+)?)/),s(e,b,/Version\/(\d+(\.\d+)?)/),s(e,d,/(Opera|OPR)\/(\d+(\.\d+)?)/),s(e,z,/Firefox\/(\d+(\.\d+)?)/),s(e,m,/FxiOS\/(\d+(\.\d+)?)/),s(e,B,/Konqueror:(\d+(\.\d+)?)/),s(e,c,/BlackBerry (\d+(\.\d+)?)/),s(e,q,/android\s(\d+(\.\d+)?)/),s(e,j,/(rv:|MSIE )(\d+(\.\d+)?)/),s(e,J,/rv:(\d+(\.\d+)?)/),e)[K];if(void 0===t)return null;var n=o.match(t);return n?parseFloat(n[n.length-2]):null},G=function(){switch(!0){case/Windows/i.test(o):return/Phone/.test(o)||/WPDesktop/.test(o)?"Windows Phone":"Windows";case/(iPhone|iPad|iPod)/.test(o):return"iOS";case/Android/.test(o):return"Android";case/(BlackBerry|PlayBook|BB10)/i.test(o):return"BlackBerry";case/Mac/i.test(o):return"Mac OS X";case/Linux/.test(o):return"Linux";case/CrOS/.test(o):return"Chrome OS";default:return""}},Y=function(){var t=e.screen,n=void 0===t?{width:0,height:0}:t,i=n.height,r=n.width,o=e.devicePixelRatio,s=void 0===o?1:o,a=function(e){var t=Math.round(e)*s,n=t%10;return t+(n>0?10:0)-n};return{dimensions:{width:r,height:i},dimensions_in_pixels:{width:a(r),height:a(i)},dpi:s.toString()}},X=W(),$=re(),Z=G();return t(t({},Y()),{},{device:$,browser_version:X,browser:K,os:Z})},se=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.navigator,r=void 0===i?{}:i,o=r.language,a=n.browser_version,u=n.browser,l=q.isCookieAvailable();return s(e={},"apx_browser",u),s(e,"apx_browser_version",u+"_"+a),s(e,"apx_language",o),s(e,"apx_cookies_supported",l),e},ae=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.navigator,n=void 0===t?{}:t,i=n.connection,r=void 0===i?{}:i,o=r.effectiveType,s=r.saveData,a=n.platform,u=n.webdriver,l=e.document.referrer,d={};o&&(d.apx_network=o),s&&(d.apx_data_save_mode=s),a&&(d.apx_platform=a),K(u)&&u&&(d.apx_automation=u),K(l)&&l.length>0?d.apx_referrer=l:d.apx_referrer="direct";var c=re();return d.apx_device_type=c,d},ue=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e.navigator){var t=e.navigator.doNotTrack;return!("1"===t||"yes"===t)}return!0},le=function(e){var t=e.document.querySelector("title");return K(t)&&K(t.innerText)?t.innerText:"Unknown"},de=function(e){return $(e)?ce(e/1e3):e},ce=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(!$(e)||!$(t))return e;if(t%1!=0)return e;var n=Math.pow(10,t);return Math.round(e*n)/n},_e=function(e){return e instanceof Object},ge=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(_e(e)){var i={};return Object.keys(t({},e)).forEach((function(t){var r=e[t],o=t;Y(t)||(o=JSON.stringify(t)),X(r)||$(r)?pe(i,o,r):Y(r)?i[o]=ve(r):Array.isArray(r)?he(i,o,r,n):_e(r)&&fe(i,t,r,n-1)})),i}return{}},he=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(i<=0)pe(e,t,JSON.stringify(n));else if(Array.isArray(n)){var r=n;if(r.length>0){var o="";X(r[0])?o="b":Y(r[0])?o="s":$(r[0])?o="n":Array.isArray(r[0])?o="a":_e(r[0])&&(o="o");var s=r.length;if(""===o)return void pe(e,t,JSON.stringify(n));for(var a=1;a<s;a++)if("s"===o){if(!Y(r[a]))return void pe(e,t,JSON.stringify(n))}else if("b"===o){if(!X(r[a]))return void pe(e,t,JSON.stringify(n))}else if("n"===o){if(!$(r[a]))return void pe(e,t,JSON.stringify(n))}else if("a"===o){if(!Array.isArray(r[a]))return void pe(e,t,JSON.stringify(n))}else if("o"===o&&!_e(r[a]))return void pe(e,t,JSON.stringify(n));if("o"===o)if(i-1<=0){for(var u=[],l=0;l<s;l++)u.push(JSON.stringify(r[l]));pe(e,t,u)}else for(var d=0;d<s;d++)fe(e,t,r[d],i-1);else if("a"===o)for(var c=0;c<s;c++)pe(e,t,JSON.stringify(r[c]));else for(var _=0;_<s;_++)pe(e,t,r[_])}else pe(e,t,[])}},fe=function e(n,i,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;o<=0?pe(n,i,JSON.stringify(r)):Object.keys(t({},r)).forEach((function(t){var s=i+"_"+t,a=r[t];K(a)&&(Array.isArray(a)?he(n,s,a,o-1):_e(a)?e(n,s,a,o-1):pe(n,s,a))}))},pe=function(e,t,n){if(K(t)&&K(n))if(e[t]){var i=e[t],r=i;Array.isArray(i)||(($(i)&&!$(n)||X(i)&&!X(n)||Y(i)&&!Y(n)||_e(i)&&!_e(n))&&(Y(i)||(i=JSON.stringify(i)),Y(n)||(n=JSON.stringify(n))),(r=[]).push(i)),r.push(n),e[t]=r}else e[t]=n},ve=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:120;return Y(e)?e.length>t?e.slice(0,t)+"...":e:void 0},me=function(e){if(!K(e)&&!Y(e))return null;if("object"===n(e)||_e(e))return e;var t=e.replace(/(?:\r\n|\r|\n)/g,"").trim();try{return JSON.parse(t)}catch(e){}return null},be=function(e,t){return K(t)?function(e){var t,n,i,r,o,s,a,u,l=0,d="";if(!e)return e;do{t=e[l++],n=e[l++],i=e[l++],r=(a=t<<16|n<<8|i)>>12&63,o=a>>6&63,s=63&a,d+=Ie.charAt(a>>18&63)+Ie.charAt(r)+Ie.charAt(o)+Ie.charAt(s)}while(l<e.length);return((u=e.length%3)?d.slice(0,u-3):d)+"===".slice(u||3)}(t=function(e,t){return Array.from(t).map((function(t,n){return t.charCodeAt(0)^ke(e,n)}))}(e,t)):null},Se=function(e,t){return function(e,t){return Array.from(t).map((function(t,n){return String.fromCharCode(t^ke(e,n))})).join("")}(e,t=function(e){var t,n,i,r,o,s,a,u,l=0,d=[];if(!e)return e;e+="";do{r=Ie.indexOf(e.charAt(l++)),o=Ie.indexOf(e.charAt(l++)),s=Ie.indexOf(e.charAt(l++)),a=Ie.indexOf(e.charAt(l++)),t=(u=r<<18|o<<12|s<<6|a)>>16&255,n=u>>8&255,i=255&u,d.push(t),64!==s&&(d.push(n),64!==a&&d.push(i))}while(l<e.length);return d}(t))},Ie="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function ke(e,t){return e.charCodeAt(Math.floor(t%e.length))}function Ce(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),i=0;i<e.length;i++)n[i]=e.charCodeAt(i);return t}function ye(e){for(var t="",n=new Uint8Array(e),i=0;i<n.length;i++)t+=String.fromCharCode(n[i]);return t}String.prototype.includes||(String.prototype.includes=function(){return-1!==String.prototype.indexOf.apply(this,arguments)}),Array.from||(Array.from=(B=Object.prototype.toString,z=function(e){return"function"==typeof e||"[object Function]"===B.call(e)},j=Math.pow(2,53)-1,J=function(e){var t=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),j)},function(e){var t=this,n=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var i,r=arguments.length>1?arguments[1]:void 0;if(void 0!==r){if(!z(r))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(i=arguments[2])}for(var o,s=J(n.length),a=z(t)?Object(new t(s)):new Array(s),u=0;u<s;)o=n[u],a[u]=r?void 0===i?r(o,u):r.call(i,o,u):o,u+=1;return a.length=s,a})),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(e,t){if(null==this)throw new TypeError('"this" is null or not defined');var n=Object(this),i=n.length>>>0;if(0===i)return!1;var r,o,s=0|t,a=Math.max(s>=0?s:i-Math.abs(s),0);for(;a<i;){if((r=n[a])===(o=e)||"number"==typeof r&&"number"==typeof o&&isNaN(r)&&isNaN(o))return!0;a++}return!1}});var we,xe=function(e,t){var n=Object.keys(e),i={};return n.forEach((function(n){e[n]!==t[n]&&(i[n]=e[n])})),i},Ee=function(){var e=new Date;return e.getMonth()+"/"+e.getDate()+"/"+e.getFullYear()},De=function(){var e=new Date;return{hours:e.getHours(),mins:e.getMinutes()}},Ae=["log","debug","info","warn","error"],Te=Ae.reduce((function(e,t){return e[t]=t,e}),{}),Oe=function(e){if(H(e)){var t=function(){return null};e=Ae.reduce((function(e,n){return e[n]=t,e}),{})}return e},Ne=function(){function e(){i(this,e)}return o(e,null,[{key:"enabled",set:function(t){e._enabled=t}},{key:"level",set:function(t){e._level=t}},{key:"console",set:function(t){e._console=Oe(t)}}]),e}();we=Ne,s(Ne,"_console",Oe()),s(Ne,"_enabled",!1),s(Ne,"_level","error"),s(Ne,"_render",(function(e){return function(){var t=Ae.indexOf(e)>=Ae.indexOf(we._level);if(we._enabled&&t){for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];we._console[e].apply(we._console,i)}}})),s(Ne,"log",we._render(Te.log)),s(Ne,"info",we._render(Te.info)),s(Ne,"debug",we._render(Te.debug)),s(Ne,"warn",we._render(Te.warn)),s(Ne,"error",we._render(Te.error));var Me=o((function e(){i(this,e),s(this,"onEvent",(function(e,t){Ne.debug('"onEvent Callback called with type '.concat(e," and properties ").concat(t,'"'))}))}));function Pe(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function Re(e,t,n,i,r,o){return Pe((s=Pe(Pe(t,e),Pe(i,o)))<<(a=r)|s>>>32-a,n);var s,a}function Fe(e,t,n,i,r,o,s){return Re(t&n|~t&i,e,t,r,o,s)}function Ue(e,t,n,i,r,o,s){return Re(t&i|n&~i,e,t,r,o,s)}function Le(e,t,n,i,r,o,s){return Re(t^n^i,e,t,r,o,s)}function qe(e,t,n,i,r,o,s){return Re(n^(t|~i),e,t,r,o,s)}function Be(e,t){var n,i,r,o,s;e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var a=1732584193,u=-271733879,l=-1732584194,d=271733878;for(n=0;n<e.length;n+=16)i=a,r=u,o=l,s=d,a=Fe(a,u,l,d,e[n],7,-680876936),d=Fe(d,a,u,l,e[n+1],12,-389564586),l=Fe(l,d,a,u,e[n+2],17,606105819),u=Fe(u,l,d,a,e[n+3],22,-1044525330),a=Fe(a,u,l,d,e[n+4],7,-176418897),d=Fe(d,a,u,l,e[n+5],12,1200080426),l=Fe(l,d,a,u,e[n+6],17,-1473231341),u=Fe(u,l,d,a,e[n+7],22,-45705983),a=Fe(a,u,l,d,e[n+8],7,1770035416),d=Fe(d,a,u,l,e[n+9],12,-1958414417),l=Fe(l,d,a,u,e[n+10],17,-42063),u=Fe(u,l,d,a,e[n+11],22,-1990404162),a=Fe(a,u,l,d,e[n+12],7,1804603682),d=Fe(d,a,u,l,e[n+13],12,-40341101),l=Fe(l,d,a,u,e[n+14],17,-1502002290),a=Ue(a,u=Fe(u,l,d,a,e[n+15],22,1236535329),l,d,e[n+1],5,-165796510),d=Ue(d,a,u,l,e[n+6],9,-1069501632),l=Ue(l,d,a,u,e[n+11],14,643717713),u=Ue(u,l,d,a,e[n],20,-373897302),a=Ue(a,u,l,d,e[n+5],5,-701558691),d=Ue(d,a,u,l,e[n+10],9,38016083),l=Ue(l,d,a,u,e[n+15],14,-660478335),u=Ue(u,l,d,a,e[n+4],20,-405537848),a=Ue(a,u,l,d,e[n+9],5,568446438),d=Ue(d,a,u,l,e[n+14],9,-1019803690),l=Ue(l,d,a,u,e[n+3],14,-187363961),u=Ue(u,l,d,a,e[n+8],20,1163531501),a=Ue(a,u,l,d,e[n+13],5,-1444681467),d=Ue(d,a,u,l,e[n+2],9,-51403784),l=Ue(l,d,a,u,e[n+7],14,1735328473),a=Le(a,u=Ue(u,l,d,a,e[n+12],20,-1926607734),l,d,e[n+5],4,-378558),d=Le(d,a,u,l,e[n+8],11,-2022574463),l=Le(l,d,a,u,e[n+11],16,1839030562),u=Le(u,l,d,a,e[n+14],23,-35309556),a=Le(a,u,l,d,e[n+1],4,-1530992060),d=Le(d,a,u,l,e[n+4],11,1272893353),l=Le(l,d,a,u,e[n+7],16,-155497632),u=Le(u,l,d,a,e[n+10],23,-1094730640),a=Le(a,u,l,d,e[n+13],4,681279174),d=Le(d,a,u,l,e[n],11,-358537222),l=Le(l,d,a,u,e[n+3],16,-722521979),u=Le(u,l,d,a,e[n+6],23,76029189),a=Le(a,u,l,d,e[n+9],4,-640364487),d=Le(d,a,u,l,e[n+12],11,-421815835),l=Le(l,d,a,u,e[n+15],16,530742520),a=qe(a,u=Le(u,l,d,a,e[n+2],23,-995338651),l,d,e[n],6,-198630844),d=qe(d,a,u,l,e[n+7],10,1126891415),l=qe(l,d,a,u,e[n+14],15,-1416354905),u=qe(u,l,d,a,e[n+5],21,-57434055),a=qe(a,u,l,d,e[n+12],6,1700485571),d=qe(d,a,u,l,e[n+3],10,-1894986606),l=qe(l,d,a,u,e[n+10],15,-1051523),u=qe(u,l,d,a,e[n+1],21,-2054922799),a=qe(a,u,l,d,e[n+8],6,1873313359),d=qe(d,a,u,l,e[n+15],10,-30611744),l=qe(l,d,a,u,e[n+6],15,-1560198380),u=qe(u,l,d,a,e[n+13],21,1309151649),a=qe(a,u,l,d,e[n+4],6,-145523070),d=qe(d,a,u,l,e[n+11],10,-1120210379),l=qe(l,d,a,u,e[n+2],15,718787259),u=qe(u,l,d,a,e[n+9],21,-343485551),a=Pe(a,i),u=Pe(u,r),l=Pe(l,o),d=Pe(d,s);return[a,u,l,d]}function ze(e){var t,n="",i=32*e.length;for(t=0;t<i;t+=8)n+=String.fromCharCode(e[t>>5]>>>t%32&255);return n}function je(e){var t,n=[];for(n[(e.length>>2)-1]=void 0,t=0;t<n.length;t+=1)n[t]=0;var i=8*e.length;for(t=0;t<i;t+=8)n[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return n}function Je(e){var t,n,i="";for(n=0;n<e.length;n+=1)t=e.charCodeAt(n),i+="0123456789abcdef".charAt(t>>>4&15)+"0123456789abcdef".charAt(15&t);return i}function He(e){return unescape(encodeURIComponent(e))}function Ve(e){return function(e){return ze(Be(je(e),8*e.length))}(He(e))}function Ke(e,t){return function(e,t){var n,i,r=je(e),o=[],s=[];for(o[15]=s[15]=void 0,r.length>16&&(r=Be(r,8*e.length)),n=0;n<16;n+=1)o[n]=909522486^r[n],s[n]=1549556828^r[n];return i=Be(o.concat(je(t)),512+8*t.length),ze(Be(s.concat(i),640))}(He(e),He(t))}var We=function(e,t,n){return t?n?Ke(t,e):Je(Ke(t,e)):n?Ve(e):Je(Ve(e))},Ge=o((function e(){var t=this;i(this,e),s(this,"notifyListeners",(function(e,n){if(t._listeners[e])for(var i=t._listeners[e],r=0;r<i.length;r++){(0,i[r])(n)}})),s(this,"registerForEvent",(function(e,n){var i;G(n)&&((i=t._listeners[e]?t._listeners[e]:[]).push(n),t._listeners[e]=i)})),s(this,"unregisterFromEvent",(function(e,n){if(t._listeners[e]){for(var i=t._listeners[e],r=[],o=0;o<i.length;o++){var s=i[o];s!==n&&r.push(s)}t._listeners[e]=r}})),s(this,"tearDown",(function(){t._listeners={}})),this._listeners={}})),Ye=function(e,t){return{name:"visible"===e?"FOREGROUND":"BACKGROUND",time:$(t)?ce(t):0}},Xe=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(Y(e)&&_e(t))return{name:e,additional_info:t,category:K(n)&&Y(n)?n:void 0,time:$(i)?ce(i):0}},$e=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return{navigation_id:e,name:t,duration:$(n)?ce(n):0,transition_time:$(i)?ce(i):0}},Ze={navigation_events:[],app_events:[],system_events:[],user_events:[],chunk_attributes:{},user_attributes:{},session_attributes:{}},Qe=function(e){return{sdk_version:240,config_id:"apx",tick_interval:1,chunk_retry_window:1800,sdk_start_time:e}},et=function(e,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return Ne.debug("Model : Building the initial state of the Chunk"),{sdk_info:Qe(e),session_info:{id:i,launch_time:n,launch_time_string:te(new Date(n)),startup_time:0,is_background:!1,is_first_session:!1,duration:0,total_duration:0,process_name:"",is_fatal:!1,launch_type:"normal"},app_info:{app_name:"",app_version:"ALL",bundle_id:"",installation_time:ft.getInstance().getInstallationTime(ne()),app_mode:"production"},device_info:oe(window),chunk_meta:{id:i+":"+r,number:r,reporting_times:[]},chunk_details:t(t({},Ze),{},{user_attributes:{},session_attributes:{}})}},tt=o((function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,e),s(this,"post",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=t.window.XMLHttpRequest;Ne.debug("Request : POST request with data"),s?t._makeXmlHttpRequest(e,n,i,r,o):(Ne.error("Request : Unknown browser"),i(403,"Unknown")),Ne.debug("Request : Sent request to server")})),s(this,"get",(function(e,n){var i=t.window,r=i.fetch,o=i.XMLHttpRequest;if(r)r(e).then((function(e){try{if(e.ok)return e.json()}catch(e){Ne.debug("Request : Error while parsing the response ".concat(e))}return null})).then((function(e){K(e)?n(200,e):(Ne.error("Request : API request failed. ".concat(JSON.stringify(e))),n(500,{}))})).catch((function(e){Ne.error("Request : API request failed. ".concat(e)),n(500,e)}));else if(o){var s=new o;s.open("GET",e,!0),s.onreadystatechange=function(){4===s.readyState&&n(s.status,s.responseText)},s.send()}else Ne.error("Request : Unknown browser"),n(403,"Unknown");Ne.debug("Request : sent request to server")})),s(this,"_makeXmlHttpRequest",(function(e,n,i,r,o){var s=new XMLHttpRequest;s.onerror=function(e){Ne.error("Request : API request failed. ".concat(e)),i(500,null)},s.open("POST",e,o),s.setRequestHeader("Content-Type","application/json; charset=UTF-8"),Object.keys(null!=r?r:{}).forEach((function(e){s.setRequestHeader(e,r[e])})),s.onreadystatechange=function(){if(4===s.readyState){var r=s.responseText,o=r.match(/Failed to execute 'send' on 'XMLHttpRequest'/);if(!(V(o)||H(o)||V(o[0])||H(o[0])||"Failed to execute 'send' on 'XMLHttpRequest'"!==o[0]))return void t._makeXmlHttpRequest(e,n,i,!0);try{r=JSON.parse(r)}catch(e){Ne.debug("Request : Error while parsing the response ".concat(e))}i(s.status,r)}};try{s.send(JSON.stringify(n))}catch(e){Ne.error("Request : API request failed. ".concat(e)),i(500,e)}})),this.window=n})),nt="/<app-id>/chunks?isTestDevice=<test-device>",it="/sdk/<app-id>/enabled-status?platform=web&version=240",rt=_.api_root,ot=function(e,t){return rt+e.replace("<app-id>",t)},st=o((function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i(this,e),s(this,"_callback",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){return null},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return null};return function(n,i){Ne.debug("XHR Response: [".concat(n,"]")),n<400?i&&"APXOR_STATUS_SUCCESS"===i.apxor_status?i.details?e(i.details):e(i):200===n?e(i):t(n,i):t&&G(t)&&t(n,i)}})),s(this,"checkIfSDKEnabled",(function(e,t){n.makeGetRequest(n.sdkEnabledStatusAPI,e,t)})),s(this,"getConfig",(function(e,t){n.makeGetRequest(n.configAPI,e,t)})),s(this,"postUserInfo",(function(e,t,i){n.request.post(n.userInfoAPI,e,n._callback(t,i),{})})),s(this,"postChunk",(function(e,t,i){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];Ne.debug("Posting chunk"),n.request.post(n.chunksAPI,e,n._callback(t,i),{},r)})),s(this,"makeGetRequest",(function(e,t,i){n.request.get(e,n._callback(t,i))})),s(this,"makePostRequest",(function(e,t,i,r,o){n.request.post(e,t,n._callback(r,o),i)})),this.request=new tt(r),this.configAPI=ot("/config/<app-id>/web",t),this.chunksAPI=ot(nt,t),this.chunksAPI=this.chunksAPI.replace("<test-device>",ft.getInstance().isTestDevice()),this.sdkEnabledStatusAPI=ot(it,t),this.userInfoAPI=ot("/user?appId=<app-id>",t)})),at=o((function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;i(this,e),s(this,"_lastBackgroundTime",-1),s(this,"_totalBackgroundTime",0),s(this,"getTotalBackgroundTime",(function(){return t._totalBackgroundTime})),s(this,"getLastBackgroundTime",(function(){return t._lastBackgroundTime})),s(this,"reset",(function(){t._lastBackgroundTime=-1,t._totalBackgroundTime=0})),s(this,"_onSystemEvent",(function(e){if("FOREGROUND"===e.name){if(-1!==t._lastBackgroundTime){var n=Math.round(de(Date.now()-t._lastBackgroundTime));t._totalBackgroundTime+=n;var i=ft.getInstance().getFromStorage("_apx_sId");if(K(i)&&ft.getInstance().getSessionId()!==i){ft.getInstance().createANewChunk();var r=ft.getInstance().getSessionInfo(),o=r.total_duration,s=r.duration;t._totalBackgroundTime=o>s?o-s:0}}}else t._lastBackgroundTime=Date.now(),ft.getInstance().persistToStorage("apx_lbgt",t._lastBackgroundTime)})),ft.getInstance().registerForEvent("SYSTEM_EVENT",this._onSystemEvent),this._totalBackgroundTime=n,ft.getInstance().persistToStorage("apx_lbgt",this._lastBackgroundTime)})),ut=function(){function e(t){var n=this;i(this,e),s(this,"_isStorageAvailable",!1),s(this,"_isSupported",(function(e){var t=!0;try{window[e]?(window[e].setItem("_apx_","apx"),"apx"!==window[e].getItem("_apx_")&&(t=!1),window[e].removeItem("_apx_")):t=!1}catch(e){t=!1}return t||Ne.error("Storage : LocalStorage not supported"),t})),s(this,"logError",(function(e){Ne.error("".concat(n.storageType," Error: "),e)})),s(this,"get",(function(e){try{return n.storage.getItem(e)}catch(t){Ne.error("Storage : Error while getting the ".concat(e," from storage - ").concat(t))}return null})),s(this,"getParsed",(function(e){try{return JSON.parse(n.storage.getItem(e))}catch(t){Ne.error("Storage : Error while parsing ".concat(e,"'s value from storage - ").concat(t))}return null})),s(this,"set",(function(e,t){try{n.storage.setItem(e,t)}catch(t){Ne.error("Storage : Error while setting the ".concat(e,"'s value to storage - ").concat(t))}})),s(this,"remove",(function(e){try{n.storage.removeItem(e)}catch(t){Ne.error("Storage : Error while removing the ".concat(e," from storage - ").concat(t))}})),s(this,"clear",(function(){try{n.storage.removeItem("_apx_config"),n.storage.removeItem("_apx_ua"),n.storage.removeItem("_apx_lEt"),n.storage.removeItem("_apx_sId"),n.storage.removeItem("_apx_sc"),n.storage.removeItem("apx_id"),n.storage.removeItem("apx_in"),n.storage.removeItem("apx_ver"),n.storage.removeItem("apx_lbgt"),n.storage.removeItem("_apx_cd"),n.storage.removeItem("_apx_od"),n.storage.removeItem("_apx_lt_count"),n.storage.removeItem("_apx_use"),n.storage.removeItem("_apx_scnm"),n.storage.removeItem("_apx_lct"),n.storage.removeItem("_apx_ch"),n.storage.removeItem("_apx_lef"),n.storage.removeItem("_apx_ledt")}catch(e){Ne.error("Storage : Error while clearing the storage - ".concat(e))}})),this._isStorageAvailable=this._isSupported(t),this._isStorageAvailable?(this.storage=window[t],this.storageType=t):(this.storageType=t,this.storage={length:0,getItem:function(){},setItem:function(){},removeItem:function(){},clear:function(){},get:function(){},set:function(){},remove:function(){},getParsed:function(){}})}return o(e,[{key:"isStorageAvailable",value:function(){return this._isStorageAvailable}}],[{key:"waitForBrowserStorage",value:function(t){var n=15,i=setInterval((function(){n--,e.isLocalStorageEnabled()||n<=0?(Ne.debug("Storage : Local storage available"),clearInterval(i),t()):Ne.debug("Storage : Local storage not available yet")}),100)}},{key:"isLocalStorageEnabled",value:function(){try{var e="__apx_storage_test__";window.localStorage.setItem(e,"test");var t=window.localStorage.getItem(e);return window.localStorage.removeItem(e),"test"===t}catch(e){return Ne.debug("Browser storage is not enabled yet : ".concat(e)),!1}}}]),e}();var lt=function(){function e(n){var r=this;i(this,e),s(this,"_siteId",""),s(this,"getExistingConfig",(function(){var e,t=r.storage.get("_apx_config");if(K(t))try{t=JSON.parse(Se(r._siteId,t))}catch(e){t=null}return null!==(e=t)&&void 0!==e?e:_})),s(this,"persistConfig",(function(e){r.storage.set("_apx_config",be(r._siteId,JSON.stringify(e)))})),s(this,"persistUserId",(function(e){r.storage.set("apx_id",e)})),s(this,"getUserId",(function(){var e=null;try{e=r.storage.get("apx_id")}catch(e){Ne.debug("Datamaager : Can not get user id from storage-"+e)}return e})),s(this,"persistAppVersion",(function(e){return r.storage.set("apx_ver",e)})),s(this,"getAppVersion",(function(){var e=r.storage.get("apx_ver");if(!K(e)&&q.isCookieAvailable()){var t=q.get("apx_ver");if(K(t))return r.storage.set("apx_ver",t),t}return e})),s(this,"persist",(function(e,t){r.storage.set(e,t)})),s(this,"getItem",(function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=r.storage.get(e);if(t){var i=me(n);if(null===i)try{n=JSON.parse(Se(r._siteId,n))}catch(t){Ne.debug("Datamanager : ".concat(e," - value not found in storage")),n=null}else n=i}return Ne.debug("Datamanager : ".concat(e,"'s value from storage is ").concat(JSON.stringify(n))),n})),s(this,"getItemOrDefault",(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=r.getItem(e,n);return K(i)?i:(Ne.debug("Datamanager : ".concat(e,"'s value is not defined. Returning default-").concat(JSON.stringify(t))),t)})),s(this,"clearStorage",(function(){r.storage.clear()})),s(this,"resetUserProperties",(function(){Ne.debug("Datamanager : Removing the user attributes form the storage"),r.storage.remove("_apx_ua")})),s(this,"persistInstallationTime",(function(e){Ne.debug("DataManager : Setting the installation time to ".concat(e)),r.storage.set("apx_in",e)})),s(this,"getInstallationTime",(function(e){var t=r.storage.get("apx_in");return K(t)?(Ne.debug("Datamanager : Stored installation time ".concat(t)),Number(t)):(Ne.debug("Datamanager : Stored installation time not found. Persisting and returning the default time ".concat(e)),r.persistInstallationTime(e),e)})),s(this,"persistOldChunk",(function(e){Ne.debug("Datamanager : Persisting the old session chunk to the storage"),r.storage.set("_apx_od",be(r._siteId,JSON.stringify(e)))})),s(this,"getOldChunk",(function(){var e;Ne.debug("Datamanager : Getting the old session chunk details form the storage");var t=r.storage.get("_apx_od"),n=me(t);if(null===n)try{t=JSON.parse(Se(r._siteId,t))}catch(e){t=null}else t=n;return null!==(e=t)&&void 0!==e?e:[]})),s(this,"removeOldChunk",(function(){Ne.debug("Datamanager : Removing the old session chunk details form the storage"),r.storage.remove("_apx_od")})),s(this,"getOldChunkDetails",(function(){return r.getItem("_apx_use",!0)})),s(this,"persistOldChunkDetails",(function(e){Ne.debug("Datamanager : Persisting the old session chunk details to the storage"),r.storage.set("_apx_use",be(r._siteId,JSON.stringify(e)))})),s(this,"removeOldChunkDetails",(function(){Ne.debug("Datamanager : Removing the old session chunk details form the storage"),r.storage.remove("_apx_use")})),s(this,"getSessionsChunkNumberMap",(function(){Ne.debug("Datamanager : Getting the session chunknumber map");var e=r.getItem("_apx_scnm",!0);return K(e)||(e={}),e})),s(this,"persistSessionsChunkNumberMap",(function(e){Ne.debug("Datamanager : Persisting the new session chunknumber map");var t=be(r._siteId,JSON.stringify(e));r.persist("_apx_scnm",t)})),s(this,"getNewChunk",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now(),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now(),i=arguments.length>2?arguments[2]:void 0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3600;Ne.debug("Datamanager : Creating a new chunk");var s,a=!1,u=Number(r.storage.get("_apx_lEt"))||0,l=Date.now(),d=Math.round(de(l-u)),c=r.getCurrentChunk();if((d>o||W(c))&&(a=!0),a)Ne.debug("Datamanager : This is a new session. Creating a new chunk"),s=et(e,n,i);else{Ne.debug("Datamanager : This is an old session. Updating the existing chunk");var _=c.chunk_meta.number,g=c.session_info.id,h=_+1;(s=t({},c)).chunk_meta=t(t({},s.chunk_meta),{},{number:h,id:g+":"+h,reporting_times:[Date.now()]}),s.chunk_details=t({},Ze)}return{is_new_session:a,chunk:s}})),s(this,"clearCurrentChunk",(function(){Ne.debug("Datamanager : Current chunk removed from storage"),r.storage.remove("_apx_cd")})),s(this,"persistCurrentChunk",(function(e){Ne.debug("Datamanager : Persisting the Current chunk to storage"),r.storage.set("_apx_cd",be(r._siteId,JSON.stringify(e)))})),s(this,"getCurrentChunk",(function(){return r.getItem("_apx_cd",!0)})),this._siteId=n,this.storage=new ut("localStorage"),Ne.debug("DataManager : Initialized")}return o(e,[{key:"getltCount",value:function(e){try{var t=this.storage.get("_apx_lt_count");if(t){var n=Se(this._siteId,t);return JSON.parse(n)[e.replace("'","").replace("â€™","")]}}catch(t){Ne.error("Datamanager : Error gettting the LT Count for the event -"+e)}return 0}},{key:"updateRetainedDayCount",value:function(e){Ne.debug("Datamanager : Re-calculating and updating the retention day");var t=this.getItem("apx_in"),n=Math.abs(t-e)/36e5,i=Math.floor(n/24);this.persist("apx_retained_days",i)}}]),e}(),dt=["scroll","touchmove"],ct=o((function e(){var t=this,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];i(this,e),s(this,"_isFirst",!0),s(this,"listenSystemEvents",(function(){Ne.debug("Registering for System Event ","visibilitychange");var e=function(){var e=ft.getInstance(),n=e.getSDKRunningTimeInSec(),i="visible"===window.document.visibilityState,r=Ye(window.document.visibilityState,n);if(i?(e.setBlockChunkReportingFlag(!1),t._lastBackgroundTime>-1&&(e.sendOldChunk((function(){e.dispatchEvent("SYSTEM_EVENT",r)})),r.background_time=ce(de(Date.now()-t._lastBackgroundTime)))):(e.setBlockChunkReportingFlag(!0),e.reportChunkOnVisibilityChange(),t._lastBackgroundTime=Date.now(),e.dispatchEvent("SYSTEM_EVENT",r)),i){var o=e.getUserAttributes().apx_browser;!t._isFirst||-1!==o.indexOf("Mobile Safari")&&-1!==o.indexOf("Safari")||(t._isFirst=!1)}else e.clearNavigation()};Q(document,"visibilitychange",e),t._handlers.push(t._newHandler("visibilitychange",e))})),s(this,"unregisterEvents",(function(){t._handlers.forEach((function(e){var t=e.type,n=e.handler;Ne.debug("Unregistering from event type ",t),dt.includes(t)?ee(window.document,t,n):ee(document,t,n)})),t._handlers=[],t._scrollEvents=[],t._scrollData={}})),s(this,"getScrollEvents",(function(){return[]})),s(this,"_newHandler",(function(e,t){return{type:e,handler:t}})),this._lastBackgroundTime=-1,this._handlers=[],this._scrollEvents=[],this._scrollData={},this._isFirst=n,this.listenSystemEvents()})),_t=o((function e(){var t=this;i(this,e),s(this,"_validateHash",!0),s(this,"_siteId",""),s(this,"_RTA",0),s(this,"_SURVEYS",1),s(this,"initialize",(function(e,n){t._siteId=n;var i=e.validate_hash,r=void 0===i||i,o=e.cs_ht_time,s=void 0===o?-1:o;t._validateHash=r,t.configsHashThrottleTime=s,ft.getInstance().registerForEvent("APP_EVENT",(function(e){t._updateCountInStorage(e.name)}))})),s(this,"fetchConfiguration",(function(e,n,i,r){if(G(r))if(t._validateHash){var o=ft.getInstance();if(t.configsHashThrottleTime>0){var s=o.getValueOrDefault(e+"_lcfht",-1);if(s>0)if(Math.abs(Date.now()-s)<t.configsHashThrottleTime)return void t._fetchFromStorageAndSend(e,r)}o.persistToStorage(e+"_lcfht",Date.now());var a=t._getSyncData(),u={pid_mid:[]},l=a[e];if(K(l)){Array.isArray(l)||(l=[l]);var d=[];l.forEach((function(e){var t=e.pid+"_"+e.mid;d.includes(t)||d.push(t)})),d.length>0&&(u.pid_mid=d.join(","))}else l=[];var c=o.getUserAttributes().custom_user_id,_=void 0===c?null:c;_&&(n+="&customerId="+_),o.makePostRequest(n,u,{"Content-Type":"application/json"},(function(n){t._validateHashes(n,e,i,{configs:l,syncData:a},r)}),(function(){Ne.error("Failed to fetch"),r(e,{configs:l})}))}else t._fetchConfig(e,i,[],r)})),s(this,"_getSyncData",(function(){var e=ft.getInstance().getFromStorage("_apx_sc");return K(e)?JSON.parse((new TextDecoder).decode(Ce(Se(ft.getInstance().getSiteId(),e)))):{}})),s(this,"_fetchFromStorageAndSend",(function(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=i;i||(r=t._getSyncData());var o=r[e];K(o)&&(Array.isArray(o)||(o=[o]),Ne.debug("Reading from storage"),n(e,{configs:o}))})),s(this,"_validateHashes",(function(e,n,i,r,o){var s=e.pull,a=void 0===s?[]:s,u=e.drop,l=void 0===u?[]:u,d=r.configs,c=r.syncData,_=JSON.parse(ft.getInstance().getFromStorage("apx_termination_ID")),g=[];l.length>0||a.length>0?(d.forEach((function(e){l.includes(e.pid)||a.includes(e.pid)||g.push(e),l.includes(e.pid)&&null!==_&&null!=_&&_[e._id]&&(delete _[e._id],ft.getInstance().persistToStorage("apx_termination_ID",JSON.stringify(_)))})),c[n]=g,ft.getInstance().persistToStorage("_apx_sc",be(t._siteId,ye((new TextEncoder).encode(JSON.stringify(c)))))):(Ne.debug("Nothing to delete",n),g=d),a.length>0?(a.forEach((function(e){i+="&pids="+e})),t._fetchConfig(n,i,g,o)):(Ne.debug("Nothing to pull",n),o(n,{configs:g}))})),s(this,"_fetchConfig",(function(e,n,i,r){ft.getInstance().makeGetRequest(n,(function(n){if(K(n.configs)&&Array.isArray(n.configs)&&0==n.configs.length)r("",{configs:[]});else if(K(n.configs)&&Array.isArray(n.configs)){n.configs.forEach((function(n){var i,r,o,s,a;null===(i=ft.getInstance())||void 0===i||i.logAppEvent("apx_config_received",{apx_nudge_type:e===t._SURVEYS?"survey":"campaign",apx_nudge_id:null==n?void 0:n._id,apx_nudge_name:null==n||null===(r=n.meta)||void 0===r?void 0:r.name,apx_variant_code:null!=n&&null!==(o=n.meta)&&void 0!==o&&o.isExperiment||null!=n&&null!==(s=n.meta)&&void 0!==s&&s.only_context?null==n||null===(a=n.meta)||void 0===a||null===(a=a.attr)||void 0===a?void 0:a.apx_variant_code:"TG"})}));var o=t._getSyncData(),s=[].concat(u(i),u(n.configs));o[e]=s,ft.getInstance().persistToStorage("_apx_sc",be(t._siteId,ye((new TextEncoder).encode(JSON.stringify(o))))),r(e,{configs:s})}}),(function(){r(e,{configs:[]})}))})),s(this,"handleNavigationEvent",(function(e){t._updateCountInStorage(e)})),s(this,"_updateCountInStorage",(function(e){var n=t._getSyncData();if(K(n.d)||(n.d={}),JSON.stringify(n.d).length>2097152)Ne.error("Sync : Reached maximum limit. Can't store further");else{var i=0;K(n.d[e])&&(i=n.d[e]),i+=1,n.d[e]=i,ft.getInstance().persistToStorage("_apx_sc",be(t._siteId,ye((new TextEncoder).encode(JSON.stringify(n)))))}})),s(this,"getEventCount",(function(e){var n=t._getSyncData();return K(n.d)&&K(n.d[e])?n.d[e]:0}))})),gt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return function(){Ne.error("".concat(e,": Apxor SDK not initialised."))}},ht={reportChunkOnVisibilityChange:gt("reportChunkOnVisibilityChange"),logAppEvent:gt("logAppEvent"),logClientEvent:gt("logClientEvent"),logPageView:gt("logPageView"),setUserId:gt("setUserId"),setUserProperties:gt("setUserProperties"),setSessionProperties:gt("setSessionProperties"),setAppVersion:gt("setAppVersion"),getClientId:gt("getClientId"),getSessionId:gt("getSessionId"),startSession:gt("startSession"),endSession:gt("endSession"),flattenJSON:gt("flattenJSON"),setRedirectionHandler:gt("setRedirectionHandler"),setInitFlag:gt("setInitFlag")},ft=function(){function e(){var n=this;return i(this,e),s(this,"_eventHandler",{}),s(this,"_isInitialized",!1),s(this,"_appInfo",{}),s(this,"_deviceInfo",{}),s(this,"_sdkInfo",{}),s(this,"_sessionInfo",{}),s(this,"_userAttributes",{}),s(this,"_sessionAttributes",{}),s(this,"_chunkDetails",{}),s(this,"_chunkNumber",1),s(this,"_currentNavigation",null),s(this,"_isRunning",!1),s(this,"_isEventMonitorRegistered",!1),s(this,"_dataManager",{}),s(this,"_customEventListener",null),s(this,"_systemEventMonitor",{}),s(this,"_sessionHandler",{}),s(this,"_sync",{}),s(this,"_idleTimeout",3600),s(this,"_maxEventsSentCount",20),s(this,"_chunkSendInterval",-1),s(this,"_internalChunkSendInterval",2e4),s(this,"_chunk502RetryTime",-1),s(this,"_maxSessionsInStorage",10),s(this,"_isSending",!1),s(this,"_isFirstSession",!1),s(this,"_last502Time",-1),s(this,"_batchEvents",!1),s(this,"_bulkUpload",!0),s(this,"clientEvents",[]),s(this,"_stopEventsFromConfig",[]),s(this,"_clientEventsFromConfig",[]),s(this,"_appEventsFromConfig",[]),s(this,"_data",{}),s(this,"_sessionCount",0),s(this,"_redirectionHandler",null),s(this,"_sendChunkOnEventsId",null),s(this,"_sendChunkOnETAId",null),s(this,"_blockChunkReporting",!1),s(this,"_SDKStartedAfterPluginInit",!1),s(this,"_eventsLogged",{}),s(this,"initWaitTime",1500),s(this,"version",""),s(this,"_deviceId",""),s(this,"_configHash",""),s(this,"sessionStartTime",null),s(this,"sessionId",""),s(this,"_ltCountObj",{}),s(this,"_pendingChunk",!1),s(this,"_initializePlugins",(function(e){var t=n.config.plugins;if(K(t)&&K(t.length))for(var i=0;i<t.length;i++){var r=t[i];try{var o;null===(o=window[r])||void 0===o||o.init(e),Ne.debug("Controller : Initialized plugin ".concat(r))}catch(e){Ne.error("Controller : Failed to initialize plugin ".concat(r," with error ").concat(e))}}})),s(this,"initialize",(function(e,t,i,r,o,s){if(!n._isInitialized){var a=function(){Ne.debug("Controller : On Site enabled in config"),n._getConfigHash(u,s)},u=function(e){n._configHash=e,Ne.debug("Controller : On config hash fetch"),n._waitForResourceLoad(e,l)},l=function(){Ne.info("Controller : Waiting for resources completed"),n._setWYSIWYGCookie(),n._initializeLTCount(),n._updateAppInfo(),n._deviceId=n._getDeviceId(),n._setDeviceInfo(),n._setDefaultUserProperties(),n._postUserInfo(),n._mergeStoredAndDefaultUserAttributes(),n._setDefaultSessionProperties(),n._setInitialSessionState(),n._reinitialiseChunkDetails(),n._downloadConfig(n._configHash);var e=n._getTotalBackgroundTime();n._sessionHandler=new at(e),n._registerSystemEventMonitor(),n.sendOldChunk(d)},d=function(){n._isRunning=!0,n._isInitialized=!0;var e=n.createANewChunk();n._dataManager.persistCurrentChunk(e),n._initializePlugins(c)},c=function(){var e,t;(n._dispatchSystemEvent(n.window.document.visibilityState),n.newSession&&(n.sessionStartTime=Date.now(),n.logAppEvent("apx_app_opened",{time:te(new Date)}),n._resetCampaignSessionFrequency()),n.logPageView(n.window.location.pathname),n._sendChunkWithAtleastOneEvent(),n._registerIntervalBasedChunkReporting(),o(),null!==(e=r.ApxorRTM)&&void 0!==e&&e.isBadgePresent)&&(null===(t=r.ApxorRTM)||void 0===t||t.badgesLists.forEach((function(e){var t;n.isBadgeTriggerSatisfied(e)&&!document.getElementById("apxor-badge-container-".concat("-".concat(e).replaceAll(" ","").replace(/[^\w\s]/gi,"")))&&(null===(t=r.ApxorRTM)||void 0===t||null===(t=t.ceInstance)||void 0===t||t.notifyEventListener(Xe("apxor-badge-container-".concat("-".concat(e).replaceAll(" ","").replace(/[^\w\s]/gi,"")),{},void 0,n.getTimeElapsedInSession())))})))};n._waitForBrowserStorage((function(){Ne.debug("Controller : Wait for browser storage completed."),n._initializeStateVariables(e,t,i,r),n._setConfig(),n._initializeFieldsFromConfig(),n._sync.initialize(n.config,n.siteId),n._checkEnableStatusInConfig(a,s)}))}})),s(this,"getSiteId",(function(){return n.siteId})),s(this,"setRedirectionHandler",(function(e){n._isInitialized?n._redirectionHandler?n._redirectionHandler=e:(n._redirectionHandler=e,n.registerForEvent("CLIENT_EVENT",n._clientRedirectionHandler)):ht.setRedirectionHandler()})),s(this,"_clientRedirectionHandler",(function(e){e&&"REDIRECT"===e.name&&n._redirectionHandler(e.additional_info.url)})),s(this,"makePostRequest",(function(e,t,i,r,o){n._api.makePostRequest(e,t,i,r,o)})),s(this,"getDevInfo",(function(){return n._deviceInfo})),s(this,"getListOfEventsLogged",(function(){return n._eventsLogged})),s(this,"_updateListOfEventsLogged",(function(e,i){n._eventsLogged[e]=n._eventsLogged[e]||{},n._eventsLogged[e]=t(t({},n._eventsLogged[e]),i)})),s(this,"getInstallationTime",(function(){return n._dataManager.getInstallationTime(n.startTime)})),s(this,"_waitForBrowserStorage",(function(e){Ne.debug("Controller : Checking if the browsers localstorage is available."),ut.waitForBrowserStorage(e)})),s(this,"_initializeStateVariables",(function(e,t,i,r){Ne.debug("Controller : Initializing the state variables"),n.window=r,n.startTime=t,n.siteId=e,n.clientConfig=i||{},n.initWaitTime=n.clientConfig.sdk_init_wait?1e3*n.clientConfig.sdk_init_wait:2e3,n._dataManager=new lt(n.siteId),n._api=new st(n.siteId,n.window),n._eventHandler=new Ge,n._sync=new _t,n._sdkInfo=Qe(n.startTime),n.sessionStartTime=parseInt(n._dataManager.getItemOrDefault("apx_sst",t)),Ne.debug("Controller : session start time is ".concat(n.sessionStartTime)),Ne.debug("Controller : SDK start time is ".concat(n.startTime)),n.sessionId=n.getFromStorage("_apx_sId")})),s(this,"_initializeLTCount",(function(){Ne.debug("Controller : Initializing the LT Count ");try{var e=n.getFromStorage("_apx_lt_count");if(e)n._ltCountObj=JSON.parse((new TextDecoder).decode(Ce(Se(n.siteId,e))));else{n._ltCountObj={};var t=be(n.siteId,ye((new TextEncoder).encode(JSON.stringify(n._ltCountObj))));n.persistToStorage("_apx_lt_count",t)}}catch(e){Ne.error("Controller : LT Count object parsing failed ".concat(e))}})),s(this,"_setWYSIWYGCookie",(function(){var e=new URLSearchParams(location.search),t=e.get("_a")||e.get("_p")||e.get("_x")||e.get("_o")||e.get("_r");if(t||(t=n.getFromStorage("_apxor_url_param")),t)try{Ne.debug("Controller : Initialising in WYSIWYG mode");var i=Se(n.siteId,t),r=i=JSON.parse(i),o=r.app_id,s=r.expiry,a=Date.now();if(o===n.siteId&&a<=s){var u=new Date(s+6e4).toUTCString(),l=btoa("_apx_ew");document.cookie="_apx_ewc=".concat(l,"; expires=").concat(u),i.expiry=i.expiry+6e4,n.persistToStorage("_apx_ew",i,!0),Ne.debug("Controller : _apx_ewc cookie set")}e.delete("_a"),e.delete("_p"),e.delete("_x"),e.delete("_o"),e.delete("_r");var d=location.pathname,c=e.toString();""!==c&&(d+="?"+c),n.window.history.replaceState({},document.title,d),Ne.debug("Controller : Query params reset after removing dashboard embedded params")}catch(e){Ne.error("Controller : Error while setting the WYSIWYG cookie ".concat(e))}else Ne.debug("Controller : Not in WYSIWYG mode")})),s(this,"_setConfig",(function(){Ne.debug("Controller : Setting the config");var e=n._dataManager.getExistingConfig();n._mergeConfigWithClientConfig(e)})),s(this,"_mergeConfigWithClientConfig",(function(e){n.config=t(t({},e),n.clientConfig),Ne.debug("Controller : New config and client configs Configs merged")})),s(this,"_initializeFieldsFromConfig",(function(){var e,t,i,r=n.config,o=r.version,s=void 0===o?"":o,a=r.bulk_upload,u=void 0===a||a,l=r.events_upload_time,d=r.idle_time_out,c=void 0===d?1800:d,_=r.events,g=void 0===_?{}:_,h=r.max_chunk_event_count,f=void 0===h?20:h,p=r.retry_time,v=r.max_sessions_in_storage,m=void 0===v?-1:v;n.version=n._validateAndGetAppVersion(s),n._bulkUpload=u,n._batchEvents=l>0,n._idleTimeout=$(c)?c:1800,n._stopEventsFromConfig=null!==(e=g.stop)&&void 0!==e?e:[],n._clientEventsFromConfig=null!==(t=g.action)&&void 0!==t?t:[],n._appEventsFromConfig=null!==(i=g.app)&&void 0!==i?i:[],n._maxEventsSentCount=K(f)&&$(f)?f:20,n._chunkSendInterval=K(l)&&$(l)&&l>=1e3?l:-1,n._chunk502RetryTime=K(p)&&$(p)&&p>=1e3?p:-1,n._maxSessionsInStorage=$(m)&&m>0?m:-1})),s(this,"_validateAndGetAppVersion",(function(e){var t;if(K(e))t=e,n._dataManager.persistAppVersion(t);else{var i=n._dataManager.getAppVersion();t=K(i)?i:""}return t})),s(this,"_checkEnableStatusInConfig",(function(e,t){if(Ne.debug("Controller : Checking if the Site is enabled existing config"),!n.config.enable)return Ne.debug("Controller : Site is disabled. Can't initialise"),n._downloadConfig(""),n._postUserInfo(),void t();e()})),s(this,"_getConfigHash",(function(e,t){var i=n._dataManager.getExistingConfig(),r=n._dataManager.getItemOrDefault("_apx_ledt",-1),o=i.ed_t_time;if(o>0&&r>0&&Math.abs(r-Date.now())<60*o*1e3)return Ne.debug("Controller : Reinitializing with in the throttling time."),n._dataManager.getItemOrDefault("_apx_lef",!0)?void e(n._dataManager.getItemOrDefault("_apx_ch","")):(Ne.debug("Controller : Site is not enabled from the last update. Can't initalise now. Recheck will happen after throttling time"),void t());n._checkEnableStatusFromServer(e,t)})),s(this,"_checkEnableStatusFromServer",(function(e,t){Ne.debug("Controller : Getting the site enabled status from the server"),n.persistToStorage("_apx_ledt",Date.now()),n._api.checkIfSDKEnabled((function(i){var r=i.enabled,o=i.hash;n.persistToStorage("_apx_lef",r),r?(Ne.debug("Controller : Site is enabled"),e(o)):(Ne.debug("Controller : Site is disabled. Can't initialise the SDK"),n._isInitialized=!1,n._isRunning=!1,n._stopSDK(),t())}),(function(e){Ne.error("Controller : enabled-status API failed ".concat(e))}))})),s(this,"_stopSDK",(function(){Ne.debug("Controller: Stopping the SDK");try{var e,t;n._isRunning=!1,n._isInitialized=!1,n._isSending=!1,null===(e=n._eventHandler)||void 0===e||e.tearDown(),null===(t=n._systemEventMonitor)||void 0===t||t.unregisterEvents()}catch(e){Ne.error("Controller : Failed to stop the SDK ".concat(e))}})),s(this,"_waitForResourceLoad",(function(e,t){Ne.debug("Controller: Waiting ".concat(n.initWaitTime,"ms for all the resource loading to finish")),setTimeout((function(){t(e)}),n.initWaitTime)})),s(this,"_getDeviceId",(function(){var e=n._dataManager.getUserId();if(!K(e)){Ne.debug("Controller : Device id not found in localstorage");var t=n.config.client_id;K(t)&&""!==t?(Ne.debug("Controller : client id from clientconfig is the deviceid"),e=t):(Ne.debug("Controller : Generated a new device id. This is a new device now"),e=ie()),n._setNewUserFlags(e)}return Ne.debug("Controller : Device id is ".concat(e)),n._deviceId=e,e})),s(this,"_setNewUserFlags",(function(e){n._dataManager.clearStorage(),n._dataManager.persistUserId(e),n._dataManager.persistInstallationTime(Date.now()),n._sessionInfo=t(t({},n._sessionInfo),{},{is_first_session:!0}),n._isFirstSession=!0})),s(this,"_setInitialSessionState",(function(){Ne.debug("Controller : Setting the session state for session if ".concat(n.sessionId)),n.sessionId||(n.newSession=!0,n.sessionId=ie(),n.persistToStorage("_apx_sId",n.sessionId),n.persistToStorage("apx_sst",n.sessionStartTime))})),s(this,"_setDeviceInfo",(function(){var e=oe(n.window),t=e.device,i=e.os,r=e.browser_version,o=e.browser,s=e.dimensions,a=e.dpi,u=e.dimensions_in_pixels;n._deviceInfo=function(e,t,n,i,r,o,s,a){return{id:e,hardware_model:t,dimensions:n,os_version:i,platform:"web",dpi:r,dimensions_in_pixels:o,browser:s,browser_version:a}}(n._deviceId,t,s,i,a,u,o,r)})),s(this,"_setDefaultUserProperties",(function(){Ne.debug("Controller : Setting the default User attributes");var e=t({},n._deviceInfo),i=se(n.window,e);n._userAttributes=t(t({},n._userAttributes),i)})),s(this,"_setDefaultSessionProperties",(function(){Ne.debug("Controller : Setting the default session attributes");var e=ae(n.window);n._sessionAttributes=t(t({},n._sessionAttributes),e)})),s(this,"_mergeStoredAndDefaultUserAttributes",(function(){Ne.debug("Controller : Merging the stored and default user attributes");var e=n.getFromStorage("_apx_ua",!0);if(K(e)){var i,r=me(e);if(null===r)try{r=JSON.parse(Se(n.siteId,e))}catch(e){r={}}n._userAttributes=t(t({},null!==(i=r)&&void 0!==i?i:{}),n._userAttributes)}})),s(this,"_reinitialiseChunkDetails",(function(){n._chunkDetails=t(t({},Ze),{},{user_attributes:t({},n._userAttributes),session_attributes:t({},n._sessionAttributes)}),n._dataManager.persistOldChunkDetails(n._chunkDetails)})),s(this,"sendOldChunk",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};Ne.debug("Controller : Sending the old chunk to the server");var i=n._dataManager.getOldChunk();if(K(i)){var r,o,s,a,u,l,d=t({},n._chunkDetails);if(n._chunkDetails=t({},i.chunk_details)||{},(null===(r=n._chunkDetails)||void 0===r||null===(r=r.app_events)||void 0===r?void 0:r.length)>0||n._addAndClearUnsentEvents(),!((null===(o=n._chunkDetails)||void 0===o||null===(o=o.app_events)||void 0===o?void 0:o.length)>0))return n._chunkDetails=t({},d),void e();var c=null!==(s=null===(a=i=t(t({},i),{},{chunk_details:t({},n._chunkDetails)}))||void 0===a||null===(a=a.session_info)||void 0===a?void 0:a.id)&&void 0!==s?s:"1",_=null!==(u=null===(l=i)||void 0===l||null===(l=l.chunk_meta)||void 0===l?void 0:l.number)&&void 0!==u?u:1;n._dataManager.persistCurrentChunk(i),n._api.postChunk(i,(function(){n._updateChunkNumberMap(c,_+1),Ne.debug("Controller : Old chunk reporting successful."),n._dataManager.removeOldChunk(),n._dataManager.removeOldChunkDetails(),n._reinitialiseChunkDetails(),n.createNewChunkAndPersist(),e()}),(function(){Ne.debug("Controller : Old chunk reporting failed."),e()}))}else e()})),s(this,"_addAndClearUnsentEvents",(function(){var e=n._dataManager.getOldChunkDetails();if(K(e)){var t=e.app_events,i=e.navigation_events,r=e.system_events,o=e.user_events;n._chunkDetails.app_events=[].concat(u(n._chunkDetails.app_events||[]),u(t)),n._chunkDetails.navigation_events=[].concat(u(n._chunkDetails.navigation_events||[]),u(i)),n._chunkDetails.system_events=[].concat(u(n._chunkDetails.system_events||[]),u(r)),n._chunkDetails.user_events=[].concat(u(n._chunkDetails.user_events||[]),u(o)),n._dataManager.removeOldChunkDetails()}})),s(this,"_updateChunkNumberMap",(function(e,t){var i=n._dataManager.getSessionsChunkNumberMap();i[e]=t,n._dataManager.persistSessionsChunkNumberMap(i),n._chunkNumber=t})),s(this,"createNewChunkAndPersist",(function(){var e=n.createANewChunk();return n._dataManager.persistCurrentChunk(e),e})),s(this,"createANewChunk",(function(){var e=K(n.config.name)?n.config.name:"",i=K(n.config.domain)?n.config.domain:"",r=n._dataManager.getNewChunk(n.startTime,n.sessionStartTime,n.sessionId,n._idleTimeout),o=r.chunk,s=o.session_info,a=o.app_info,u=o.sdk_info,l=o.chunk_details,d=o.chunk_meta,c=l.session_attributes,_=l.user_attributes;return n._sessionInfo=s,n._sessionInfo.is_first_session=n._isFirstSession,n._sdkInfo=u,n._appInfo=t(t({},a),{},{app_name:e,bundle_id:i,app_version:""+n.version}),n._chunkNumber=d.number,n._userAttributes=t(t({},n._userAttributes),_),n._sessionAttributes=t(t({},n._sessionAttributes),c),n._chunkDetails=l,n._addAndClearUnsentEvents(),n.newSession=r.is_new_session,n.newSession||n._setSessionIdFromChunk(o),{sdk_info:n._sdkInfo,session_info:n._sessionInfo,app_info:n._appInfo,device_info:n._deviceInfo,chunk_details:l,chunk_meta:d}})),s(this,"_setSessionIdFromChunk",(function(e){var t=e.session_info.id;t&&(n.sessionId=t,n.persistToStorage("_apx_sId",n.sessionId))})),s(this,"_getTotalBackgroundTime",(function(){var e=n._sessionInfo,t=e.total_duration,i=e.duration;return t>i?t-i:0})),s(this,"_downloadConfig",(function(e){if(Ne.debug("Controller : Fetch a new config"),n._canFetchConfig(e)){var t=n.config.sct_time,i=n._dataManager.getItemOrDefault("_apx_lct",-1);if(t>0&&i>0)if(Math.abs(Date.now()-i)<t)return void Ne.debug("Controller : No need to fetch config. Did not pass the throttle time");n.persistToStorage("_apx_lct",Date.now()),n._api.getConfig((function(e){var t;Ne.debug("Controller : New config fetched"),n._dataManager.persistConfig(e),n.persistToStorage("_apx_ch",null!==(t=e.hash)&&void 0!==t?t:We(e)),n._mergeConfigWithClientConfig(e),n._updateAppInfo()}),(function(e){0!==e&&Ne.error("Controller : Failed to fetch config")}))}else Ne.debug("Controller : No need to fetch config. No change in hash")})),s(this,"_postUserInfo",(function(){Ne.debug("Controller : Posting user info");var e=n._sdkInfo.sdk_version,t={sdk_version:JSON.stringify(e),app_info:n._appInfo,device_info:n._deviceInfo,user_attributes:n._userAttributes},i=We(t),r=n._dataManager.getItemOrDefault("_apx_uih","");i!==r?n._api.postUserInfo(t,(function(){Ne.debug("Controller : Posted user info. Persisting the hash to localstorage"),n.persistToStorage("_apx_uih",i)})):Ne.debug("Controller : No need to post user info. No change in it")})),s(this,"_canFetchConfig",(function(e){return""===e||n._dataManager.getItemOrDefault("_apx_ch","")!==e})),s(this,"_dispatchSystemEvent",(function(e){Ne.debug("Controller : Dispatching SYSTEM_EVENT");var t=Ye(e,n.getTimeElapsedInSession());n.dispatchEvent("SYSTEM_EVENT",t)})),s(this,"_resetCampaignSessionFrequency",(function(){Ne.debug("Controller : Resetting the session frequncy of all the campaigns to 0");var e={};try{var t=n.getFromStorage("qe_state");K(t)&&(e=JSON.parse(Se(n.siteId,t))),Object.entries(e).forEach((function(t){var n=a(t,1)[0];return e[n].SESSION=0}))}catch(t){e={},Ne.error("Controller : Can't reset campaign limits:".concat(t))}n.persistToStorage("qe_state",e,!0),n.window.ApxorRTM.resetFrequencyCounts()})),s(this,"_registerSystemEventMonitor",(function(){Ne.debug("Registering a handler for the system events"),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(null!=t&&G(t)){var n=e.document;"loading"!==n.readyState?t():G(n.addEventListener)?n.addEventListener("DOMContentLoaded",t):G(e.attachEvent)&&e.attachEvent("onreadystatechange",(function(e){"loading"!==n.readyState&&t(e)}))}}(n.window,(function(){n._isEventMonitorRegistered||(n._executeBeforeUnload(),n._systemEventMonitor=new ct(!1),n._isEventMonitorRegistered=!0)}))})),s(this,"_executeBeforeUnload",(function(){var e=!1;!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return null};G(t)&&(e.addEventListener("pagehide",(function(e){return t(e),""})),e.addEventListener("beforeunload",(function(e){return t(e),""})),e.addEventListener("onunload",(function(e){return t(e),""})))}(window,(function(){(Ne.debug("Controller : Executing before unload"),e)||n._isRunning&&(e=!0,"visible"===window.document.visibilityState&&(n._endNavigation(!0),n._dispatchSystemEvent("hidden")),clearInterval(n._sendChunkOnEventsId),clearInterval(n._sendChunkOnETAId),n._bulkUpload&&n._dataManager.persistOldChunkDetails(n._chunkDetails),n._systemEventMonitor.unregisterEvents())}))})),s(this,"_registerIntervalBasedChunkReporting",(function(){Ne.debug("Controller : Registering the handlers for chunk reporting"),clearInterval(n._sendChunkOnETAId),n._sendChunkOnETAId=setInterval((function(){n._sendChunkWithAtleastOneEvent()}),n._internalChunkSendInterval),n._batchEvents&&(clearInterval(n._sendChunkOnEventsId),n._sendChunkOnEventsId=setInterval((function(){n._sendChunkWithMaxedOutEvents()}),n._chunkSendInterval))})),s(this,"_sendChunkWithAtleastOneEvent",(function(){var e=n._chunkDetails,t=e.app_events,i=e.navigation_events;t.length+i.length>0&&!n._blockChunkReporting&&n._prepareAndReportChunk()})),s(this,"_sendChunkWithMaxedOutEvents",(function(){var e=n._chunkDetails,t=e.app_events,i=e.navigation_events,r=t.length+i.length;(!n._bulkUpload&&r>0||n._bulkUpload&&r>=n._maxEventsSentCount)&&n._prepareAndReportChunk()})),s(this,"_prepareAndReportChunk",(function(){Ne.debug("Controller : Preparing and reporting chunk");var e=n._prepareChunk(n._chunkDetails);n._reportChunk(e,!1)})),s(this,"_prepareChunk",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Ne.debug("Controller : Preparing chunk"),n._updateDuration();var i={id:n.sessionId+":"+n._chunkNumber,number:n._chunkNumber,reporting_times:[Date.now()]};return e=t(t({},e),{},{user_attributes:n._userAttributes,session_attributes:n._sessionAttributes}),{sdk_info:n._sdkInfo,session_info:n._sessionInfo,app_info:n._appInfo,device_info:n._deviceInfo,chunk_meta:i,chunk_details:e}})),s(this,"_updateDuration",(function(){Ne.debug("Controller : Updating the foreground time");var e=n.getSDKRunningTimeInSec(),i=e;e-=n._sessionHandler.getTotalBackgroundTime(),n._sessionInfo=t(t({},n._sessionInfo),{},{duration:ce(e),total_duration:ce(i)})})),s(this,"_reportChunk",(function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if(Ne.debug("Controller : Reporting chunk"),n._isSending)n._pendingChunk=!0;else if(n._isSending||n._chunk502RetryTime>0&&-1!==n._last502Time&&Date.now()-n._last502Time<n._chunk502RetryTime)n._reinitialiseChunkDetails();else{var r=e.chunk_details,o=r.app_events,s=r.system_events,a=r.navigation_events,u=r.user_events;if(o.length<1&&s.length<1&&a.length<1&&u.length<1)return Ne.debug("Controller : Chunk not sent. No events in the chunk"),n._isSending=!1,void i();n._isSending=!0,n._updateChunkNumberMap(n._sessionInfo.id,n._chunkNumber+1),n._dataManager.removeOldChunkDetails(),n._dataManager.removeOldChunk(),n._reinitialiseChunkDetails(),t?(n._isSending=!1,n._dataManager.persistOldChunk(e),i()):(n._dataManager.persistCurrentChunk(e),n._api.postChunk(e,(function(){if(Ne.debug("Controller : Chunk successfully sent"),n._isSending=!1,n._last502Time=-1,i(),n._pendingChunk){n._pendingChunk=!1;var e=n._prepareChunk(n._chunkDetails);n._reportChunk(e)}}),(function(t){Ne.debug("Controller : Chunk sending failed"),0!==t&&(n._isSending=!1,t>=500&&(n._last502Time=Date.now()),413!==t&&417!==t&&n._dataManager.persistOldChunk(e),i())})))}})),s(this,"setUserId",(function(e){n._isInitialized?n._isRunning?H(e)||(Ne.debug("Controller : User id set"),n.setUserProperties({custom_user_id:e})):Ne.warn("Apxor SDK is not running"):ht.setUserId()})),s(this,"setUserProperties",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i={};if(n._isInitialized)if(n._isRunning){if(Object.keys(e).length>0){if(i=xe(e,n._userAttributes),n.isTestDevice()&&Object.keys(i).length>0){var r=Object.keys(i);r.forEach((function(e){n.logAppEvent("apx_property_updated",{apx_property_type:"user",apx_property_name:e,apx_property_old_value:n._userAttributes[e]||"",apx_property_updated_value:i[e]})}))}n._userAttributes=t(t({},n._userAttributes),e);try{Ne.debug("Controller : User properties set"),n.persistToStorage("_apx_ua",be(n.siteId,JSON.stringify(n._userAttributes)))}catch(e){Ne.debug("Controller : Error while setting the use properties ".concat(e))}}}else Ne.warn("Apxor SDK is not running");else ht.setUserProperties()})),s(this,"setSessionProperties",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i={};if(n._isInitialized)if(n._isRunning){if(Object.keys(e).length>0){if(Ne.debug("Controller : Session properties set"),i=xe(e,n._sessionAttributes),n.isTestDevice()&&Object.keys(i).length>0){var r=Object.keys(i);r.forEach((function(e){n.logAppEvent("apx_property_updated",{apx_property_type:"session",apx_property_name:e,apx_property_old_value:n._sessionAttributes[e]||"",apx_property_updated_value:i[e]})}))}n._sessionAttributes=t(t({},n._sessionAttributes),e)}}else Ne.warn("Apxor SDK is not running");else ht.setSessionProperties()})),s(this,"setAppVersion",(function(e){n._isInitialized?n._isRunning?n.version=e:Ne.warn("Apxor SDK is not running"):ht.setAppVersion()})),s(this,"_updateAppInfo",(function(){Ne.debug("Controller : Updating the App info");var e=n.config,t=e.name,i=void 0===t?"":t,r=e.domain,o=void 0===r?n.window.location.host:r,s=n._dataManager.getInstallationTime(n.startTime),a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.location,n=void 0===t?{}:t,i=n.protocol,r=n.host,o=n.hostName;return"file:"===i||"localhost"===r||"0.0.0.0"===o||"127.0.0.1"===o?"development":"production"}(n.window),u=K(n.clientConfig.version)?""+n.clientConfig.version:n._dataManager.getAppVersion(),l=i;""===i&&"Unknown"===(l=le(n.window))&&(l=""),n._appInfo=function(e,t,n,i,r){return{app_name:e,app_version:r=K(r)?r:"ALL",bundle_id:t,installation_time:n,app_mode:i}}(l,o,s,a,u)})),s(this,"getEventCount",(function(e){var t=-1;return n.clientEvents.forEach((function(n){n.name===e&&(t+=1)})),-1===t?n._sync.getEventCount(e):t})),s(this,"clearNavigation",(function(){n._endNavigation(),n._currentNavigation=null})),s(this,"_endNavigation",(function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Ne.debug("Controller : Ending the navigation"),K(n._currentNavigation)&&(n._currentNavigation.duration=ce(n.getSDKRunningTimeInSec()-n._currentNavigation.transition_time),n.dispatchEvent("NAVIGATION_EVENT",t({},n._currentNavigation),e))})),s(this,"getSessionId",(function(){return n.sessionId})),s(this,"getDeviceId",(function(){return n._isInitialized?n._isRunning?n._deviceId:(Ne.warn("Controller : Apxor SDK is not running"),null):(ht.getClientId(),null)})),s(this,"reportChunkOnVisibilityChange",(function(){var e;if(n._isInitialized){var t=n._prepareChunk(n._chunkDetails),i=n.siteId,r=JSON.stringify(t);(null===(e=n._chunkDetails)||void 0===e?void 0:e.app_events.length)>0&&(Ne.debug("Reporting a chunk on visibility change with sendBeacon"),n._dataManager.removeOldChunkDetails(),n._dataManager.persistOldChunk(t),navigator.sendBeacon("https://server.apxor.com/v2/api/".concat(i,"/text-chunks?appId=").concat(i,"&isTestDevice=").concat(n.isTestDevice()),r))}})),s(this,"_incrementLtCount",(function(e){if(W(n._ltCountObj[e])&&0!==n._ltCountObj[e])n._ltCountObj[e]=0;else{var t=n._ltCountObj[e];t+=1,n._ltCountObj[e]=t}var i=be(n.siteId,ye((new TextEncoder).encode(JSON.stringify(n._ltCountObj))));n.persistToStorage("_apx_lt_count",i)})),s(this,"logAppEvent",(function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!n._isInitialized||!n._isRunning)return Ne.warn("Controller : Can't log App event. SDK not initialised"),void ht.logAppEvent();try{if(Y(e)&&_e(i)){var s=e.replace("'","").replace("â€™","");n._incrementLtCount(s);var a=n._ltCountObj[s]||0;i=t(t({},i),{},{apx_lt_count:a});var u=Xe(e,ge(i),r,n.getTimeElapsedInSession()),l="APP_EVENT";if(n._stopEventsFromConfig.includes(e))return;n._clientEventsFromConfig.includes(e)&&(l="CLIENT_EVENT"),Ne.debug("Controller : Logging event ".concat(e)),n._updateListOfEventsLogged(e,i),n.dispatchEvent(l,u,!1,o)}else Ne.debug("Controller : Invalid App Event ".concat(e))}catch(e){Ne.error("LT Count object parsing failed ".concat(e))}})),s(this,"logClientEvent",(function(e,i){if(!n._isInitialized||!n._isRunning)return Ne.warn("Controller : Can't log client event. SDK not initialised"),void ht.logClientEvent();var r=n._dataManager.getltCount(e);i=t(t({},i),{},{apx_lt_count:r});var o=Xe(e,ge(i),null,n.getTimeElapsedInSession()),s="CLIENT_EVENT";n._stopEventsFromConfig.includes(e)||(n._appEventsFromConfig.includes(e)&&(s="APP_EVENT"),o?(Ne.debug("Controller : Logging client event ".concat(e)),n._updateListOfEventsLogged(e,i),n.dispatchEvent(s,o)):Ne.debug("Controller : Invalid client event ".concat(e)))})),s(this,"logPageView",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.getTimeElapsedInSession();if(!n._isInitialized||!n._isRunning)return Ne.warn("Controller : Can't log page event. SDK not initialised"),void ht.logPageView();if("string"==typeof e&&e&&e.length>0){var i=ce(t),r=$e(e,le(n.window),0,i);n._sync.handleNavigationEvent(e),K(n._currentNavigation)?(n._endNavigation(),n._currentNavigation=r):n._currentNavigation=r,n.logAppEvent("APX_PAGE_OPENED",{time:te(new Date),navigation_id:e}),Ne.debug("logPageView: page view is logged ",e)}else Ne.warn("Controller : Can't log page event as pathname is empty")})),s(this,"setApxorEventListener",(function(e){n._customEventListener=e})),s(this,"dispatchEvent",(function(e,i){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];n.isTestDevice()&&(o=!0),Ne.debug("Controller : Dispatching Event ".concat(i.name)),n._dataManager.updateRetainedDayCount(Date.now());var s=!1,a=function(){var a=n._chunkDetails.app_events;switch(s&&(i.time=n.getTimeElapsedInSession()),e){case"APP_EVENT":n._chunkDetails=t(t({},n._chunkDetails),{},{app_events:[].concat(a,i)});break;case"CLIENT_EVENT":n.clientEvents.push(i),n.isTestDevice()&&(n._chunkDetails=t(t({},n._chunkDetails),{},{app_events:[].concat(a,i)}))}if(n._eventHandler.notifyListeners(e,i),!s&&"CLIENT_EVENT"!==e){n._chunkDetails=t(t({},n._chunkDetails),{},{user_attributes:t({},n._userAttributes),session_attributes:t({},n._sessionAttributes)});var u=n._prepareChunk(n._chunkDetails,e);if(n._dataManager.persistOldChunkDetails(n._chunkDetails),n._dataManager.persistOldChunk(u),!0!==o)if(n._bulkUpload){if(a.length+1<n._maxEventsSentCount)return;n._reportChunk(u,r)}else r||"APP_EVENT"!==e||n._batchEvents||n._reportChunk(u,r);else n._reportChunk(u,r)}},u=function(){n.persistToStorage("_apx_lEt",Date.now()),a()},l=function(){s=!0,n.startNewSession(Date.now(),u)};if("APP_EVENT"===e){var d=Date.now(),c=n.getFromStorage("_apx_lEt");if(c=Number(c),$(c)&&c>0&&Math.round(de(d-c))>n._idleTimeout?n.endSession(!0,l):(n.persistToStorage("_apx_lEt",Date.now()),a()),n._customEventListener){var _=void 0!==i.additional_info.campaign_type?i.additional_info.campaign_type:"",g=void 0!==i.additional_info.id?i.additional_info.id:"",S=void 0!==i.additional_info.apx_survey_id?i.additional_info.apx_survey_id:"";if(h.includes(i.name))n._customEventListener.onEvent("apx_campaign_show",{nudge_type:"".concat(_),nudge_id:"".concat(g),timestamp:Date.now(),device_id:n.getDeviceId(),user_id:n._dataManager.getUserId(),attributes:i.additional_info});else if(p.includes(i.name))n._customEventListener.onEvent("apx_campaign_dismiss",{nudge_type:"".concat(_),nudge_id:"".concat(g),timestamp:Date.now(),device_id:n.getDeviceId(),user_id:n._dataManager.getUserId(),attributes:i.additional_info});else if(m.includes(i.name))n._customEventListener.onEvent("apx_campaign_action",{nudge_type:"".concat(_),nudge_id:"".concat(g),timestamp:Date.now(),device_id:n.getDeviceId(),user_id:n._dataManager.getUserId(),attributes:i.additional_info});else if(f.includes(i.name))n._customEventListener.onEvent("apx_survey_show",{nudge_type:"".concat(_),nudge_id:"".concat(S),timestamp:Date.now(),device_id:n.getDeviceId(),user_id:n._dataManager.getUserId(),attributes:i.additional_info});else if(v.includes(i.name))n._customEventListener.onEvent("apx_survey_dismiss",{nudge_type:"".concat(_),nudge_id:"".concat(S),timestamp:Date.now(),device_id:n.getDeviceId(),user_id:n._dataManager.getUserId(),attributes:i.additional_info});else if(b.includes(i.name))n._customEventListener.onEvent("apx_survey_action",{nudge_type:"".concat(_),nudge_id:"".concat(S),timestamp:Date.now(),device_id:n.getDeviceId(),user_id:n._dataManager.getUserId(),attributes:i.additional_info});else{var I=/^(InLine_|InApp_)[a-zA-Z0-9]+_Clicked$/,k=/^Survey_[a-zA-Z0-9]+_Clicked$/;I.test(i.name)?n._customEventListener.onEvent("apx_campaign_action",{nudge_type:"".concat(_),nudge_id:"".concat(i.additional_info.id),timestamp:Date.now(),device_id:n.getDeviceId(),user_id:n._dataManager.getUserId(),attributes:i.additional_info}):k.test(i.name)&&n._customEventListener.onEvent("apx_survey_action",{nudge_type:"".concat(_),nudge_id:"".concat(S),timestamp:Date.now(),device_id:n.getDeviceId(),user_id:n._dataManager.getUserId(),attributes:i.additional_info})}}}else a()})),s(this,"startNewSession",(function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now(),i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];n._isInitialized||r?(n._isRunning||(n.sessionId=ie(),Ne.debug("Controller : New session started with id ".concat(n.sessionId)),n.persistToStorage("_apx_sId",n.sessionId),n._sessionCount=null!==(e=n.getFromStorage("apx_retained_session"))&&void 0!==e?e:0,n._sessionCount=Number(n._sessionCount)+1,n.persistToStorage("apx_retained_session",n._sessionCount),n.sessionStartTime=t,n.persistToStorage("apx_sst",n.sessionStartTime),n._sessionHandler.reset(),n.createNewChunkAndPersist(),n._systemEventMonitor=new ct(n.config),n._isRunning=!0,n._resetCampaignSessionFrequency()),i()):ht.startSession()})),s(this,"endSession",(function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};if(n._isInitialized)if(n._isRunning){e||n._endNavigation();var r=t(t({},n._chunkDetails),{},{user_attributes:t({},n._userAttributes),session_attributes:t({},n._sessionAttributes)}),o=n._prepareChunk(r);n._dataManager.removeOldChunkDetails();var s=function(){n._dataManager.clearCurrentChunk(),n._sessionHandler.reset(),K(n._systemEventMonitor)&&n._isEventMonitorRegistered&&n._systemEventMonitor.unregisterEvents(),Z(document),n._isRunning=!1,i(),Ne.debug("Controller : Current session ended")};n._chunk502RetryTime>0&&n._last502Time>0?(n._dataManager.persistOldChunk(o),s()):n._reportChunk(o,!1,s)}else Ne.warn("Apxor SDK is not running. Please make sure to call 'startSession'");else ht.endSession()})),s(this,"resetUserProperties",(function(){n._dataManager.resetUserProperties();var e=se(n.window,n.getDevInfo());n._userAttributes={},n.setUserProperties(e)})),s(this,"resetSessionProperties",(function(){var e=ae(n.window);n._sessionAttributes={},n.setSessionProperties(e)})),s(this,"persistToStorage",(function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=t;i&&_e(r)&&(r=be(n.siteId,JSON.stringify(r))),n._dataManager.persist(e,r)})),s(this,"getFromStorage",(function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return n._dataManager.getItem(e,t)})),s(this,"getValueOrDefault",(function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n._dataManager.getItemOrDefault(e,t,i)})),s(this,"getSessionInfo",(function(){return n._sessionInfo})),s(this,"getUserAttributes",(function(){return n._userAttributes})),s(this,"getSessionAttributes",(function(){return n._sessionAttributes})),s(this,"makeGetRequest",(function(e,t,i){n._api.makeGetRequest(e,t,i)})),s(this,"fetchConfiguration",(function(e,t,i,r){n._sync.fetchConfiguration(e,t,i,r)})),s(this,"flattenJSON",(function(e){return ge(e,2)})),s(this,"registerForEvent",(function(e,t){n._eventHandler.registerForEvent(e,t)})),s(this,"unregisterFromEvent",(function(e,t){n._eventHandler.unregisterFromEvent(e,t)})),s(this,"getSDKRunningTimeInSec",(function(){return de(Date.now()-n.startTime)})),s(this,"getTimeElapsedInSession",(function(){var e=Date.now();return Ne.debug("Controller : Time elapsed in session is ".concat((e-n.sessionStartTime)/1e3,"sec")),de(e-n.sessionStartTime)})),s(this,"setBlockChunkReportingFlag",(function(e){n._blockChunkReporting=e})),s(this,"isTestDevice",(function(){try{var e=n.getFromStorage("_apx_td",!0);return!(!K(e)||!K(e.id))}catch(e){return!1}})),s(this,"persistTerminationInfoLocally",(function(e){var t;null===n.getFromStorage("apx_termination_ID")&&n.persistToStorage("apx_termination_ID",JSON.stringify({}));var i=JSON.parse(n.getFromStorage("apx_termination_ID"));i[e]||(i[e]={startDate:"",_startTime:"",goalAcheived:!1}),null!==(t=i[e])&&void 0!==t&&t.goalAcheived||(i[e].goalAcheived=!0),n.persistToStorage("apx_termination_ID",JSON.stringify(i))})),s(this,"persistStartDateInfoLocally",(function(e){var t,i;null===n.getFromStorage("apx_termination_ID")&&n.persistToStorage("apx_termination_ID",JSON.stringify({}));var r=JSON.parse(n.getFromStorage("apx_termination_ID"));r[e]||(r[e]={startDate:Ee(),_startTime:De(),goalAcheived:!1}),""===!(null!==(t=r[e])&&void 0!==t&&t.startDate)&&(r[e].startDate=Ee()),""===!(null!==(i=r[e])&&void 0!==i&&i._startTime)&&(r[e]._startTime=De()),n.persistToStorage("apx_termination_ID",JSON.stringify(r))})),s(this,"isBadgeTriggerSatisfied",(function(e){var t,i;if(null===n.getFromStorage("apx_termination_ID"))return!1;var r=JSON.parse(n.getFromStorage("apx_termination_ID"));return!!r[e]&&(""!==!(null!==(t=r[e])&&void 0!==t&&t.startDate)||""!==!(null!==(i=r[e])&&void 0!==i&&i._startTime)||void 0)})),s(this,"clearLocalStorage",(function(){for(var e=localStorage.length-1;e>=0;e--){var t=localStorage.key(e);L.includes(t)||localStorage.removeItem(t)}})),e.instance||(e.instance=this),e.instance}return o(e,null,[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}();s(ft,"instance",void 0);var pt=function(){function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ne();i(this,e),s(this,"_isInitialized",!1),s(this,"_queue",[]),s(this,"version",240),s(this,"_isFlutter",!1),s(this,"_flutterHelper",null),s(this,"_init",(function(){Array.isArray(n._q)&&n._q.forEach((function(e){var t=e.m,i=e.args;n[t]&&G(n[t])&&n[t].apply(n,Array.from(i))}))})),s(this,"init",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;try{if(Ne.debug("SDK : Apxor SDK initialization has started"),!n._isInitialized){var o,s;K(t)&&(!K(t)||t instanceof Object)||(t=g);var a=t,u=a.honorDNT,l=void 0!==u&&u,d=a.debug,c=void 0!==d&&d,_=a.events_upload_time,h=void 0===_?-1:_,f=a.retry_time,p=void 0===f?-1:f,v=a.level,m=void 0===v?"error":v;if(null!==(o=n.window)&&void 0!==o&&null!==(o=o.localStorage)&&void 0!==o&&o.getItem("apx_debug_enable")&&(c="true"===n.window.localStorage.getItem("apx_debug_enable")),null!==(s=n.window)&&void 0!==s&&null!==(s=s.localStorage)&&void 0!==s&&s.getItem("apx_log_level")&&(m=n.window.localStorage.getItem("apx_log_level")),n._configureLogger(c,m),!K(e)||!K(e.trim)||""===e.trim())return Ne.error("SDK : ApxorSDK couldn't be initialized: Invalid Site Id:".concat(e)),n._controller=ht,void(null!=r&&G(r)&&r());if(l&&!ue(n.window))return n._controller=ht,null!=r&&G(r)&&r(),void Ne.error("SDK : Tracking is disabled, ApxorSDK couldn't be initialized");n._controller=ft.getInstance(),K(h)&&h>0&&(t.events_upload_time*=1e3),K(p)&&p>0&&(t.retry_time*=1e3),n._controller.initialize(e,n._startTime,t,n.window,(function(){n._isInitialized=!0,n._queue.forEach((function(e){var t=e.m,i=e.args;n._controller[t].apply(n._controller,Array.from(i))})),null!=i&&G(i)&&(Ne.debug("SDK : Device id is "+n.getClientId()),i({client_id:n.getClientId(),session_id:n.getSessionId()})),n.window.console.info("ApxorSDK initialized for site:"+e+" with SDK version: 240")}),(function(){n._isInitialized=!1,Ne.error("SDK : Failed to initialize Apxor SDK"),r&&G(r)&&r("")}))}}catch(e){n._controller._isInitialized=!1,Ne.error("SDK : Exception while initializing Apxor SDK : ",e),r&&G(r)&&r(e)}})),s(this,"_configureLogger",(function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"error";Ne.enabled=e,Ne.level=t,Ne.console=n.window.console,Ne.debug("SDK : Logger configured with level ".concat(t))})),s(this,"setIsFlutter",(function(e){n._isFlutter=e})),s(this,"isFlutter",(function(){return n._isFlutter})),s(this,"registerApxorFlutterHelper",(function(e){n._flutterHelper=e})),s(this,"logEvent",(function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];n._isInitialized?n._controller.logAppEvent(e,t,void 0,i):n._queue.push({m:"logAppEvent",args:[e,t]})})),s(this,"logClientEvent",(function(e,t){n._isInitialized?n._controller.logClientEvent(e,t):n._queue.push({m:"logClientEvent",args:[e,t]})})),s(this,"logPageView",(function(e){n._isInitialized?n._controller.logPageView(e):n._queue.push({m:"logPageView",args:[e]})})),s(this,"setUserId",(function(e){n._isInitialized?n._controller.setUserId(e):n._queue.push({m:"setUserId",args:[e]})})),s(this,"setUserProperties",(function(e){Ne.debug("SDK : User properties set"),n._isInitialized?n._controller.setUserProperties(e):n._queue.push({m:"setUserProperties",args:[e]})})),s(this,"resetUserProperties",(function(){Ne.debug("SDK : User properties reset"),n._isInitialized?n._controller.resetUserProperties():n._queue.push({m:"setUserProperties",args:[]})})),s(this,"resetSessionProperties",(function(){Ne.debug("SDK : User properties reset"),n._isInitialized?n._controller.resetSessionProperties():n._queue.push({m:"setUserProperties",args:[]})})),s(this,"clearLocalStorage",(function(){Ne.debug("SDK:Clearing keys which are not related to apxor"),n._isInitialized?n._controller.clearLocalStorage():n._queue.push({m:"clearLocalStorage",args:[]})})),s(this,"setSessionProperties",(function(e){Ne.debug("SDK : Session properties set"),n._isInitialized?n._controller.setSessionProperties(e):n._queue.push({m:"setSessionProperties",args:[e]})})),s(this,"setAppVersion",(function(e){n._isInitialized?n._controller.setAppVersion(e):n._queue.push({m:"setAppVersion",args:[e]})})),s(this,"flattenJSON",(function(e){n._isInitialized?n._controller.flattenJSON(e):n._queue.push({m:"flattenJSON",args:[e]})})),s(this,"getSessionId",(function(){return n._isInitialized?n._controller.getSessionId():null})),s(this,"getClientId",(function(){return n._controller.getDeviceId()})),s(this,"startNewSession",(function(){Ne.debug("SDK : A new session started"),n._isInitialized?n._controller.startNewSession(Date.now()):n._queue.push({m:"startNewSession",args:[]})})),s(this,"endSession",(function(){Ne.debug("SDK : Current session ended"),n._isInitialized?n._controller.endSession():n._queue.push({m:"endSession",args:[]})})),s(this,"getController",(function(){return n._controller})),s(this,"getSiteId",(function(){var e;return null===(e=n._controller)||void 0===e?void 0:e.getSiteId()})),s(this,"setRedirectionHandler",(function(e){G(e)?n._isInitialized?n._controller.setRedirectionHandler(e):n._queue.push({m:"setRedirectionHandler",args:[e]}):Ne.error("Callback must be a function")})),s(this,"setInitFlag",(function(e){n._isInitialized=e})),this.window=t,this._startTime=r,this._init()}return o(e,[{key:"getApxorFlutterHelper",value:function(){return this._flutterHelper}},{key:"setApxorEventListener",value:function(e){this._controller.setApxorEventListener(e)}}]),e}();window.Apxor=window.Apxor||{_q:[],_st:Date.now()},pt.prototype._q=window.Apxor._q;var vt=new pt(window,+window.Apxor._st);window.Apxor=vt,window.ApxorEventListener=Me,window.ApxorLogger=Ne;try{void 0===exports&&null===exports||(exports.default=vt,module.exports=exports.default)}catch(e){}return vt}));
